self.window=self,window.jsExecStartTimeStamp=Date.now(),(self.webpackChunk_tencent_alloy_builder_webpack_runner=self.webpackChunk_tencent_alloy_builder_webpack_runner||[]).push([[3724],{34960:function(t,e,n){"use strict";var r,o,i;n.d(e,{$e:function(){return o},H4:function(){return a},eM:function(){return u},kd:function(){return s},me:function(){return r},tA:function(){return i}}),function(t){t.OFFLINE_DATA="OfflineData",t.DOCUMENT_DATA="DocumentData",t.PAD_INFO="PadInfo",t.NEW_DOCUMENT_ID="NewDocumentIds",t.FOLDER_INFO="FolderInfo",t.USER_INFO="UserInfo",t.DOCUMENT_STATUS="DocumentStatus",t.LIST_TYPE="ListType",t.DATA_CHANGE="DataChange",t.QUICK_LOOK_WORD="QuickLookWord",t.USERS="Users",t.DocumentEntities="DocumentEntities"}(r||(r={})),function(t){t.EXCEL="EXCEL",t.WORD="WORD",t.SLIDE="SLIDE"}(o||(o={})),function(t){t.GLOBAL="globalPadId",t.SECRET="secretId"}(i||(i={}));var a="TencentDocs",s=4,u="true"===localStorage.getItem("isOfflineModuleDebug")||!1},38421:function(t,e,n){"use strict";n.d(e,{f:function(){return i}});var r=n(40443),o=n.n(r)().getInstance().getConfig('npm["@tencent/docs_offline"]'),i=(null===o||void 0===o?void 0:o.TOC_ORIGIN)||"https://docs.qq.com"},41795:function(t,e,n){"use strict";n.d(e,{dd:function(){return w},us:function(){return D}});var r=n(9578),o=n(34960),i=function(t){this.uid=t.uid,this.globalPadId=t.globalPadId,this.secretId=t.secretId,this.lastSyncTime=t.lastSyncTime||Date.now(),this.lastErrorTime=t.lastErrorTime},a=n(82471),s=n(81289),u=n(96331),c=n(16113),l=n(35072),d=n(93333),p=n(613),f=n(30414),h=n(35083),v=n(88185),_=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},y=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},E=function(){function t(){this.tag="OfflineEditBackUp"}return t.prototype.init=function(){return _(this,void 0,void 0,(function(){var t,e;return y(this,(function(n){switch(n.label){case 0:return t={databaseName:v.k1,type:(0,f.N1)()?v.c$.nativeDB:v.c$.indexDB},this.storageManager=new v.Ar(t),[4,this.storageManager.init()];case 1:return e=n.sent(),this.isStorageAvailable=e,e?(d.C.info(this.tag,"init finish. isStorageAvailable:"+this.isStorageAvailable),[2,!0]):(d.C.error(this.tag,"init error. open database fail"),[2,!1])}}))}))},t.prototype.dispose=function(){return _(this,void 0,void 0,(function(){return y(this,(function(t){return this.storageManager.dispose(),[2,!0]}))}))},t.prototype.upsertChanges=function(t){return _(this,void 0,void 0,(function(){var e;return y(this,(function(n){switch(n.label){case 0:return[4,this.isDatabaseAvailable()];case 1:if(!n.sent())return d.C.warn(this.tag,"upsertChanges can not write."),[2,!1];n.label=2;case 2:return n.trys.push([2,4,,5]),[4,new v.b7(this.storageManager.storage.collection(h.TU)).upsertChanges(t)];case 3:return n.sent(),[2,!0];case 4:return e=n.sent(),d.C.error(this.tag,"upsertChanges error: "+e.message+", , "+e.stack+"."),this.isStorageAvailable=!1,[2,!1];case 5:return[2]}}))}))},t.prototype.isDatabaseAvailable=function(){return this.isStorageAvailable},t}(),g=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},m=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function b(t){return g(this,void 0,void 0,(function(){var e,n,r;return m(this,(function(o){switch(o.label){case 0:return[4,(e=new E).init()];case 1:return(n=o.sent())?[4,e.upsertChanges(t)]:(d.C.error("init backup database error!",n),[2,!1]);case 2:return(r=o.sent())?[4,e.dispose()]:(d.C.error("upsert backup changes error!",r,r),[2,!1]);case 3:return o.sent(),d.C.info("backup changes success!",t),[2,!0]}}))}))}var C=function(){return C=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},C.apply(this,arguments)},T=function(){return T=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},T.apply(this,arguments)},A=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},S=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},O=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r};(0,f.N1)()&&!(0,f.kK)()?l.Z:p.Z;var D=10,w=function(){function t(t){this.defaultCodeVersion=new Map,this.parent=t.parent,this.database=t.database,this.setDefaultCodeVersion("doc","2.1.0"),this.setDefaultCodeVersion("sheet","2.4.0"),this.setDefaultCodeVersion("slide","1.0.0")}return t.prototype.filterUncommitedPadId=function(t){return A(this,void 0,void 0,(function(){var e,n,i,a;return S(this,(function(u){switch(u.label){case 0:return t&&0===t.length?[2,new r.x4(new r.ir(r.r8.ILLEGAL_ARGUMENT,"文档Id数组长度不能为0"))]:(e=r.he.newInstance().addCondition("type",r.E1.IN,[s.N.COMMITING,s.N.WATTING,s.N.QUEUE]).addCondition("uid",r.E1.ONLY,this.parent.user.getUserId()),t&&e.addCondition("globalPadId",r.E1.IN,t),[4,this.database.getAll(o.me.OFFLINE_DATA,e)]);case 1:return(n=u.sent()).error?(d.C.error("查询失败",n.error),[2,n]):(i=n.data,a=i.map((function(t){return t.globalPadId})).reduce((function(t,e){return t.includes(e)?t:O(t,[e])}),new Array),[2,new r.x4(void 0,a)])}}))}))},t.prototype.filterNeedUpdateCachePadId=function(t){return A(this,void 0,void 0,(function(){var e,n,i,a,s,u,c,l;return S(this,(function(p){switch(p.label){case 0:return t&&0===t.length?[2,new r.x4(new r.ir(r.r8.ILLEGAL_ARGUMENT,"文档Id数组长度不能为0"))]:(e=r.he.newInstance().addCondition("uid",r.E1.ONLY,this.parent.user.getUserId()),t&&e.addCondition("globalPadId",r.E1.IN,t),[4,this.database.getAll(o.me.DOCUMENT_DATA,e)]);case 1:if((n=p.sent()).error)return d.C.error("查询失败",n.error),[2,n];for(i=n.data,a=new Map,s=new Array,u=0;u<i.length;u++)c=i[u],l=a.get(c.globalPadId)||0,a.set(c.globalPadId,l+1),l+1===10&&s.push(c.globalPadId);return[2,new r.x4(void 0,s)]}}))}))},t.prototype.getUncommitedOfflineData=function(){return A(this,void 0,void 0,(function(){var t,e;return S(this,(function(n){switch(n.label){case 0:return t=r.he.newInstance().addCondition("type",r.E1.IN,[s.N.COMMITING,s.N.WATTING,s.N.QUEUE]).addCondition("uid",r.E1.ONLY,this.parent.user.getUserId()),[4,this.database.getAll(o.me.OFFLINE_DATA,t)];case 1:return(e=n.sent()).error?(d.C.error("查询失败",e.error),[2,e]):[2,e]}}))}))},t.prototype.syncOfflineData=function(t){return A(this,void 0,void 0,(function(){var e,n,r,o,i,s,u,c,h,v,_,y,E,g,m,b,C;return S(this,(function(T){switch(T.label){case 0:return d.C.log("call SyncOfflineData()",t),e=t.padId,n=t.secretId,r=t.padType,o=t.onCommiting,i=t.onCommitFinished,s=t.source,u=void 0===s?"list":s,c=t.force,h=void 0!==c&&c,[4,this.checkUpdateInterval(t)];case 1:return(v=T.sent()).resultCode!==a.D.Success?[2,v]:[4,(_=(0,f.N1)()&&!(0,f.kK)()?new l.Z(A):new p.Z(A)).lock("offline_"+n,{source:u})];case 2:if(!(y=T.sent()).isSuccess)return d.C.warn("SyncOfflineData. 竞争离线锁失败，同步接口异常结束",e,n,u,h,r,y),[2,{resultCode:a.D.GetDocLockError,subResultCode:-1,message:"竞争离线锁失败"}];T.label=3;case 3:return T.trys.push([3,8,9,11]),o&&o(e),d.C.log("SyncOfflineData. 第一步：带数据创建文档",e,n,u,h,r),[4,this.commitLocalFile(t)];case 4:return(g=T.sent()).resultCode!==a.D.Success?(i&&i(!1,e),[2,g]):(d.C.log("SyncOfflineData. 第二步，提交未提交的离线数据",e,n,u,h,r),[4,this.commitUncommitData(t)]);case 5:return(m=T.sent()).resultCode!==a.D.Success?(i&&i(!1,e),[2,m]):(i&&i(!0,e),d.C.log("SyncOfflineData. 第三步，检查版本更新",e,n,u,h,r),[4,this.checkVersionUpdate(r,e)]);case 6:return T.sent(),d.C.log("SyncOfflineData. 第四步，预拉离线缓存数据",e,n,u,h,r),[4,this.fetchAndStoreDocumentCache(t)];case 7:return(b=T.sent()).resultCode!==a.D.Success?[2,b]:(E=b.data,[3,11]);case 8:return C=T.sent(),d.C.error("SyncOfflineData. 同步文档异常结束",null===C||void 0===C?void 0:C.stack),[2,{resultCode:a.D.SyncOfflineDataUnknownError,subResultCode:-1,message:"SyncOfflineDataUnknownError。 同步离线数据的时候发生了未知错误 被catch住了。",error:C||new Error("SyncOfflineDataUnknownError")}];case 9:return[4,_.release("offline_"+n)];case 10:return T.sent(),[7];case 11:return d.C.log("SyncOfflineData. 结束",e,n,u,h,r),[2,{resultCode:a.D.Success,subResultCode:0,message:"Success",data:E}]}var A}))}))},t.prototype.checkUpdateInterval=function(t){return A(this,void 0,void 0,(function(){var e,n,i,s,u,c,l,p,f,h;return S(this,(function(v){switch(v.label){case 0:return e=t.padId,n=t.secretId,i=t.padType,s=t.source,u=void 0===s?"list":s,c=t.force,(l=void 0!==c&&c)?[3,2]:(p=r.he.newInstance().addCondition("globalPadId",r.E1.ONLY,e).addCondition("uid",r.E1.ONLY,this.parent.user.getUserId()),[4,this.database.get(o.me.DOCUMENT_STATUS,p)]);case 1:if((f=v.sent()).error&&!(0,r.FG)(f.error))return d.C.warn("SyncOfflineData. 查询DocumentStatus发生错误",e,n,u,l,i,f.error),[2,{resultCode:a.D.GetDocumentStatusError,subResultCode:-1,message:"数据库查询DocumentStatus发生错误",error:f.error}];if(!f.error&&(h=f.data,Date.now()-h.lastSyncTime<6e5))return d.C.warn("SyncOfflineData. RejcectByThrottle节流了",e,n,u,l,i),[2,{resultCode:a.D.RejcectByThrottleError,subResultCode:-1,message:"同步任务失败，10分钟内已经同步过了，节流下。上次同步时间 "+new Date(h.lastSyncTime)}];v.label=2;case 2:return[2,{resultCode:a.D.Success,subResultCode:-1,message:"同步任务开始"}]}}))}))},t.prototype.commitLocalFile=function(t){return A(this,void 0,void 0,(function(){var e,n,r,o,i,s,c;return S(this,(function(l){switch(l.label){case 0:return e=t.padId,n=t.secretId,r=t.source,o=t.force,i=t.padType,[4,this.getPadInfo(e)];case 1:return(s=l.sent())?!s||s.status!==u.DL.NEW&&s.status!==u.DL.LOCAL?[3,3]:[4,this.createFileWithData(e,i,s.folder)]:(d.C.error("commitLocalFile. getPadInfoError. ",e,n,r,o,i),[2,{resultCode:a.D.CreateFileError,subResultCode:-1e3,message:"commitLocalFile 查询文档PadInfo发生错误，PadInfo不存在或者数据库操作错误。"}]);case 2:if((c=l.sent()).error)return d.C.error("commitLocalFile 带数据创建文档失败",e,n,r,o,i,c.error),[2,{resultCode:a.D.CreateFileError,subResultCode:-2e3,message:"commitLocalFile 带数据创建文档失败了。",error:c.error}];l.label=3;case 3:return[2,{resultCode:a.D.Success,subResultCode:-1,message:"commitLocalFile 正常"}]}}))}))},t.prototype.commitUncommitData=function(t){var e;return A(this,void 0,void 0,(function(){var n,r,o,i,s,u,c,l,p,f;return S(this,(function(h){switch(h.label){case 0:return n=t.padId,r=t.secretId,o=t.source,i=t.force,s=t.padType,[4,this.getUnCommitedData(n)];case 1:return(u=h.sent()).error?(d.C.error(u.error),[2,{resultCode:a.D.GetUncommitDataError,subResultCode:-1,message:"commitUncommitData 查询本地未提交数据错误。",error:u.error}]):(d.C.log("commitUncommitData. 查询本地未提交离线数据",n,r,o,i,s,u.data.length),(c=u.data).length>0?[4,this.batchCommitOfflineData(n,r,c)]:[3,4]);case 2:return(l=h.sent()).resultCode!==a.D.Success?(d.C.error("commitUncommitData. 提交离线未提交数据时出错了，同步失败",n,r,o,i,s),[2,l]):(p=l.data).length>0?[4,this.updateDocUncommitedData(n,p)]:[3,4];case 3:if((f=h.sent()).error)return d.C.error("SyncOfflineData. 更新未提交数据为已提交数据出错",n,r,o,i,s,f.error,null===(e=f.error)||void 0===e?void 0:e.stack),[2,{resultCode:a.D.UpdateUnCommitedDataError,subResultCode:-1,message:"commitUncommitData 提交成功后更新数据库中本地未提交离线数据时发生错误。",error:f.error}];h.label=4;case 4:return[2,{resultCode:a.D.Success,subResultCode:-1,message:"commitUncommitData 正常"}]}}))}))},t.prototype.fetchAndStoreDocumentCache=function(t){var e,n,r,o;return A(this,void 0,void 0,(function(){var s,u,c,l,p,h,v,_,y,E,g,m,b,C,T,A,O,D,w,I,N,R,P=this;return S(this,(function(S){switch(S.label){case 0:return s=t.padId,u=t.secretId,c=t.source,l=t.force,p=t.padType,h=t.deleteOldCache,v=void 0===h||h,_=t.rev,y=t.isManualOffline,[4,this.preFetchDocData(s,u,_)];case 1:return(E=S.sent()).resultCode!==a.D.Success?(d.C.error("SyncOfflineData. 拉取新的离线数据失败, 同步失败",s,u,c,l,p,(0,f.Ei)(E)),[2,E]):(g=E.data,m=g.dver,b=g.allBlockData,C=g.rangePrivilege,d.C.log("SyncOfflineData. 第五步，删除本地离线数据&写入新的预拉数据",s,u,c,l,p),T=b.map((function(t){return P.blockData2OfflineData(t,m)})),[4,this.updateDocOfflineData(s,T,v,_)]);case 2:return(A=S.sent()).error?(d.C.error("SyncOfflineData. 写入离线缓存数据错误.",s,u,c,l,p,_,m,T.length,A.error,null===(e=A.error)||void 0===e?void 0:e.stack),[2,{resultCode:a.D.UpdatePreFetchOfflienDataError,subResultCode:-1,message:"updateDocOfflineData 操作数据库更新离线缓存数据失败",error:A.error}]):[4,this.getManualPadInfo(u)];case 3:return(!(O=S.sent()).error&&O.data||y)&&b.forEach((function(t){P.cacheImageData(t)})),C?[4,this.cacheRangePrivilege(s,C)]:[3,5];case 4:(D=S.sent())&&D.error&&d.C.error("cacheRangePrivilege. 写入离线区域权限数据错误.",null===(n=D.error)||void 0===n?void 0:n.stack),S.label=5;case 5:return w=void 0!==y?{dver:m,isOfflineCache:!0,isManualOffline:y}:{dver:m,isOfflineCache:!0},[4,this.updatePadInfo(s,w)];case 6:return(I=S.sent()).error?(d.C.error("SyncOfflineData. 增量更新padInfo错误.",s,u,c,l,p,_,m,I.error,null===(r=I.error)||void 0===r?void 0:r.stack),[2,{resultCode:a.D.UpdatePadInfoError,subResultCode:-1,message:"updatePadInfo 操作数据库更新离线PadInfo缓存数据失败",error:I.error}]):(N=new i({uid:this.parent.user.getUserId(),globalPadId:s,secretId:u,lastSyncTime:Date.now()}),[4,this.updateDocumentStatus(N)]);case 7:return(R=S.sent()).error&&d.C.error("SyncOfflineData. 更新文档Status表错误.",s,u,c,l,p,_,m,R.error,null===(o=R.error)||void 0===o?void 0:o.stack),this.parent.mapDocumentVersion(m,(0,f.KW)(p,u)),[2,{resultCode:a.D.Success,subResultCode:0,message:"fetchAndStoreDocumentCache Success",data:I.data[0]}]}}))}))},t.prototype.updateDocumentStatus=function(t){return A(this,void 0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,this.database.update(o.me.DOCUMENT_STATUS,t)];case 1:return[2,e.sent()]}}))}))},t.prototype.updatePadInfo=function(t,e){return A(this,void 0,void 0,(function(){var n;return S(this,(function(i){switch(i.label){case 0:return n=(new r.he).addCondition("globalPadId",r.E1.ONLY,t).addCondition("uid",r.E1.ONLY,this.parent.user.getUserId()),[4,this.database.updateField(o.me.PAD_INFO,n,e)];case 1:return[2,i.sent()]}}))}))},t.prototype.getUnCommitedData=function(t){return A(this,void 0,void 0,(function(){var e;return S(this,(function(n){switch(n.label){case 0:return e=r.he.newInstance().addCondition("globalPadId",r.E1.ONLY,t).addCondition("type",r.E1.IN,[s.N.COMMITING,s.N.WATTING,s.N.QUEUE]).addCondition("uid",r.E1.ONLY,this.parent.user.getUserId()),[4,this.database.getAll(o.me.OFFLINE_DATA,e)];case 1:return[2,n.sent()]}}))}))},t.prototype.clearDocOfflineData=function(t,e){return void 0===e&&(e=!0),A(this,void 0,void 0,(function(){var n,i;return S(this,(function(a){switch(a.label){case 0:return n=r.he.newInstance().addCondition("globalPadId",r.E1.ONLY,t).addCondition("uid",r.E1.ONLY,this.parent.user.getUserId()),[4,this.database.delete(o.me.OFFLINE_DATA,n)];case 1:return i=a.sent(),e?i.error?[3,3]:[4,this.database.delete(o.me.DOCUMENT_DATA,n)]:[3,8];case 2:i=a.sent(),a.label=3;case 3:return i.error?[3,5]:[4,this.database.delete(o.me.DOCUMENT_STATUS,n)];case 4:i=a.sent(),a.label=5;case 5:return i.error?[3,7]:[4,this.database.updateField(o.me.PAD_INFO,n,{isOfflineCache:!1})];case 6:i=a.sent(),a.label=7;case 7:a.label=8;case 8:return[2,i]}}))}))},t.prototype.updateDocOfflineData=function(t,e,n,i){return A(this,void 0,void 0,(function(){var a,s;return S(this,(function(u){switch(u.label){case 0:return a=r.he.newInstance().addCondition("globalPadId",r.E1.ONLY,t).addCondition("uid",r.E1.ONLY,this.parent.user.getUserId()),void 0!==i&&a.addCondition("version",r.E1.UPPER_BOUND,{upper:i,open:!1}),n?[4,this.database.deleteAndWrite(o.me.DOCUMENT_DATA,a,e)]:[3,2];case 1:case 3:return[2,u.sent()];case 2:return s=e.map((function(t){return{tableName:o.me.DOCUMENT_DATA,data:t}})),[4,this.database.updateMultiTableData(s)]}}))}))},t.prototype.composeOfflineData=function(t,e){var n=this.parent.user.getUserId(),r=e[0];return{common:{type:"USER_CHANGES",offlineMsg:!0,docid:t,uid:n,dver:r.dver,base_rev:r.type===s.N.INIT?r.version:r.data.baseVersion,code_ver:r.docType===u.Gk.EXCEL?1:0,session_type:0,gray:window._grayVersion?window._grayVersion:0,generalpacket:this.getHeaderGeneralPacket(),pver:r.docType===u.Gk.WORD?2:1,uuId:r.type===s.N.INIT?this.parent.user.getUserId():r.data.data.uuId},respective:e.filter((function(t){if(t.type!==s.N.INIT)return t})).map((function(t){var e=t.data.data,n={task_id:e.taskId,subId:e.subId,oSubId:e.oSubId||!1,head:e.head,keydata:e.keyData||!1,changeSetCount:e.changeData?1:void 0!==e.changeSetCount?e.changeSetCount:e.mutations.length,changeset:e.changeset?e.changeset:JSON.stringify(e.changeData||e.mutations||"[]"),apool:e.apool};return r.docType===u.Gk.EXCEL&&(n.changeset=n.changeset+"\n"),n}))}},t.prototype.batchCommitOfflineData=function(t,e,n){return A(this,void 0,void 0,(function(){var r,o,s,u,c,l,p;return S(this,(function(f){switch(f.label){case 0:return 0===(r=n).length?[2,{resultCode:a.D.CommitOfflineDataError,subResultCode:-1e3,message:"batchCommitOfflineData 参数错误。待提交的OfflineData数组长度为0"}]:[4,this.isCommitFailedBefore(t,n)];case 1:return f.sent()?[2,{resultCode:a.D.CommitOfflineDataError,subResultCode:-1001,message:"batchCommitOfflineData 该离线数据曾经提交过且报错"}]:(r=this.offlineDataSort(r),o=this.composeOfflineData(t,n),[4,this.commitOfflineData(t,o)]);case 2:return(s=f.sent()).error?(d.C.error(s.error),[2,{resultCode:a.D.CommitOfflineDataError,subResultCode:-2e3,message:"batchCommitOfflineData 批量提交离线数据时发生错误。",error:s.error}]):(u=s.data,0===(c=u.retcode)?(l=this.createMisschangeData(t,e,u.Data),[2,{resultCode:a.D.Success,subResultCode:-1,data:l,message:"batchCommitOfflineData 提交正常。"}]):(d.C.error("batchCommitOfflineData retcode:"+c),[40005,40003,40034].indexOf(c)>=0&&(p=new i({uid:this.parent.user.getUserId(),globalPadId:t,secretId:e,lastSyncTime:Date.now(),lastErrorTime:Date.now()}),this.updateDocumentStatus(p)),[2,{resultCode:a.D.CommitOfflineDataError,subResultCode:-2001,message:"batchCommitOfflineData 批量提交离线数据时发生错误。retCode不为0 retCode="+c}]))}}))}))},t.prototype.isCommitFailedBefore=function(t,e){return A(this,void 0,void 0,(function(){var n,i,a;return S(this,(function(s){switch(s.label){case 0:return n=r.he.newInstance().addCondition("globalPadId",r.E1.ONLY,t).addCondition("uid",r.E1.ONLY,this.parent.user.getUserId()),[4,this.database.get(o.me.DOCUMENT_STATUS,n)];case 1:return(i=s.sent()).error?[2,!1]:i.data&&i.data.lastErrorTime&&(a=i.data.lastErrorTime,!e.some((function(t){return t.createTime>a})))?[2,!0]:[2,!1]}}))}))},t.prototype.getHeaderGeneralPacket=function(){var t={};return window.__globalReleaseVersion&&(t.rel_rev=window.__globalReleaseVersion),t},t.prototype.commitOfflineData=function(t,e){return A(this,void 0,void 0,(function(){var n,r;return S(this,(function(o){return n="/dop-api/commitchanges?padId="+t+"&xsrf="+(0,f.fM)(),r=JSON.stringify(e),r=encodeURIComponent(r),[2,c.hS.sendCommonRequest(n,c.n$.POST,"data="+r)]}))}))},t.prototype.getGlobalPadIdBySecretId=function(t,e,n){return void 0===n&&(n=!0),A(this,void 0,void 0,(function(){var r,i;return S(this,(function(a){switch(a.label){case 0:return[4,this.getPadInfo(t,o.tA.SECRET)];case 1:return(r=a.sent())?[2,r.globalPadId]:[4,this.getClientVarsBySecretId(t,e,n)];case 2:return(i=a.sent()).error?[2,void 0]:[2,i.data.globalPadId]}}))}))},t.prototype.getClientVarsBySecretId=function(t,e,n){return void 0===n&&(n=!0),A(this,void 0,void 0,(function(){var o,i,a,s;return S(this,(function(u){switch(u.label){case 0:return[4,c.hS.fetchDocData(t,e,n)];case 1:if((o=u.sent()).error)return[2,new r.x4(o.error)];i=o.data,u.label=2;case 2:return u.trys.push([2,4,,5]),"blankpage"===(a=this.convertDataToClientVars(i)).padType||!0===a.isBlankPage?(d.C.error("文档数据不存在，或者无权限"),[2,new r.x4(new Error("FileNotExsit"))]):[4,this.createPadInfoFromClientVars(a)];case 3:return u.sent(),[2,new r.x4(void 0,a)];case 4:return s=u.sent(),d.C.error("解析后台预拉数据异常",s),[2,new r.x4(s||new Error("ParseResponseError"))];case 5:return[2]}}))}))},t.prototype.convertDataToClientVars=function(t){var e=this.unpackEjsData(t);if(e){var n=e.head.value;if(e.text&&e.text.value){var r=n.needEscape?escape(e.text.value):e.text.value;n.clientVars.collab_client_vars.initialAttributedText.text=r,n.clientVars.collab_client_vars.initialAttributedText.attribs=e.attribs.value}return n.clientVars}},t.prototype.unpackEjsData=function(t){for(var e=0,n=t||"",r=n.length,o={text:{type:"",value:null},attribs:{type:"",value:null},head:{type:"",value:null}};e<r;){var i=n.slice(e,e+50).split("\n");if(!(i&&i.length>=3))break;var a=i[0],s=i[1],u=parseInt(i[2],10);e+=i[0].length+i[1].length+i[2].length+3;var c=n.slice(e,e+u);e+=u+1,"text"===a?(o.text.type=s,o.text.value="json"===s?JSON.parse(c):c):"head"===a?(o.head.type=s,o.head.value="json"===s?JSON.parse(c):c):"attribs"===a&&(o.attribs.type=s,o.attribs.value="json"===s?JSON.parse(c):c)}return o},t.prototype.checkVersionUpdate=function(t,e){return A(this,void 0,void 0,(function(){var n,r,o;return S(this,(function(i){switch(i.label){case 0:return n=this.getTypeStringWithPadType(t),r="https://docs.qq.com/cgi/gateway/dver/gray?padId="+e+"&type="+n,[4,c.hS.sendCommonRequest(r,c.n$.GET,void 0,"custom")];case 1:return(o=i.sent()).error&&d.C.error("checkVersionUpdate error.",o.error),d.C.log("checkVersionUpdate. response=",o.data),[2,o]}}))}))},t.prototype.preFetchDocData=function(t,e,n){return A(this,void 0,void 0,(function(){var r,o,i;return S(this,(function(a){switch(a.label){case 0:return r=this.getFetchUrl(t,e,n),[4,c.hS.sendCommonRequest(r,c.n$.GET,void 0,"custom")];case 1:return(o=a.sent()).error?[2,this.handleCommonRequestError(o)]:(i=o.data,[2,this.handlePreFetchDocData(t,i)])}}))}))},t.prototype.handleCommonRequestError=function(t){return"HttpError"===t.error.errorType?{resultCode:a.D.PreFetchDocDataError,subResultCode:t.error.statusCode,message:"Prefetch Data请求遇到HttpError",error:t.error}:"TimeOutError"===t.error.message?{resultCode:a.D.PreFetchDocDataError,subResultCode:-200801,message:"Prefetch Data请求超时",error:t.error}:{resultCode:a.D.PreFetchDocDataError,subResultCode:-200802,message:"Prefetch Data请求遇到其他错误",error:t.error}},t.prototype.getSubBlockList=function(t){return this.parseHeadersFromClientVars(t)},t.prototype.pushState=function(t,e){var n=window.history;try{e?n.replaceState(null,"",t):n.pushState(null,"",t)}catch(r){window.location[e?"replace":"assign"](t)}},t.prototype.isFileCreated=function(t){return A(this,void 0,void 0,(function(){var e;return S(this,(function(n){switch(n.label){case 0:return[4,this.getPadInfo(t,o.tA.GLOBAL)];case 1:return(e=n.sent())?e.status===u.DL.NORMAL?[2,new r.x4(void 0,!0)]:[2,new r.x4(void 0,!1)]:(d.C.error("文档基本信息不存在"),[2,new r.x4(new Error("FileNotExsit"))])}}))}))},t.prototype.createFileWithData=function(t,e,n){return void 0===e&&(e=u.Gk.EXCEL),void 0===n&&(n="/"),A(this,void 0,void 0,(function(){return S(this,(function(r){return[2,this.createFile(t,e,!0,n)]}))}))},t.prototype.createFile=function(t,e,n,i){var a;return void 0===e&&(e=u.Gk.EXCEL),void 0===n&&(n=!0),A(this,void 0,void 0,(function(){var s,l,p,f,v,_,y,E,g,m,T,A,O,D,w,I,N;return S(this,(function(S){switch(S.label){case 0:return s=e,[4,this.getPadInfo(t,o.tA.GLOBAL)];case 1:return(l=S.sent())?l.status===u.DL.NORMAL?(d.C.error("已经创建过该文档了，不用再创建了",t),[2,new r.x4(new Error("AlreadyCreatedError"))]):[4,this.getLocalCreateFileData(t,n)]:(d.C.error("获取文档padInfo失败了",t),[2,new r.x4(new Error("NoPadInfoError"))]);case 2:return(p=S.sent()).error?(d.C.error(p.error,"读取文档离线未提交数据失败"),[2,p]):(f=p.data,v=this.generateCreateFileBody({globalPadId:t,docType:s,folderId:i,withData:n},l,f),[4,c.hS.sendCommonRequest("/cgi-bin/online_docs/createdoc_new",c.n$.POST,v)]);case 3:return(_=S.sent()).error?(d.C.error(_.error,"创建文档请求失败"),[2,_]):(y=_.data,d.C.info("create file response:",JSON.stringify(y)),0!==y.retcode?(d.C.error("创建文档失败"),[2,new r.x4(new Error("CreatFileError"),y)]):!0!==y.is_doc_id_dup?[3,10]:y.is_dup_id_owner?(d.C.error("后台返回文档 id 重复，且是和自己的文档 id 重复"),[2,new r.x4(new r.oo(0,10034,"DocumentIdDuplicated"),{retcode:10033,url:y.doc_url})]):[4,this.getUncommitedOfflineData()]);case 4:return(E=S.sent()).error?(d.C.error("后台返回文档 id 重复，备份离线数据时加载离线数据异常"),[2,new r.x4(new Error("DocumentIdDuplicated 加载离线数据异常原因: "+(null===(a=E.error)||void 0===a?void 0:a.message)),{retcode:10033,url:y.doc_url})]):[4,b(function(t){return t.map((function(t){return new h.TU(C(C({},t),{data:t.data,subId:t.subSheetId,dataVersion:t.dver,type:t.type,docType:t.docType,docStatus:t.padStatus,createTimestamp:t.createTime,isDefaultChunk:t.default}))}))}(E.data))];case 5:return g=S.sent(),d.C.info("后台返回文档 id 重复，备份离线数据, result = "+g),m=r.he.newInstance().addCondition("globalPadId",r.E1.ONLY,t).addCondition("uid",r.E1.ONLY,this.parent.user.getUserId()),[4,this.database.delete(o.me.PAD_INFO,m)];case 6:return S.sent(),[4,this.database.delete(o.me.OFFLINE_DATA,m)];case 7:return S.sent(),[4,this.database.delete(o.me.DOCUMENT_DATA,m)];case 8:return S.sent(),[4,this.database.delete(o.me.DOCUMENT_STATUS,m)];case 9:return S.sent(),[2,new r.x4(new r.oo(0,10033,"DocumentIdDuplicated"),{retcode:10033,url:y.doc_url})];case 10:return T=Date.now(),l.status=u.DL.NORMAL,l.last_modify_ts=T,l.lastSyncTime=T,[4,this.getDefaultDocData(t,o.tA.GLOBAL)];case 11:return(A=S.sent()).error?[2,A]:(O=A.data.data,y.miss_changes&&(e===u.Gk.EXCEL||e===u.Gk.WORD&&n)&&(D=this.createMisschangeData(t,l.secretId||O.data.collab_client_vars.client.upid,JSON.parse(y.miss_changes))).length>0?[4,this.updateDocUncommitedData(t,D)]:[3,13]);case 12:if((w=S.sent()).error)return d.C.error(w.error),[2,w];S.label=13;case 13:return O.isTemp=!1,[4,this.updateClientVarsSocketInfo(t,O)];case 14:return(I=S.sent()).error?[2,I]:(e===u.Gk.WORD&&(I.data.collab_client_vars.rev=0),I.data.isLocalDoc=!1,I.data.padStatus=u.DL.NORMAL,N=this.clientVars2OfflineData(t,I.data,!0),[4,this.database.updateMultiTableData([{tableName:o.me.PAD_INFO,data:l},{tableName:o.me.DOCUMENT_DATA,data:N}])]);case 15:return S.sent(),[2,new r.x4(void 0,{retcode:0,data:I.data})]}}))}))},t.prototype.generateCreateFileBody=function(t,e,n){var r,o,i=t.globalPadId,a=t.docType,c=t.folderId,l=t.withData;if(d.C.info("generateCreateFileBody"),n.length>0&&a===u.Gk.WORD){var p=n[0];if(p.type===s.N.INIT){var h=p.data.collab_client_vars;d.C.info("generateCreateFileBody before:",JSON.stringify(h)),h.dver.startsWith("3.0.")&&!h.initialAttributedText.text&&(h.initialAttributedText.text="%7B%22commands%22%3A%5B%7B%22type%22%3A%22kDocExtracCmdFromDoc%22%2C%22mutations%22%3A%5B%7B%22ty%22%3A%22is%22%2C%22bi%22%3A0%2C%22s%22%3A%22%5Cr%5Cr%5Cu000f%5Cu001e%5Cu001e%5Cu001e%5Cu001e%5Cu001e%5Cu001e%5Cu001e%22%7D%2C%7B%22ty%22%3A%22mp%22%2C%22bi%22%3A0%2C%22ei%22%3A1%2C%22pr%22%3A%7B%22run%22%3A%7B%22author%22%3A%22p.833496%22%2C%22isPlaceholder%22%3Atrue%7D%7D%2C%22mt%22%3A%22run%22%7D%2C%7B%22ty%22%3A%22mp%22%2C%22bi%22%3A1%2C%22ei%22%3A2%2C%22pr%22%3A%7B%22run%22%3A%7B%22isPlaceholder%22%3Atrue%7D%7D%2C%22mt%22%3A%22run%22%7D%2C%7B%22ty%22%3A%22mp%22%2C%22bi%22%3A2%2C%22ei%22%3A3%2C%22pr%22%3A%7B%22run%22%3A%7B%22isPlaceholder%22%3Atrue%7D%7D%2C%22mt%22%3A%22run%22%7D%2C%7B%22ty%22%3A%22mp%22%2C%22bi%22%3A3%2C%22ei%22%3A4%2C%22pr%22%3A%7B%22run%22%3A%7B%22isPlaceholder%22%3Atrue%7D%7D%2C%22mt%22%3A%22run%22%7D%2C%7B%22ty%22%3A%22mp%22%2C%22bi%22%3A4%2C%22ei%22%3A5%2C%22pr%22%3A%7B%22run%22%3A%7B%22isPlaceholder%22%3Atrue%7D%7D%2C%22mt%22%3A%22run%22%7D%2C%7B%22ty%22%3A%22mp%22%2C%22bi%22%3A5%2C%22ei%22%3A6%2C%22pr%22%3A%7B%22run%22%3A%7B%22isPlaceholder%22%3Atrue%7D%7D%2C%22mt%22%3A%22run%22%7D%2C%7B%22ty%22%3A%22mp%22%2C%22bi%22%3A6%2C%22ei%22%3A7%2C%22pr%22%3A%7B%22run%22%3A%7B%22isPlaceholder%22%3Atrue%7D%7D%2C%22mt%22%3A%22run%22%7D%2C%7B%22ty%22%3A%22mp%22%2C%22bi%22%3A7%2C%22ei%22%3A8%2C%22pr%22%3A%7B%22run%22%3A%7B%22isPlaceholder%22%3Atrue%7D%7D%2C%22mt%22%3A%22run%22%7D%2C%7B%22ty%22%3A%22mp%22%2C%22bi%22%3A8%2C%22ei%22%3A9%2C%22pr%22%3A%7B%22run%22%3A%7B%22isPlaceholder%22%3Atrue%7D%7D%2C%22mt%22%3A%22run%22%7D%2C%7B%22ty%22%3A%22mp%22%2C%22bi%22%3A9%2C%22ei%22%3A10%2C%22pr%22%3A%7B%22run%22%3A%7B%22isPlaceholder%22%3Atrue%7D%7D%2C%22mt%22%3A%22run%22%7D%2C%7B%22ty%22%3A%22mp%22%2C%22bi%22%3A0%2C%22ei%22%3A1%2C%22pr%22%3A%7B%22paragraph%22%3A%7B%22pStyle%22%3A%7B%22val%22%3A%22rdbvau%22%7D%2C%22numPr%22%3A%7B%7D%2C%22jc%22%3A%7B%22val%22%3A%22STJcWml_left%22%7D%2C%22rPr%22%3A%7B%7D%7D%7D%2C%22mt%22%3A%22paragraph%22%7D%2C%7B%22ty%22%3A%22mp%22%2C%22bi%22%3A1%2C%22ei%22%3A2%2C%22pr%22%3A%7B%22paragraph%22%3A%7B%22pStyle%22%3A%7B%22val%22%3A%22ablt93%22%7D%2C%22taskPr%22%3A%7B%7D%2C%22rPr%22%3A%7B%7D%7D%7D%2C%22mt%22%3A%22paragraph%22%7D%2C%7B%22ty%22%3A%22mp%22%2C%22bi%22%3A2%2C%22ei%22%3A3%2C%22pr%22%3A%7B%22paragraph%22%3A%7B%22isPlaceholder%22%3Atrue%7D%7D%2C%22mt%22%3A%22paragraph%22%7D%2C%7B%22ty%22%3A%22mp%22%2C%22bi%22%3A3%2C%22ei%22%3A4%2C%22pr%22%3A%7B%22paragraph%22%3A%7B%22isPlaceholder%22%3Atrue%7D%7D%2C%22mt%22%3A%22paragraph%22%7D%2C%7B%22ty%22%3A%22mp%22%2C%22bi%22%3A4%2C%22ei%22%3A5%2C%22pr%22%3A%7B%22paragraph%22%3A%7B%22isPlaceholder%22%3Atrue%7D%7D%2C%22mt%22%3A%22paragraph%22%7D%2C%7B%22ty%22%3A%22mp%22%2C%22bi%22%3A5%2C%22ei%22%3A6%2C%22pr%22%3A%7B%22paragraph%22%3A%7B%22isPlaceholder%22%3Atrue%7D%7D%2C%22mt%22%3A%22paragraph%22%7D%2C%7B%22ty%22%3A%22mp%22%2C%22bi%22%3A6%2C%22ei%22%3A7%2C%22pr%22%3A%7B%22paragraph%22%3A%7B%22isPlaceholder%22%3Atrue%7D%7D%2C%22mt%22%3A%22paragraph%22%7D%2C%7B%22ty%22%3A%22mp%22%2C%22bi%22%3A7%2C%22ei%22%3A8%2C%22pr%22%3A%7B%22paragraph%22%3A%7B%22isPlaceholder%22%3Atrue%7D%7D%2C%22mt%22%3A%22paragraph%22%7D%2C%7B%22ty%22%3A%22mp%22%2C%22bi%22%3A8%2C%22ei%22%3A9%2C%22pr%22%3A%7B%22paragraph%22%3A%7B%22isPlaceholder%22%3Atrue%7D%7D%2C%22mt%22%3A%22paragraph%22%7D%2C%7B%22ty%22%3A%22mp%22%2C%22bi%22%3A9%2C%22ei%22%3A10%2C%22pr%22%3A%7B%22paragraph%22%3A%7B%22isPlaceholder%22%3Atrue%7D%7D%2C%22mt%22%3A%22paragraph%22%7D%2C%7B%22ty%22%3A%22mp%22%2C%22bi%22%3A2%2C%22ei%22%3A3%2C%22pr%22%3A%7B%22section%22%3A%7B%22pgSz%22%3A%7B%22w%22%3A11905%2C%22h%22%3A16838%7D%2C%22pgMar%22%3A%7B%22top%22%3A1361%2C%22right%22%3A1417%2C%22bottom%22%3A1361%2C%22left%22%3A1417%7D%7D%7D%2C%22mt%22%3A%22section%22%7D%2C%7B%22ty%22%3A%22mp%22%2C%22bi%22%3A3%2C%22ei%22%3A4%2C%22pr%22%3A%7B%22story%22%3A%7B%22storyType%22%3A%22STStoryType_mainDocument%22%7D%7D%2C%22mt%22%3A%22story%22%7D%2C%7B%22ty%22%3A%22mp%22%2C%22bi%22%3A4%2C%22ei%22%3A5%2C%22pr%22%3A%7B%22story%22%3A%7B%22storyType%22%3A%22STStoryType_headerContent%22%7D%7D%2C%22mt%22%3A%22story%22%7D%2C%7B%22ty%22%3A%22mp%22%2C%22bi%22%3A5%2C%22ei%22%3A6%2C%22pr%22%3A%7B%22story%22%3A%7B%22storyType%22%3A%22STStoryType_footerContent%22%7D%7D%2C%22mt%22%3A%22story%22%7D%2C%7B%22ty%22%3A%22mp%22%2C%22bi%22%3A6%2C%22ei%22%3A7%2C%22pr%22%3A%7B%22story%22%3A%7B%22storyType%22%3A%22STStoryType_footnoteContent%22%7D%7D%2C%22mt%22%3A%22story%22%7D%2C%7B%22ty%22%3A%22mp%22%2C%22bi%22%3A7%2C%22ei%22%3A8%2C%22pr%22%3A%7B%22story%22%3A%7B%22storyType%22%3A%22STStoryType_endnoteContent%22%7D%7D%2C%22mt%22%3A%22story%22%7D%2C%7B%22ty%22%3A%22mp%22%2C%22bi%22%3A8%2C%22ei%22%3A9%2C%22pr%22%3A%7B%22story%22%3A%7B%22storyType%22%3A%22STStoryType_commentContent%22%7D%7D%2C%22mt%22%3A%22story%22%7D%2C%7B%22ty%22%3A%22mp%22%2C%22bi%22%3A9%2C%22ei%22%3A10%2C%22pr%22%3A%7B%22story%22%3A%7B%22storyType%22%3A%22STStoryType_textboxContent%22%7D%7D%2C%22mt%22%3A%22story%22%7D%2C%7B%22ty%22%3A%22ms%22%2C%22pr%22%3A%7B%22numbering%22%3A%7B%7D%7D%2C%22mt%22%3A%22numbering%22%7D%2C%7B%22ty%22%3A%22ms%22%2C%22pr%22%3A%7B%22background%22%3A%7B%7D%7D%2C%22mt%22%3A%22background%22%7D%2C%7B%22ty%22%3A%22ms%22%2C%22pr%22%3A%7B%22themes%22%3A%7B%7D%7D%2C%22mt%22%3A%22themes%22%7D%2C%7B%22ty%22%3A%22ms%22%2C%22pr%22%3A%7B%22fonts%22%3A%7B%7D%7D%2C%22mt%22%3A%22fonts%22%7D%2C%7B%22ty%22%3A%22ms%22%2C%22pr%22%3A%7B%22styles%22%3A%7B%22style%22%3A%7B%22ablt93%22%3A%7B%22name%22%3A%7B%22val%22%3A%22Normal%22%7D%2C%22basedOn%22%3A%7B%22val%22%3A%22%22%7D%2C%22next%22%3A%7B%22val%22%3A%22%22%7D%2C%22pPr%22%3A%7B%22widowControl%22%3A%7B%22val%22%3Afalse%7D%2C%22jc%22%3A%7B%22val%22%3A%22STJcWml_left%22%7D%7D%2C%22type%22%3A%22STStyleType_paragraph%22%2C%22styleId%22%3A%22ablt93%22%2C%22defaultKeyword%22%3Atrue%7D%2C%22rdbvau%22%3A%7B%22name%22%3A%7B%22val%22%3A%22Title%22%7D%2C%22basedOn%22%3A%7B%22val%22%3A%22vevutl%22%7D%2C%22next%22%3A%7B%22val%22%3A%22ablt93%22%7D%2C%22uiPriority%22%3A%7B%22val%22%3A9%7D%2C%22qFormat%22%3A%7B%22val%22%3Atrue%7D%2C%22pPr%22%3A%7B%22keepNext%22%3A%7B%22val%22%3Atrue%7D%2C%22keepLines%22%3A%7B%22val%22%3Atrue%7D%2C%22spacing%22%3A%7B%22before%22%3A0%2C%22after%22%3A0%2C%22line%22%3A408%2C%22lineRule%22%3A%22STLineSpacingRule_auto%22%7D%2C%22jc%22%3A%7B%22val%22%3A%22STJcWml_center%22%7D%2C%22outlineLvl%22%3A%7B%22val%22%3A0%7D%7D%2C%22rPr%22%3A%7B%22b%22%3A%7B%22val%22%3Atrue%7D%2C%22bCs%22%3A%7B%22val%22%3Atrue%7D%2C%22color%22%3A%7B%22val%22%3A%221A1A1A%22%7D%2C%22sz%22%3A%7B%22val%22%3A480%7D%2C%22szCs%22%3A%7B%22val%22%3A480%7D%7D%2C%22type%22%3A%22STStyleType_paragraph%22%2C%22styleId%22%3A%22rdbvau%22%7D%2C%22vevutl%22%3A%7B%22name%22%3A%7B%22val%22%3A%22Normal%22%7D%2C%22basedOn%22%3A%7B%22val%22%3A%22%22%7D%2C%22next%22%3A%7B%22val%22%3A%22%22%7D%2C%22pPr%22%3A%7B%22widowControl%22%3A%7B%22val%22%3Afalse%7D%2C%22jc%22%3A%7B%22val%22%3A%22STJcWml_left%22%7D%7D%2C%22type%22%3A%22STStyleType_paragraph%22%2C%22styleId%22%3A%22vevutl%22%2C%22defaultKeyword%22%3Atrue%7D%7D%7D%7D%2C%22mt%22%3A%22styles%22%7D%2C%7B%22ty%22%3A%22ms%22%2C%22pr%22%3A%7B%22settings%22%3A%7B%7D%7D%2C%22mt%22%3A%22settings%22%7D%2C%7B%22ty%22%3A%22ms%22%2C%22pr%22%3A%7B%22webSettings%22%3A%7B%7D%7D%2C%22mt%22%3A%22webSettings%22%7D%5D%7D%5D%7D"),d.C.info("generateCreateFileBody after:",JSON.stringify(h)),r=encodeURIComponent(JSON.stringify(T(T({},h.initialAttributedText),{text:JSON.parse(unescape(h.initialAttributedText.text))}))),o=JSON.stringify(h.apool)}}var v,_=Math.max.apply(Math,n.map((function(t){return t.createTime}))),y=Math.floor(_/1e3);if(n.length>0){var E=this.offlineDataSort(n),g=this.composeOfflineData(i,l?E:[E[0]]);v=encodeURIComponent(JSON.stringify(g))}var m=c||e.folder||"/";d.C.log("createFile folder_id:",m);var b="string"===typeof i?i.split("$")[0]:"";return"create_type=11&pad_id="+("string"===typeof i?i.split("$")[1]:"")+"&domain_id="+b+"&doc_type="+a+"&templateId=0&xsrf="+(0,f.fM)()+"&version=2.0.0&folder_id="+m+"&title="+e.title+"&last_browse_ts="+y+(e.isUserChangeTitle?"&disable_auto_rename=1":"")+(r?"&atext="+r:"")+(o?"&apool="+o:"")+(v?"&data="+v:"")},t.prototype.updateOfflineDataBaseVersion=function(t,e,n){},t.prototype.updateClientVarsSocketInfo=function(t,e){return A(this,void 0,void 0,(function(){var n,o,i,a,s,u;return S(this,(function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),n=e.collab_client_vars.rev,o=e.collab_client_vars.padSubId,i=e.collab_client_vars.client.upid,[4,this.preFetchSingleSubBlockData(t,i,o,n)];case 1:return(a=c.sent()).error?[2,a]:(s=a.data.data,e.collab_client_vars.client=Object.assign(s.collab_client_vars.client,{upid:i}),e.collab_client_vars.pver=s.collab_client_vars.pver,e.collab_client_vars.apid=s.collab_client_vars.apid,e.collab_client_vars.wmode=s.collab_client_vars.wmode,e.collab_client_vars.websocketReopenCount=s.collab_client_vars.websocketReopenCount,e.collab_client_vars.pollingAttemptNumber=s.collab_client_vars.pollingAttemptNumber,e.userInfo=s.userInfo,[2,new r.x4(void 0,e)]);case 2:return u=c.sent(),[2,new r.x4(u)];case 3:return[2]}}))}))},t.prototype.getPadInfo=function(t,e){return void 0===e&&(e=o.tA.GLOBAL),A(this,void 0,void 0,(function(){var n,i;return S(this,(function(a){switch(a.label){case 0:switch(n=r.he.newInstance().addCondition("uid",r.E1.ONLY,this.parent.user.getUserId()),e){case o.tA.GLOBAL:n.addCondition("globalPadId",r.E1.ONLY,t);break;case o.tA.SECRET:n.addCondition("secretId",r.E1.ONLY,t)}return[4,this.database.get(o.me.PAD_INFO,n)];case 1:return(i=a.sent()).error?(d.C.error(i.error),[2,null]):[2,i.data]}}))}))},t.prototype.storeNewDocData=function(t,e,n,r,i,a){var s;return void 0===a&&(a=!1),A(this,void 0,void 0,(function(){var c,l,p,f,h,v,_;return S(this,(function(y){switch(y.label){case 0:return c=Date.now()/1e3,l=i.isManualOffline,p=i.isUserChangeTitle,(f=this.generatorPadInfo({globalPadId:n,localPadId:i.localPadId,secretId:r,padType:t,folder:e,dver:i.collab_client_vars.dver,initTitle:i.padTitle,time:c,isShareme:a,isManualOffline:l,isUserChangeTitle:p>0,status:u.DL.LOCAL})).creator_domain=this.getDomainId(n),(h=this.clientVars2OfflineData(n,i,!0)).padStatus=u.DL.LOCAL,v={globalPadId:n,secretId:r,uid:f.uid,lastSyncTime:c},[4,this.database.updateMultiTableData([{tableName:o.me.PAD_INFO,data:f},{tableName:o.me.DOCUMENT_DATA,data:h},{tableName:o.me.DOCUMENT_STATUS,data:v}])];case 1:return(_=y.sent()).error?(d.C.error("storeNewDocData 写入新文档数据发生异常",null===(s=_.error)||void 0===s?void 0:s.stack),[2,_]):[2,_]}}))}))},t.prototype.preCreateDoc=function(){return A(this,void 0,void 0,(function(){var t,e,n,i;return S(this,(function(a){switch(a.label){case 0:return(t=r.he.newInstance()).addCondition("isCreated",r.E1.ONLY,!1),[4,this.database.getAll(o.me.NEW_DOCUMENT_ID,t)];case 1:return(e=a.sent()).error&&!(0,r.FG)(e.error)?[2,e]:(n=e.data)&&n.length>D?[2,this.preCreateDefaultClientVars(n)]:[4,this.parent.preFetchDocIds()];case 2:return(i=a.sent()).error?(d.C.error(i.error,"预拉异常"),[2,null]):[2,this.preCreateDoc()]}}))}))},t.prototype.updatePreFetchIdInfo=function(t){return A(this,void 0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return(new r.he).addCondition("globalPadId",r.E1.ONLY,t.globalPadId),[4,this.database.updateMultiTableData([{tableName:o.me.NEW_DOCUMENT_ID,data:t}])];case 1:return e.sent(),[2]}}))}))},t.prototype.checkLocalClientVars=function(){return A(this,void 0,void 0,(function(){var t,e,n,i;return S(this,(function(a){switch(a.label){case 0:return t=[u.Gk.WORD,u.Gk.EXCEL,u.Gk.SLIDE],e=r.he.newInstance().addCondition("docType",r.E1.IN,t).addCondition("padStatus",r.E1.ONLY,u.DL.NEW).addCondition("uid",r.E1.ONLY,this.parent.user.getUserId()),n=new r.x4(void 0,{DocNum:0,ExcelNum:0,SlideNum:0}),[4,this.database.getAll(o.me.DOCUMENT_DATA,e)];case 1:return(i=a.sent()).error?(d.C.error(i.error,"读取本地预创建文档数据失败"),n.error=i.error,[2,n]):(i&&i.data&&i.data.forEach((function(t){t.docType===u.Gk.EXCEL?n.data.ExcelNum=n.data.ExcelNum+1:t.docType===u.Gk.WORD?n.data.DocNum=n.data.DocNum+1:t.docType===u.Gk.SLIDE&&(n.data.SlideNum=n.data.SlideNum+1)})),[2,n])}}))}))},t.prototype.updateFolderChildren=function(t,e){var n;return void 0===t&&(t="/"),A(this,void 0,void 0,(function(){var i,a;return S(this,(function(s){switch(s.label){case 0:return(i=new r.he).addCondition("key",r.E1.IN,[this.parent.user.getUserId()+t]),[4,this.database.get(o.me.FOLDER_INFO,i)];case 1:return(a=s.sent()).error?(d.C.error("updateFolderChildren() getPadInfo error。",null===(n=a.error)||void 0===n?void 0:n.stack),[2,new r.x4(new Error("GetPadInfoError"))]):(a.data.childrenKey||(a.data.childrenKey=[]),a.data.childrenKey.push(e),[2,this.database.update(o.me.FOLDER_INFO,a.data)])}}))}))},t.prototype.getDomainId=function(t){return t.split("$")&&t.split("$").length?t.split("$")[0]:""},t.prototype.getDefaultInitTitle=function(t){var e="无标题文档";switch(t){case u.Gk.WORD:e="无标题文档";break;case u.Gk.EXCEL:e="无标题表格";break;case u.Gk.SLIDE:e="无标题幻灯片"}return e},t.prototype.generatorPadInfo=function(t){var e=t.globalPadId,n=t.secretId,r=t.localPadId,o=t.padType,i=t.folder,a=t.dver,s=t.time,c=void 0===s?Date.now()/1e3:s,l=t.isShareme,d=void 0!==l&&l,p=t.status,f=t.isManualOffline,h=void 0!==f&&f,v=t.isUserChangeTitle,_=void 0!==v&&v,y=new u.BG(this.parent.user),E=this.parent.user.getUserId()+e,g=this.getDomainId(e);return T(T({},y),{key:E,type:o,uid:this.parent.user.getUserId(),globalPadId:e,domain_id:g,secretId:n,title:t.initTitle||this.getDefaultInitTitle(o),pad_id:r,status:p||u.DL.NEW,creator:this.parent.user.getUserId(),create_ts:c,doc_type:o,isMydoc:!0,isMyCreated:!0,isRencent:!0,isShareme:!0===d,isOfflineCache:!0,isManualOffline:h,isUserChangeTitle:_,dver:a,doc_type_desc:u.Yk[o],doc_url:"//docs.qq.com/"+u.Yk[o]+"/"+n,folder:i,privilege:0,last_modify_ts:c,last_browse_ts:c})},t.prototype.createPadInfo=function(t,e,n){return A(this,void 0,void 0,(function(){var i,a,s,u,c,l;return S(this,(function(p){switch(p.label){case 0:return(i=r.he.newInstance()).addCondition("isCreated",r.E1.IN,[!0]),i.addCondition("padType",r.E1.ONLY,t),[4,this.database.get(o.me.NEW_DOCUMENT_ID,i)];case 1:return(a=p.sent()).error?((i=r.he.newInstance()).addCondition("isCreated",r.E1.ONLY,!1),[4,this.database.get(o.me.NEW_DOCUMENT_ID,i)]):[3,6];case 2:return(a=p.sent()).error?[4,this.preCreateDoc()]:[3,5];case 3:return p.sent(),(i=r.he.newInstance()).addCondition("isCreated",r.E1.IN,[!0]),i.addCondition("padType",r.E1.ONLY,t),[4,this.database.get(o.me.NEW_DOCUMENT_ID,i)];case 4:return[2,a=p.sent()];case 5:a.data&&this.createDefaultClientVarsAndWriteDB(a.data),p.label=6;case 6:return this.parent.user&&this.parent.user.getUserId()?(s=a.data)?(u=this.getDverWithPadType(t),c=Date.now()/1e3,l=this.generatorPadInfo({globalPadId:s.globalPadId,secretId:s.secretId,localPadId:s.localPadId,padType:t,folder:e,dver:u,time:c,isShareme:n}),i=r.he.newInstance().addCondition("globalPadId",r.E1.ONLY,s.globalPadId),[4,this.database.delete(o.me.NEW_DOCUMENT_ID,i)]):(d.C.error({retcode:-1,reason:"indexDB has not NewDocumentIds!"}),[2,new r.x4(new Error("NoAvaliableIdError"))]):[2,new r.x4(new Error("UidError"))];case 7:return p.sent(),[4,this.database.set(o.me.PAD_INFO,l)];case 8:return p.sent(),[4,this.updateFolderChildren(e,l.key)];case 9:return p.sent(),this.preCreateDoc(),[2,new r.x4(void 0,l)]}}))}))},t.prototype.createPadInfoFromClientVars=function(t){return A(this,void 0,void 0,(function(){var e,n;return S(this,(function(r){switch(r.label){case 0:return e=t.globalPadId,[4,this.getPadInfo(e)];case 1:return r.sent()||(n=this.buildPadInfo(t))&&(d.C.log("更新padInfo：",n),this.database.set(o.me.PAD_INFO,n)),[2]}}))}))},t.prototype.getManualPadInfo=function(t){return A(this,void 0,void 0,(function(){var e,n,i;return S(this,(function(a){switch(a.label){case 0:return e=this.parent.user.getUserId(),n=r.he.newInstance().addCondition("uid",r.E1.ONLY,e).addCondition("isManualOffline",r.E1.ONLY,!0).addCondition("secretId",r.E1.ONLY,t),[4,this.database.get(o.me.PAD_INFO,n)];case 1:return(i=a.sent()).error&&d.C.error("查询失败",i.error),[2,i]}}))}))},t.prototype.setDefaultCodeVersion=function(t,e){this.defaultCodeVersion.set(t,e),localStorage.setItem(t+"_code_version",e)},t.prototype.getCodeVersion=function(t){return this.defaultCodeVersion.get(t)||localStorage.getItem(t+"_code_version")||""},t.prototype.getDverWithPadType=function(t){return t===u.Gk.EXCEL?this.getCodeVersion("sheet"):t===u.Gk.WORD?this.getCodeVersion("doc"):t===u.Gk.SLIDE?this.getCodeVersion("slide"):void 0},t.prototype.getTypeStringWithPadType=function(t){return t===u.Gk.EXCEL?"sheet":t===u.Gk.WORD?"word":t===u.Gk.SLIDE?"slide":void 0},t}()},64859:function(t,e,n){"use strict";n.d(e,{l6:function(){return o},hS:function(){return d.hS},h6:function(){return y},Iv:function(){return i.Iv},Gk:function(){return u.Gk},RR:function(){return i.RR},Zb:function(){return p.Z},Nt:function(){return s.N},V0:function(){return T},TU:function(){return s.T},Sg:function(){return _},DL:function(){return u.DL},E1:function(){return i.E1},he:function(){return i.he},DW:function(){return A.D},me:function(){return a.me},ao:function(){return c}});var r,o,i=n(9578),a=n(34960),s=n(81289),u=n(96331),c=function(){function t(t){this.uid=t.uid||"",this.uin=t.uin?t.uin:"",this.loginTime=(new Date).getTime()}return t.prototype.getUserId=function(){return this.uid},t.prototype.setUserId=function(t){this.uid=t},t}(),l=(n(41795),function(){function t(){}t.convertData2ClientVars=function(t){},t.unpackEjsData=function(t){for(var e=0,n=t||"",r=n.length,o={};e<r;){var i=n.slice(e,e+50).split("\n");if(!(i&&i.length>=3))break;var a=i[0],s=i[1],u=parseInt(i[2]);e+=i[0].length+i[1].length+i[2].length+3;var c=n.slice(e,e+u);e+=u+1,o[a]={type:s},o[a].value="json"===s?JSON.parse(c):c}return o},t.updateClientVarsByEditPadInfo=function(t,e){t&&t.globalPadId===e.padInfo.globalPadId&&(e.privilegeAttribute&&(t.privilegeAttribute=e.privilegeAttribute),e.advPolicy&&(t.advPolicy=e.advPolicy),e.title&&(t.padTitle=e.title))}}(),n(30414)),d=n(16113),p=(n(35072),n(613),n(63749),n(93333)),f=function(){return f=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},f.apply(this,arguments)},h=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},v=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},_=function(){function t(t){this.options=t,t&&void 0!==t.businessType&&(this.businessType=t.businessType);var e=(0,l.n5)();t&&t.user?this.user=t.user:this.user=new c(e?{uid:e}:{uid:"guest"}),p.C.log("OfflineDataManager",this.user.getUserId())}return t.prototype.init=function(){return h(this,void 0,void 0,(function(){var t,e,n,r,o,s,c,d;return v(this,(function(f){switch(f.label){case 0:return t=new i.ZP(a.H4,[{tableName:a.me.DOCUMENT_DATA,keyName:"key",indexs:["globalPadId","secretId","type","version","uid","subId","chunkId"]},{tableName:a.me.OFFLINE_DATA,keyName:"key",indexs:["globalPadId","secretId","type","version","uid","subId","chunkId"]},{tableName:a.me.PAD_INFO,keyName:"key",indexs:["globalPadId","secretId","uid"]},{tableName:a.me.NEW_DOCUMENT_ID,keyName:"globalPadId"},{tableName:a.me.FOLDER_INFO,keyName:"key"},{tableName:a.me.USER_INFO,keyName:"uid"},{tableName:a.me.DOCUMENT_STATUS,keyName:"globalPadId",indexs:["globalPadId","secretId","uid"]},{tableName:a.me.DATA_CHANGE,keyName:"key"},{tableName:a.me.DocumentEntities,keyName:"key"},{tableName:a.me.USERS,keyName:"key",indexs:["tinyId","nowUserIndex","docId","pageType"]}],(0,l.N1)()&&!(0,l.kK)()?i.XT.ClientDB:i.XT.IndexDB,a.kd),this.database=t.database,[4,this.database.init()];case 1:return(e=f.sent()).error?(p.C.error(e.error),[2,e]):(p.C.log("init IndexedDB success"),this.businessType!==u.Gk.EXCEL?[3,3]:(n=this,[4,this.createHelper(u.Gk.EXCEL)]));case 2:return n.excelHelper=f.sent(),[3,11];case 3:return this.businessType!==u.Gk.WORD?[3,5]:(r=this,[4,this.createHelper(u.Gk.WORD)]);case 4:return r.wordHelper=f.sent(),[3,11];case 5:return this.businessType!==u.Gk.SLIDE?[3,7]:(o=this,[4,this.createHelper(u.Gk.SLIDE)]);case 6:return o.slideHelper=f.sent(),[3,11];case 7:return s=this,[4,this.createHelper(u.Gk.EXCEL)];case 8:return s.excelHelper=f.sent(),c=this,[4,this.createHelper(u.Gk.WORD)];case 9:return c.wordHelper=f.sent(),d=this,[4,this.createHelper(u.Gk.SLIDE)];case 10:d.slideHelper=f.sent(),f.label=11;case 11:return[2,new i.x4(void 0,!0)]}}))}))},t.prototype.getHelper=function(t){var e;if("undefined"===typeof t&&(t=this.businessType),t===u.Gk.EXCEL)e=this.excelHelper;else if(t===u.Gk.WORD)e=this.wordHelper;else{if(t!==u.Gk.SLIDE)throw new Error("没有指定businessType的情况下 getHepler必须明确指定FILE_TYPE来获取对应的helper.");e=this.slideHelper}return e},t.prototype.getDatabase=function(){return this.database},t.prototype.popDocumentId=function(){return h(this,void 0,void 0,(function(){var t,e,n;return v(this,(function(r){switch(r.label){case 0:return this.user&&this.user.getUserId()?[4,this.getDocumentId()]:[2,new i.x4(new Error("UidError"))];case 1:return(t=r.sent()).error?[4,this.preFetchDocIds()]:[3,4];case 2:return r.sent(),[4,this.getDocumentId()];case 3:t=r.sent(),r.label=4;case 4:return(e=t.data)?(n=i.he.newInstance().addCondition("globalPadId",i.E1.ONLY,e.globalPadId),[4,this.database.delete(a.me.NEW_DOCUMENT_ID,n)]):(p.C.error({retcode:-1,reason:"indexDB has not NewDocumentIds!"}),[2,new i.x4(new Error("NoAvaliableIdError"))]);case 5:return r.sent(),this.preFetchDocIds(),[2,new i.x4(void 0,e)]}}))}))},t.prototype.preFetchDocIds=function(){return h(this,void 0,void 0,(function(){var t,e,n,r,o,s,c,l,f;return v(this,(function(h){switch(h.label){case 0:return(t=i.he.newInstance()).addCondition("isCreated",i.E1.ONLY,!1),[4,this.database.getAll(a.me.NEW_DOCUMENT_ID,t)];case 1:return(e=h.sent()).error?[2,e]:(n=e.data)&&n.length>25?[2,new i.x4(new Error("ID还剩下超过一半，不用拉新的了。"),{count:n.length})]:[4,d.hS.sendCommonRequest("https://docs.qq.com/cgi-bin/online_docs/predocid_get")];case 2:if((r=h.sent()).error)return[2,r];o=r.data,h.label=3;case 3:return h.trys.push([3,6,,7]),0!==o.retcode?[3,5]:(s=o.doc_id_list.splice(0,50),c=s.map((function(t){return{globalPadId:t.domain_id+"$"+t.pad_id,localPadId:""+t.pad_id,secretId:""+t.encoded_doc_id,isCreated:!1,padType:u.Gk.UNKNOWN}})),l=c.map((function(t){return{tableName:a.me.NEW_DOCUMENT_ID,data:t}})),[4,this.database.updateMultiTableData(l)]);case 4:return[2,h.sent()];case 5:return p.C.error("后台retCode不为0"),[2,new i.x4(new Error(""))];case 6:return f=h.sent(),p.C.error(f,"处理数据异常"),[2,new i.x4(f)];case 7:return[2]}}))}))},t.prototype.checkEvn=function(){return h(this,void 0,void 0,(function(){var t,e,n,r;return v(this,(function(o){return t=localStorage.getItem("last_dev_route_id"),e=localStorage.getItem("last_fd"),n=(0,l.ej)("dev_route_id"),r=(0,l.ej)("fd"),t!==n||e!==r?(this.setEvn(n,r),[2,!0]):(this.setEvn(n,r),[2,!1])}))}))},t.prototype.setEvn=function(t,e){localStorage.setItem("last_dev_route_id",t),localStorage.setItem("last_fd",e)},t.prototype.mapDocumentVersion=function(t,e){var r,o;p.C.debug("mapDocumentVersion  "+e+":"+t);var i={url:e,dver:t},a=function(t){p.C.info("mapDocumentVersion "+JSON.stringify(t))};l.Zp.isDesktop?this.sendCommandToSW({type:"preload-map-document-version",data:i}):(null===(r=n.g.tdocs)||void 0===r?void 0:r.mapDocumentVersion)?n.g.tdocs.mapDocumentVersion(f(f({},i),{success:a})):null===(o=window.mqq)||void 0===o||o.invoke("docx","mapDocumentVersion",i,a)},t.prototype.removeDocumentVersion=function(t){var e,r;p.C.debug("removeDocumentVersion "+t);var o=function(t){p.C.info("removeDocumentVersion "+JSON.stringify(t))};l.Zp.isDesktop?this.sendCommandToSW({type:"preload-remove-document-version",data:t}):(null===(e=n.g.tdocs)||void 0===e?void 0:e.removeDocumentVersion)?n.g.tdocs.removeDocumentVersion({url:t,success:o}):null===(r=window.mqq)||void 0===r||r.invoke("docx","removeDocumentVersion",{url:t},o)},t.prototype.sendCommandToSW=function(t){navigator.serviceWorker.controller?(p.C.debug("send command to service worker "+JSON.stringify(t)),navigator.serviceWorker.controller.postMessage(t)):p.C.error("service worker is not available")},t.prototype.createHelper=function(t){return h(this,void 0,void 0,(function(){var e;return v(this,(function(r){switch(r.label){case 0:switch(e={parent:this,database:this.database},t){case u.Gk.WORD:return[3,1];case u.Gk.EXCEL:return[3,3];case u.Gk.SLIDE:return[3,5]}return[3,7];case 1:return[4,n.e(6140).then(n.bind(n,2602))];case 2:return[2,new(0,r.sent().WordHelper)(e)];case 3:return[4,Promise.all([n.e(6551),n.e(4053)]).then(n.bind(n,67384))];case 4:return[2,new(0,r.sent().ExcelHelper)(e)];case 5:return[4,n.e(8810).then(n.bind(n,2806))];case 6:return[2,new(0,r.sent().SlideHelper)(e)];case 7:return[2,void 0]}}))}))},t.prototype.getDocumentId=function(){return h(this,void 0,void 0,(function(){var t;return v(this,(function(e){return(t=i.he.newInstance()).addCondition("isCreated",i.E1.ONLY,!1),[2,this.database.get(a.me.NEW_DOCUMENT_ID,t)]}))}))},t}();!function(t){t.rename="rename",t.delete="delete"}(r||(r={})),r.rename,r.delete,function(t){t[t.listTypeOffline=-1]="listTypeOffline",t[t.listTypeAll=1]="listTypeAll",t[t.listTypeCreated=2]="listTypeCreated",t[t.listTypeTrash=3]="listTypeTrash",t[t.listTypeShared=4]="listTypeShared",t[t.listTypeMyDoc=5]="listTypeMyDoc",t[t.listTypeRecent=6]="listTypeRecent",t[t.listTypeStared=7]="listTypeStared",t[t.listTypeInSharedFolder=9]="listTypeInSharedFolder"}(o||(o={}));var y,E=!1,g=(function(){function t(){}t.setForceRefresh=function(t){E=t},t.isForceRefresh=function(){return E}}(),function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))}),m=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};!function(t){t.SNAP_SHOT="SNAP_SHOT",t.CHUNK="CHUNK",t.VERSION_DATA="VERSION_DATA"}(y||(y={}));var b,C={data:{startRow:-1,endRow:-1,data:[[]]}},T=function(){function t(){}return t.getDatabaseInstance=function(){return g(this,void 0,void 0,(function(){var t,e,n;return m(this,(function(r){switch(r.label){case 0:if(this.dbInstance)return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,(t=new _({businessType:u.Gk.EXCEL,user:new c({uid:this.uid})})).init()];case 2:return(e=r.sent()).error?(p.C.error("getDatabaseInstance() init error",e.error),this._offlineDataManager=null,this.dbInstance=null,[2,null]):(this._offlineDataManager=t,this.dbInstance=t.database,[3,4]);case 3:return n=r.sent(),p.C.error("getDatabaseInstance",n),[3,4];case 4:return[2,this.dbInstance]}}))}))},Object.defineProperty(t,"offlineDataManager",{get:function(){return t._offlineDataManager||null},enumerable:!1,configurable:!0}),t.loadDocumentData=function(t){var e,n;return g(this,void 0,void 0,(function(){var r,o,u,c,l,d,f,h,v,_,E,g,b,T,A,S,O,D,w,I,N,R,P,L,U,k,M,x,B,G=this;return m(this,(function(m){switch(m.label){case 0:return r=Date.now(),o=t.id,u=t.subId,c=t.onSuccess,l=t.onFail,[4,this.getDatabaseInstance()];case 1:return d=m.sent(),f=i.he.newInstance().addCondition("type",i.E1.IN,[s.N.DOCUMENT,"ducument"]).orderby("version",i.Rs.DECREASE).addCondition("uid",i.E1.ONLY,this.uid).addCondition("secretId",i.E1.ONLY,o),[4,d.get(a.me.DOCUMENT_DATA,f)];case 2:return(h=m.sent()).error?(l&&l(new Error("获取document信息失败 "+h.error)),[2]):(v=h.data,_=Date.now(),E=u&&v&&v.data&&v.data.collab_client_vars.header[0].d.filter((function(t){return t.id===u}))||[],u&&0!==E.length||(u=v&&v.data&&v.data.collab_client_vars.header[0].d[0].id||""),(g=v.data).collab_client_vars.padSubId=u,b=g.collab_client_vars.rev||0,"new"===g.padStatus?[3,5]:(S=i.he.newInstance().addCondition("type",i.E1.IN,[s.N.ACCEPTED,s.N.MISS_CHANGE,s.N.NEW_CHANGE]).addCondition("uid",i.E1.ONLY,this.uid).addCondition("secretId",i.E1.ONLY,o).orderby("version",i.Rs.DECREASE).limit(0,1),[4,d.get(a.me.DOCUMENT_DATA,S)]));case 3:return(O=m.sent()).error&&!(0,i.FG)(O.error)?(p.C.error("获取增量版本数据失败",O.error),l&&l(new Error("获取增量版本数据错误")),[2]):(!O.error&&O.data&&(D=Math.max(b,O.data.version),g.collab_client_vars.rev=D),w=i.he.newInstance().addCondition("type",i.E1.IN,[s.N.WORKBOOK,s.N.CHUNK]).addCondition("uid",i.E1.ONLY,this.uid).addCondition("subSheetId",i.E1.IN,["workbook",u]).addCondition("chunkId",i.E1.ONLY,0).addCondition("secretId",i.E1.ONLY,o),[4,d.getAll(a.me.DOCUMENT_DATA,w)]);case 4:if((I=m.sent()).error)return l&&l(new Error("获取documentData信息失败 "+I.error)),[2];T=I.data.filter((function(t){return"workbook"===t.type}))[0],A=I.data.filter((function(t){return"chunk"===t.type}))[0],m.label=5;case 5:return A&&0!==(null===(e=A.data)||void 0===e?void 0:e.length)||(A={data:{startRow:0,endRow:200,data:null===(n=g.collab_client_vars)||void 0===n?void 0:n.initialAttributedText.text[0]}}),N=Date.now(),p.C.log("数据加载完成. document:"+(_-r)+"ms  workbook&subDocument: "+(N-_)+"ms"),c&&c({dataType:y.SNAP_SHOT,subId:u,clientVars:g,workbookData:T&&T.data||C.data,chunkData:A&&A.data||C.data}),R=Date.now(),p.C.log("首屏数据渲染完成:"+(R-r)+"ms"),P=i.he.newInstance().addCondition("type",i.E1.ONLY,s.N.CHUNK).addCondition("uid",i.E1.ONLY,this.uid).addCondition("subSheetId",i.E1.ONLY,u).addCondition("version",i.E1.ONLY,b).addCondition("secretId",i.E1.ONLY,o).orderby("chunkId",i.Rs.INCREASE),[4,d.getAll(a.me.DOCUMENT_DATA,P)];case 6:return(L=m.sent()).error?(l&&l(new Error("获取otherSubDocumentData信息失败 "+L.error)),[2]):(L.data.filter((function(t){return t.chunkId>=1})).forEach((function(t){c&&c({subId:u,dataType:y.CHUNK,chunkData:t.data})})),U=i.he.newInstance().addCondition("type",i.E1.IN,[s.N.ACCEPTED,s.N.MISS_CHANGE,s.N.NEW_CHANGE]).addCondition("uid",i.E1.ONLY,this.uid).addCondition("secretId",i.E1.ONLY,o).orderby("version",i.Rs.INCREASE),[4,d.getAll(a.me.DOCUMENT_DATA,U)]);case 7:return(k=m.sent()).error?(l&&l(new Error("获取breakVersionData信息失败 "+k.error)),[2]):(M=k.data,x=M.map((function(t){return G.breakVersionDataParse(t)})).filter((function(t){return t.version>b})).sort((function(t,e){return t.version-e.version})),c&&c({subId:u,dataType:y.VERSION_DATA,chunkData:x,isFinished:!0}),B=Date.now(),p.C.log("所有分片渲染完成:"+(Date.now()-r)+"ms   breakVersion: "+(B-R)+"ms"),[2])}}))}))},t.loadBreakVersions=function(t,e,n){return g(this,void 0,void 0,(function(){var r,o,u,c,l,d=this;return m(this,(function(p){switch(p.label){case 0:return console.time("loadBreakVersions"),[4,this.getDatabaseInstance()];case 1:return r=p.sent(),o=i.he.newInstance().addCondition("type",i.E1.IN,[s.N.ACCEPTED,s.N.MISS_CHANGE,s.N.NEW_CHANGE]).addCondition("uid",i.E1.ONLY,this.uid).addCondition("secretId",i.E1.ONLY,t).orderby("version",i.Rs.INCREASE),[4,r.getAll(a.me.DOCUMENT_DATA,o)];case 2:return(u=p.sent()).error?(Promise.reject(new Error("获取breakVersionData信息失败 "+u.error)),[2]):(c=u.data,l=c.map((function(t){return d.breakVersionDataParse(t)})).filter((function(t){return t.version>=e&&(void 0===n||t.version<=n)})),console.timeEnd("loadBreakVersions"),[2,Promise.resolve(l)])}}))}))},t.loadSubDocumentData=function(t){return g(this,void 0,void 0,(function(){var e,n,r,o,u,c,l,d,f,h,v,_,E,g,b,T,A,S,O,D,w,I,N,R,P=this;return m(this,(function(m){switch(m.label){case 0:return e=Date.now(),n=t.id,r=t.subId,o=t.baseVersion,u=t.onSuccess,c=t.onFail,void 0===n||void 0===r||void 0===o?(c&&c(new Error("loadSubDocumentData参数错误"+JSON.stringify(t))),[2]):[4,this.getDatabaseInstance()];case 1:return l=m.sent(),d=i.he.newInstance().addCondition("uid",i.E1.ONLY,this.uid).addCondition("secretId",i.E1.ONLY,n).orderby("version",i.Rs.DECREASE).limit(0,1),[4,l.get(a.me.DOCUMENT_DATA,d)];case 2:return(f=m.sent()).error?(c&&c(new Error("获取文档最大本地缓存版本号错误 "+f.error)),[2]):(h=f.data.version)<o?(c&&c(new Error("本地缓存的数据版本号小于"+o+" 没办法返回所需的数据。 maxVersion="+h)),[2]):(v=i.he.newInstance().addCondition("type",i.E1.ONLY,s.N.CHUNK).addCondition("uid",i.E1.ONLY,this.uid).addCondition("subSheetId",i.E1.ONLY,r).addCondition("secretId",i.E1.ONLY,n).orderby("chunkId",i.Rs.INCREASE),[4,l.getAll(a.me.DOCUMENT_DATA,v)]);case 3:return(_=m.sent()).error?(c&&c(new Error("获取subDocumentData信息失败 "+_.error)),[2]):(E=_.data,g=[],b=0,E.filter((function(t){return t.version<=o})).forEach((function(t){g.push(t),b=Math.max(b,t.version)})),0!==(g=g.filter((function(t){return t.version===b}))).length?[3,5]:(T=i.he.newInstance().addCondition("type",i.E1.IN,[s.N.DOCUMENT,"ducument"]).addCondition("uid",i.E1.ONLY,this.uid).addCondition("secretId",i.E1.ONLY,n),[4,l.get(a.me.DOCUMENT_DATA,T)]));case 4:if((A=m.sent()).error)return c&&c(new Error("检验是否本地有该文档缓存失败 "+A.error)),[2];g=[C],m.label=5;case 5:return S=Date.now(),p.C.log("子表主keyfrme数据读取完成:"+(S-e)+"ms"),u&&u({dataType:y.SNAP_SHOT,subId:r,chunkData:g}),O=Date.now(),p.C.log("子表keyframe渲染耗时:"+(O-S)+"ms"),D=i.he.newInstance().addCondition("type",i.E1.IN,[s.N.ACCEPTED,s.N.MISS_CHANGE,s.N.NEW_CHANGE]).addCondition("uid",i.E1.ONLY,this.uid).addCondition("secretId",i.E1.ONLY,n).addCondition("subSheetId",i.E1.ONLY,r).orderby("version",i.Rs.INCREASE),[4,l.getAll(a.me.DOCUMENT_DATA,D)];case 6:return(w=m.sent()).error?(c&&c(new Error("获取breakVersionData信息失败 "+w.error)),[2]):(I=w.data,N=I.map((function(t){return P.breakVersionDataParse(t)})).filter((function(t){return t.version>b&&t.version<=o})).sort((function(t,e){return t.version-e.version})),R=Date.now(),p.C.log("子表增量版本数据读取耗时:"+(R-O)+"ms"),u&&u({dataType:y.VERSION_DATA,subId:r,chunkData:N,isFinished:!0}),p.C.log("子表增量版本数据应用耗时:"+(Date.now()-R)+"ms"),[2])}}))}))},t.clearDocumentCache=function(t,e){return g(this,void 0,void 0,(function(){var n,r,o;return m(this,(function(s){switch(s.label){case 0:return[4,this.getDatabaseInstance()];case 1:return n=s.sent(),r=i.he.newInstance().addCondition("secretId",i.E1.ONLY,t).addCondition("uid",i.E1.ONLY,e),[4,n.delete(a.me.DOCUMENT_DATA,r)];case 2:return(o=s.sent()).error?[3,4]:[4,n.delete(a.me.DOCUMENT_STATUS,r)];case 3:o=s.sent(),s.label=4;case 4:return o.error?[3,6]:[4,n.updateField(a.me.PAD_INFO,r,{isOfflineCache:!1})];case 5:o=s.sent(),s.label=6;case 6:return[2,o]}}))}))},t.breakVersionDataParse=function(t){return t.type===s.N.ACCEPTED?{version:t.data.baseVersion,subId:t.data.data.subId,keyframe:t.data.data.keyData||void 0,data:t.data.data.mutations||t.data.data.changeData,changesetType:t.data.data.changesetType}:{version:t.data.newVersion,subId:t.data.sheetId,data:JSON.parse(t.data.changeset),changesetType:t.data.changesetType}},t.uid=(0,l.n5)(),t}();!function(t){t[t.downloadStart=0]="downloadStart",t[t.downloadEnd=1]="downloadEnd",t[t.downloadCancel=2]="downloadCancel",t[t.uploadStart=3]="uploadStart",t[t.uploadEnd=4]="uploadEnd"}(b||(b={})),function(){function t(){}t.notifyNative=function(e){i.RR.invokeNative("docx","notifyNative",e,(function(){p.Z.debug(t.TAG,"notifyNative ",e)}))},t.callClient=function(e,n){i.RR.invokeNative("docx","callClient",{method:e,data:n},(function(){p.Z.debug(t.TAG,"callClient method:"+e+" data:"+n)}))},t.TAG="BridgeHelper"}();var A=n(82471)},82471:function(t,e,n){"use strict";var r;n.d(e,{D:function(){return r}}),function(t){t[t.UnknownError=-1]="UnknownError",t[t.Success=0]="Success",t[t.NoGlobalPadIdError=-1001]="NoGlobalPadIdError",t[t.InvalidFileTypeError=-1002]="InvalidFileTypeError",t[t.InvalidUrlError=-1003]="InvalidUrlError",t[t.PreloadParseError=-1004]="PreloadParseError",t[t.AIOUrlTypeError=-1005]="AIOUrlTypeError",t[t.GetDocumentStatusError=-2001]="GetDocumentStatusError",t[t.RejcectByThrottleError=-2002]="RejcectByThrottleError",t[t.GetDocLockError=-2003]="GetDocLockError",t[t.GetUncommitDataError=-2004]="GetUncommitDataError",t[t.CreateFileError=-2005]="CreateFileError",t[t.CommitOfflineDataError=-2006]="CommitOfflineDataError",t[t.UpdateUnCommitedDataError=-2007]="UpdateUnCommitedDataError",t[t.PreFetchDocDataError=-2008]="PreFetchDocDataError",t[t.UpdatePreFetchOfflienDataError=-2009]="UpdatePreFetchOfflienDataError",t[t.UpdatePadInfoError=-2010]="UpdatePadInfoError",t[t.SyncOfflineDataUnknownError=-2011]="SyncOfflineDataUnknownError",t[t.PadInfoNotExistError=-2012]="PadInfoNotExistError",t[t.FileNotExsitError=-2013]="FileNotExsitError",t[t.HttpStatusError=-2014]="HttpStatusError",t[t.DocumentBlankPageError=-2015]="DocumentBlankPageError"}(r||(r={}))},81289:function(t,e,n){"use strict";n.d(e,{N:function(){return r},T:function(){return a}});var r,o=n(96331),i=n(93333);!function(t){t.INIT="init",t.DOCUMENT="document",t.WORKBOOK="workbook",t.CHUNK="chunk",t.ACCEPTED="accepted",t.MISS_CHANGE="misschange",t.NEW_CHANGE="newchange",t.COMMITING="commiting",t.WATTING="watting",t.QUEUE="queue"}(r||(r={}));var a=function(){function t(e){this.chunkId=0,this.default=!1,e.taskId||(e.taskId=t.createMessageSeq()),e.key||(e.chunkId=e.chunkId||0,e.type===r.INIT?e.key=e.globalPadId+"_"+e.subSheetId+"_"+e.uid:e.type===r.DOCUMENT?e.key=e.globalPadId+"_"+e.uid+"_version_"+e.version:e.type===r.WORKBOOK?e.key=e.globalPadId+"_"+e.subSheetId+"_"+e.uid+"_version_"+e.version:e.type===r.CHUNK?e.key=e.globalPadId+"_"+e.subSheetId+"_"+e.chunkId+"_"+e.uid+"_version_"+e.version:e.key=e.globalPadId+"_"+e.subSheetId+"_"+e.uid+"_taskId_"+e.taskId),e.default=e.default||!1,this.key=e.key,this.uid=e.uid,this.globalPadId=e.globalPadId,this.secretId=e.secretId,this.subSheetId=e.subSheetId,this.chunkId=e.chunkId,this.type=e.type,this.docType=e.docType,this.padStatus=e.padStatus,this.taskId=e.taskId,this.version=e.version,this.data=e.data||e._data,this.default=e.default,this.createTime=e.createTime,this.dver=e.dver}return t.createMessageSeq=function(){return Math.ceil(2147483648*Math.random())},t.prototype.disableConvert=function(){return this.docType===o.Gk.WORD&&"BB08J2"!==this.subSheetId},Object.defineProperty(t.prototype,"data",{get:function(){if("string"===typeof this._data&&!this.disableConvert()){var t=this._data;try{t=JSON.parse(this._data)}catch(e){i.Z.error(e)}return t}return this._data},set:function(t){this._data="string"!==typeof t?JSON.stringify(t):t},enumerable:!1,configurable:!0}),t}()},96331:function(t,e,n){"use strict";var r,o,i,a;n.d(e,{BG:function(){return l},DL:function(){return i},Gk:function(){return o},Yk:function(){return c},w1:function(){return a}}),function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.WORD=0]="WORD",t[t.EXCEL=1]="EXCEL",t[t.SLIDE=4]="SLIDE"}(o||(o={})),function(t){t.NEW="new",t.LOCAL="local",t.DELETED="deleted",t.NORMAL="normal"}(i||(i={})),function(t){t.SHEET="sheet",t.WORD="doc",t.FORM="form",t.SLIDE="slide"}(a||(a={}));var s,u,c=((r={})[o.EXCEL]=a.SHEET,r[o.WORD]=a.WORD,r[o.SLIDE]=a.SLIDE,r);!function(t){t[t.MY_DOC=5]="MY_DOC",t[t.RECENT=6]="RECENT",t[t.SHARE=4]="SHARE",t[t.STAR=7]="STAR",t[t.TRASH=3]="TRASH"}(s||(s={})),function(t){t[t.FILE=1]="FILE",t[t.FOLDER=2]="FOLDER"}(u||(u={}));var l=function(t,e,n){this.folder_id="",this.attribute=null,this.parents=[],this.isOfflineCache=!1,this.isSnapShot=!1,this.doc_policy=0,this.folder_policy=0,this.doc_privilege=null,this.folder_privilege=null,this.is_added_my=0,this.is_collected=0,this.is_owner=1,this.is_pinned=0,this.is_shortcut=0,this.isManualOffline=!1,this.isUserChangeTitle=!1,this.add_list_ts=0,this.last_collect_ts=0,this.last_delete_ts=0,this.last_pinned_ts=null;var r=(new Date).getTime()/1e3;this.last_browse_ts=r,this.last_modify_ts=r,this.create_ts=r,this.list_type=s.MY_DOC,this.list_info_type=u.FILE,this.owner_uid=t.getUserId(),this.owner_nick=t.getUserId(),this.uid=t.getUserId(),this.last_modify_nick=t.getUserId(),this.last_modify_uid=t.getUserId(),"undefined"!==typeof e&&(this.isMydoc=e),"undefined"!==typeof n&&(this.isRencent=n)}},16113:function(t,e,n){"use strict";n.d(e,{hS:function(){return d},n$:function(){return r}});var r,o,i=n(30414),a=n(9578),s=n(93333),u=n(38421),c=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},l=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};!function(t){t.POST="POST",t.GET="GET"}(r||(r={})),function(t){t[t.privilegeAttribute=1]="privilegeAttribute",t[t.title=2]="title"}(o||(o={}));var d=function(){function t(){}return t.transferHide2Normal=function(t){return c(this,void 0,void 0,(function(){var e;return l(this,(function(n){switch(n.label){case 0:return e="'encrypted_doc_id="+t,[4,this.sendCommonRequest("/cgi-bin/online_docs/doc_transferhidetonormal",r.POST,e)];case 1:return[2,n.sent()]}}))}))},t.notifyOpenDoc=function(t){return c(this,void 0,void 0,(function(){var e;return l(this,(function(n){switch(n.label){case 0:return e="'encrypted_doc_id="+t,[4,this.sendCommonRequest("/cgi-bin/online_docs/doc_broselistadd?t=1",r.POST,e)];case 1:return[2,n.sent()]}}))}))},t.fetchDocDataSlide=function(t,e){return void 0===e&&(e=!1),c(this,void 0,void 0,(function(){var n;return l(this,(function(o){switch(o.label){case 0:return n=u.f+"/dop-api/slide/data/get?id="+t+"&normal=1&prefetch=1&offline=1",[4,this.sendCommonRequest(n,r.GET,"",e?void 0:"custom")];case 1:return[2,o.sent()]}}))}))},t.fetchDocData=function(t,e,n,o){return void 0===n&&(n=!0),void 0===o&&(o=!1),c(this,void 0,void 0,(function(){var a,s;return l(this,(function(u){switch(u.label){case 0:return e&&e.indexOf("?")>-1||(e+="?"),a=(0,i.ej)("preview_token"),s="/dop-api/opendoc"+e+(n&&"&prefetch=1")+(o?"&outformat=1":"")+"&normal=1&id="+t+"&key="+a+"&xsrf="+(0,i.fM)(),[4,this.sendCommonRequest(s,r.GET,"",o?void 0:"custom")];case 1:return[2,u.sent()]}}))}))},t.getPadInfo=function(t,e){return c(this,void 0,void 0,(function(){var n;return l(this,(function(o){switch(o.label){case 0:return n="/cgi-go/padinfo/getpadinfo?encodePadId="+t+(e?"&infoKeys=["+e+"]":"")+"&xsrf="+(0,i.fM)(),[4,this.sendCommonRequest(n,r.GET)];case 1:return[2,o.sent()]}}))}))},t.sendCommonRequest=function(t,e,n,o){return void 0===e&&(e=r.GET),c(this,void 0,void 0,(function(){return l(this,(function(r){return[2,new Promise((function(r,i){try{var u,c=new XMLHttpRequest;c.onreadystatechange=function(){if(c.readyState===XMLHttpRequest.DONE){var e="";if(200===c.status)try{e=o&&"custom"===o?c.responseText:JSON.parse(c.responseText)}catch(n){s.C.error("sendCommonRequest failed: query:"+t+", responseText:"+c.responseText+" error:"+n),u=n}else u=new a.oo(c.status,0,"StatusError");r(new a.x4(u,e))}};try{c.timeout=3e4}catch(l){}c.ontimeout=function(){u=new Error("TimeOutError"),r(new a.x4(u))},c.open(e,t),c.setRequestHeader("content-type","application/x-www-form-urlencoded"),c.send(n)}catch(d){r(new a.x4(d))}}))]}))}))},t}()},35072:function(t,e,n){"use strict";var r=n(63749),o=n(34960),i=n(9578),a=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),s=function(){return s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},s.apply(this,arguments)},u=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},c=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.getDefaultConfig=function(){return{strategy:r.I.ONCE,period:-1,autoRenewal:!0}},e.prototype.lock=function(t,e){return u(this,void 0,void 0,(function(){var n,r,o,a=this;return c(this,(function(s){switch(s.label){case 0:return n={tabId:this.tabId,expire:-1===this.period?-1:Date.now()+this.period,optional:e},r={command:"lock",key:t,item:n},this.logRequest(r),[4,new Promise((function(t){a.getClientMutexLock(r,(function(e){if(a.logResponse(e),e.err_msg||e.err_code){var n=new Error(e.err_msg||e.err_code);t(new i.x4(n))}else t(new i.x4(void 0,e.result))}))}))];case 1:return(o=s.sent()).error?[2,{isSuccess:!1,data:o.data}]:o.data.tabId===this.tabId?[2,{isSuccess:!0,data:o.data}]:[2,{isSuccess:!1,data:o.data}]}}))}))},e.prototype.detectKey=function(t){return u(this,void 0,void 0,(function(){var e,n,r,o=this;return c(this,(function(a){switch(a.label){case 0:return e={command:"detectKey",key:t},this.logRequest(e),[4,new Promise((function(t){o.getClientMutexLock(e,(function(e){o.logResponse(e),t(e)}))}))];case 1:return n=a.sent(),r=new i.x4(void 0,n.result),n.err_code?(r.error=new i.GU(""+n.err_code),[2,r]):[2,r]}}))}))},e.prototype.release=function(t){return u(this,void 0,void 0,(function(){var e,n=this;return c(this,(function(r){switch(r.label){case 0:return e={command:"release",key:t},this.logRequest(e),[4,new Promise((function(t){n.getClientMutexLock(e,(function(e){if(n.logResponse(e),e.err_msg||e.err_code){var r=new Error(e.err_msg||e.err_code);t(new i.x4(r))}else t(new i.x4(void 0,e.result))}))}))];case 1:return r.sent().error?[2,!1]:[2,!0]}}))}))},e.prototype.getClientMutexLock=function(t,e){var r;(null===(r=n.g.tdocs)||void 0===r?void 0:r.getClientMutexLock)?n.g.tdocs.getClientMutexLock(s(s({},t),{success:e})):i.RR.invokeNative("docx","clientMutexLock",t,e)},e.prototype.logRequest=function(t){o.eM},e.prototype.logResponse=function(t){o.eM},e}(r.w);e.Z=l},93333:function(t,e,n){"use strict";n.d(e,{Z:function(){return o}});var r=window,o=function(){function t(){}return t.debug=function(){for(var e,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];try{r.log?(e=r.log).debug.apply(e,n):console.debug.apply(console,n)}catch(i){t.error("日志发生错误","debug",n)}},t.log=function(){for(var e,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];try{r.log?(e=r.log).info.apply(e,n):console.log.apply(console,n)}catch(i){t.error("日志发生错误","log",n)}},t.info=function(){for(var e,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];try{r.log?(e=r.log).info.apply(e,n):console.info.apply(console,n)}catch(i){t.error("日志发生错误","info",n)}},t.warn=function(){for(var e,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];try{r.log?(e=r.log).warn.apply(e,n):console.warn.apply(console,n)}catch(i){t.error("日志发生错误","warn",n)}},t.error=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{r.log?(t=r.log).error.apply(t,e):console.error.apply(console,e)}catch(o){console.error("日志发生错误","error",e)}},t.time=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r={time:Date.now(),options:e};this.sTimeLableMap.set(t,r)},t.timeEnd=function(e){var n=Date.now(),r=t.sTimeLableMap.get(e);if(void 0!==r){var o=r.time,i=r.options&&r.options.map((function(t){return JSON.stringify(t)})).join("-")||"";t.debug("label: "+e+": "+(n-o)+"ms. "+i),this.sTimeLableMap.delete(e)}},t.sTimeLableMap=new Map,t}();e.C=o},613:function(t,e,n){"use strict";var r=n(63749),o=n(93333),i=n(9578),a=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),s=function(){return s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},s.apply(this,arguments)},u=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},c=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.getDefaultConfig=function(){return{strategy:r.I.ONCE,period:3e5,autoRenewal:!0}},e.prototype.getXKey=function(t){return e.PREFIX_LOCK_X+"_"+t},e.prototype.getYKey=function(t){return e.PREFIX_LOCK_Y+"_"+t},e.prototype.tryToLockKey=function(t,n,i,a){var s=this,u=this.getXKey(t),c=this.getYKey(t);e.DEBUG&&o.C.log("tryToLockKey(). strategy="+this.strategy+" lockX="+u+" lockY="+c),localStorage.setItem(u,this.tabId);var l=localStorage.getItem(c);if(e.DEBUG&&o.C.log("tryToLockKey(). strategy="+this.strategy+" lockX="+u+" lockY="+c+" valueY="+l),l){var d=JSON.parse(l);if(d.expire>Date.now())return e.DEBUG&&o.C.log("tryToLockKey(). 被其他tab拿到了Y锁 strategy="+this.strategy+" lockX="+u+" lockY="+c+" valueY="+l),o.C.log("有其他tab已经拿到了Y锁"),void(this.strategy===r.I.ONCE?a(d):setTimeout((function(){return s.tryToLockKey(t,n,i,a)})))}var p={tabId:this.tabId,expire:Date.now()+this.period,optional:n};localStorage.setItem(c,JSON.stringify(p)),e.DEBUG&&o.C.log("tryToLockKey(). 写入Y锁. strategy="+this.strategy+" lockX="+u+" lockY="+c+" valueY="+l+" lockItemY="+p);var f=localStorage.getItem(u);e.DEBUG&&o.C.log("tryToLockKey(). 查看X锁. strategy="+this.strategy+" lockX="+u+" lockY="+c+" valueY="+l+" valueX="+f),f!==this.tabId?setTimeout((function(){var d=!1;l=localStorage.getItem(c);var p=JSON.parse(l||"{}");e.DEBUG&&o.C.log("tryToLockKey(). 再次查看Y锁. strategy="+s.strategy+" lockX="+u+" lockY="+c+" valueY="+l+" valueX="+f),l&&p.tabId===s.tabId&&p.expire>Date.now()&&(d=!0),d?(e.DEBUG&&o.C.log("tryToLockKey(). 竞争锁成功. strategy="+s.strategy+" lockX="+u+" lockY="+c),i(p)):s.strategy===r.I.ONCE?(e.DEBUG&&o.C.log("tryToLockKey(). 竞争锁失败. strategy="+s.strategy+" lockX="+u+" lockY="+c),a(p)):(e.DEBUG&&o.C.log("tryToLockKey(). 竞争锁失败，重新竞争. strategy="+s.strategy+" lockX="+u+" lockY="+c),setTimeout((function(){return s.tryToLockKey(t,n,i,a)})))})):(e.DEBUG&&o.C.log("tryToLockKey(). 竞争锁成功. strategy="+this.strategy+" lockX="+u+" lockY="+c),i(p))},e.prototype.lock=function(t,e){return u(this,void 0,void 0,(function(){var n=this;return c(this,(function(r){switch(r.label){case 0:return[4,new Promise((function(r,o){n.tryToLockKey(t,e,r,o)})).then((function(e){return n.autoRenewal&&n.renewal(t,n.period),{isSuccess:!0,data:e}}),(function(e){var r=n.getXKey(t);return localStorage.getItem(r)===n.tabId&&localStorage.removeItem(r),{isSuccess:!1,data:e}}))];case 1:return[2,r.sent()]}}))}))},e.prototype.detectKey=function(t){return u(this,void 0,void 0,(function(){var e,n,r,o;return c(this,(function(a){return e=this.getYKey(t),n=new i.x4(void 0,void 0),(r=localStorage.getItem(e))&&(o=JSON.parse(r)).expire>Date.now()&&(n.data=o),[2,n]}))}))},e.prototype.release=function(t){return u(this,void 0,void 0,(function(){var n,r,i,a;return c(this,(function(s){return n=this.getXKey(t),r=this.getYKey(t),(i=localStorage.getItem(r))&&JSON.parse(i).tabId===this.tabId&&(e.DEBUG&&o.C.log("releaseKey(). 释放锁. strategy="+this.strategy+" key="+t),localStorage.removeItem(r),localStorage.getItem(n)===this.tabId&&localStorage.removeItem(n)),(a=e.renewalHanlder.get(t))&&(clearTimeout(a),e.renewalHanlder.delete(t)),[2,!0]}))}))},e.prototype.renewal=function(t,n){var r=this,i=e.renewalHanlder.get(t);i&&clearTimeout(i);var a=setTimeout((function(){e.DEBUG&&o.C.log("renewal(). 自动续期锁. strategy="+r.strategy+" key="+t+" period="+n);var i=r.getYKey(t),a=localStorage.getItem(i);if(a){var u=JSON.parse(a);if(u.tabId===r.tabId){var c=s(s({},u),{expire:Date.now()+r.period});localStorage.setItem(r.getYKey(t),JSON.stringify(c)),r.renewal(t,n)}else o.C.error("自动续期失败，Y锁已经被其他地方占有了。",u)}else o.C.error("Y锁没有读到值")}),.85*n);return e.renewalHanlder.set(t,a),a},e.PREFIX_LOCK_X="prefix_lock_x",e.PREFIX_LOCK_Y="prefix_lock_y",e}(r.w);e.Z=l},63749:function(t,e,n){"use strict";n.d(e,{I:function(){return r},w:function(){return i}});var r,o=function(){return o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},o.apply(this,arguments)};!function(t){t[t.ONCE=0]="ONCE",t[t.RETRY=1]="RETRY"}(r||(r={}));var i=function(){function t(t){this.tabId=this.getTabID(),t=t?o(o({},this.getDefaultConfig()),t):this.getDefaultConfig(),this.strategy=t.strategy,this.period=t.period,this.autoRenewal=t.autoRenewal}return t.prototype.getTabID=function(){var t=new Date;return 1+t.getMonth()+"-"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()+":"+t.getMilliseconds()+" "+Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)},t.prototype.renewal=function(t,e){},t.DEBUG=!1,t.DEFAULT_CONFIG={strategy:r.ONCE,period:3e5,autoRenewal:!0},t.renewalHanlder=new Map,t}()},30414:function(t,e,n){"use strict";n.d(e,{Ei:function(){return y},KW:function(){return _},N1:function(){return c},SV:function(){return d},Zp:function(){return u},ej:function(){return a},fM:function(){return s},kK:function(){return l},n5:function(){return E},ws:function(){return v}});var r=n(96331),o=n(38421),i=window;function a(t){var e=document.cookie.match(new RegExp("(^| )"+t+"=([^;]*)(;|$)"));return e?decodeURIComponent(e[2]):""}function s(){return a("TOK")||""}var u=function(){var t=navigator.userAgent.toLowerCase(),e=/(ipad)/i.test(t);return{isPad:e,isMobile:/(mobile)/i.test(t)&&!e,isDesktop:/(TDAppDesktop)/.test(navigator.userAgent)}}();function c(){if("0"===localStorage.getItem("OFFLINE_DB_SWITCH"))return!1;var t=navigator.userAgent.match(/_tdocFlag\/(\d+)/);return!(!t||!t[1])&&2&parseInt(t[1])}function l(){return"1"===function(t){var e=window.location.search.match(new RegExp("(\\?|&)"+t+"=([^&]*)(&|$)"));return e?decodeURIComponent(e[2]):""}("offline-debug")}function d(){return i.App&&i.App.GlobalConfig&&i.App.GlobalConfig.globalCodeVersion?i.App.GlobalConfig.globalCodeVersion:""}function p(t){return"string"===typeof t?p(JSON.parse(t)):t}function f(t){var e=[];if(t.v>=5){var n=t.c;("IMAGE"===n[0]||"string"===typeof n[2]&&-1!==n[2].indexOf("attachment-"))&&e.push(t.c[3])}return e}function h(t){var e,n=[];return"string"===typeof t&&(e=JSON.parse(t)),Array.isArray(e)&&e.forEach((function(t){t&&t.v&&(n=n.concat(f(t)))})),n}function v(t){for(var e=[],n=0,r=t.length;n<r;n++)for(var o=p(t[n]),i=0,a=o.length;i<a;i++){var s=o[i];e=s.v?e.concat(f(s)):e.concat(h(s))}return e}var _=function(t,e){var n=function(t){var e;return t===r.Gk.WORD?e="doc":t===r.Gk.EXCEL?e="sheet":t===r.Gk.SLIDE&&(e="slide"),e}(t);return o.f+"/"+n+"/"+e};function y(t){var e;return t?"result is { resultCode: "+t.resultCode+" subResultCode: "+t.subResultCode+" message: "+t.message+" dataUndefinedCheck: "+(void 0===t.data)+" error: "+(null===(e=t.error)||void 0===e?void 0:e.stack)+"}":"result is undefine!!!"}var E=function(){var t,e;return a("uid")||(null===(e=null===(t=n.g.basicClientVars)||void 0===t?void 0:t.userInfo)||void 0===e?void 0:e.tinyId)||""}},43014:function(t,e,n){"use strict";n.d(e,{ed:function(){return $o},vt:function(){return Qo}}),n(11425),n(46396),n(13857),n(54371),n(38934),n(95019),n(19553),n(71091),n(81144),n(17302),n(59677),n(14199),n(47917),n(48912),n(34797),n(2725),n(12522),n(56687),n(10635),n(89512),n(57625),n(41403),n(76252),n(69398),n(49245),n(15421),n(554),n(52865),n(85932),n(64425),n(30980),n(16640),n(37108),n(28255),n(50104),n(25111),n(39585),n(77575),n(76880),n(11502),n(96434),n(3377),n(71318),n(21530),n(90109),n(26894),n(79690),n(71096),n(84919),n(16957),n(62077),n(75793),n(93984),n(15770),n(31688),n(84168),n(27849),n(62883),n(69401),n(41901),n(8195),n(53923),n(77468),n(48845),n(41031),n(49502),n(31610),n(95232),n(50374),n(29816),n(10012),n(98779),n(36465),n(20670),n(25594);var r=n(68196),o=n.n(r),i=n(82348),a=n(24801),s=n.n(a),u=function(t,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},u(t,e)};function c(t,e){function n(){this.constructor=t}u(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var l=function(){return l=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},l.apply(this,arguments)};function d(t,e){var n="function"===typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(s){o={error:s}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}var p="object"===typeof globalThis?globalThis:window,f="1.0.3",h=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/,v=function(t){var e=new Set([t]),n=new Set,r=t.match(h);if(!r)return function(){return!1};var o=+r[1],i=+r[2],a=+r[3];if(null!=r[4])return function(e){return e===t};function s(t){return n.add(t),!1}function u(t){return e.add(t),!0}return function(t){if(e.has(t))return!0;if(n.has(t))return!1;var r=t.match(h);if(!r)return s(t);var c=+r[1],l=+r[2],d=+r[3];return null!=r[4]||o!==c?s(t):0===o?i===l&&a<=d?u(t):s(t):i<=l?u(t):s(t)}}(f),_=f.split(".")[0],y=Symbol.for("opentelemetry.js.api."+_),E=p;function g(t,e,n,r){var o;void 0===r&&(r=!1);var i=E[y]=null!==(o=E[y])&&void 0!==o?o:{version:f};if(!r&&i[t]){var a=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+t);return n.error(a.stack||a.message),!1}return i.version!==f?(a=new Error("@opentelemetry/api: All API registration versions must match"),n.error(a.stack||a.message),!1):(i[t]=e,n.debug("@opentelemetry/api: Registered a global for "+t+" v1.0.3."),!0)}function m(t){var e,n,r=null===(e=E[y])||void 0===e?void 0:e.version;if(r&&v(r))return null===(n=E[y])||void 0===n?void 0:n[t]}function b(t,e){e.debug("@opentelemetry/api: Unregistering a global for "+t+" v1.0.3.");var n=E[y];n&&delete n[t]}var C,T=function(){function t(t){this._namespace=t.namespace||"DiagComponentLogger"}return t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return A("debug",this._namespace,t)},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return A("error",this._namespace,t)},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return A("info",this._namespace,t)},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return A("warn",this._namespace,t)},t.prototype.verbose=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return A("verbose",this._namespace,t)},t}();function A(t,e,n){var r=m("diag");if(r)return n.unshift(e),r[t].apply(r,n)}!function(t){t[t.NONE=0]="NONE",t[t.ERROR=30]="ERROR",t[t.WARN=50]="WARN",t[t.INFO=60]="INFO",t[t.DEBUG=70]="DEBUG",t[t.VERBOSE=80]="VERBOSE",t[t.ALL=9999]="ALL"}(C||(C={}));var S=function(){function t(){function t(t){return function(){var e=m("diag");if(e)return e[t].apply(e,arguments)}}var e=this;e.setLogger=function(t,n){var r,o;if(void 0===n&&(n=C.INFO),t===e){var i=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return e.error(null!==(r=i.stack)&&void 0!==r?r:i.message),!1}var a=m("diag"),s=function(t,e){function n(n,r){var o=e[n];return"function"===typeof o&&t>=r?o.bind(e):function(){}}return t<C.NONE?t=C.NONE:t>C.ALL&&(t=C.ALL),e=e||{},{error:n("error",C.ERROR),warn:n("warn",C.WARN),info:n("info",C.INFO),debug:n("debug",C.DEBUG),verbose:n("verbose",C.VERBOSE)}}(n,t);if(a){var u=null!==(o=(new Error).stack)&&void 0!==o?o:"<failed to generate stacktrace>";a.warn("Current logger will be overwritten from "+u),s.warn("Current logger will overwrite one already registered from "+u)}return g("diag",s,e,!0)},e.disable=function(){b("diag",e)},e.createComponentLogger=function(t){return new T(t)},e.verbose=t("verbose"),e.debug=t("debug"),e.info=t("info"),e.warn=t("warn"),e.error=t("error")}return t.instance=function(){return this._instance||(this._instance=new t),this._instance},t}(),O=function(){function t(t){this._entries=t?new Map(t):new Map}return t.prototype.getEntry=function(t){var e=this._entries.get(t);if(e)return Object.assign({},e)},t.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map((function(t){return[t[0],t[1]]}))},t.prototype.setEntry=function(e,n){var r=new t(this._entries);return r._entries.set(e,n),r},t.prototype.removeEntry=function(e){var n=new t(this._entries);return n._entries.delete(e),n},t.prototype.removeEntries=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var r=new t(this._entries),o=0,i=e;o<i.length;o++){var a=i[o];r._entries.delete(a)}return r},t.prototype.clear=function(){return new t},t}(),D=Symbol("BaggageEntryMetadata"),w=S.instance();function I(t){return void 0===t&&(t={}),new O(new Map(Object.entries(t)))}var N={get:function(t,e){if(null!=t)return t[e]},keys:function(t){return null==t?[]:Object.keys(t)}},R={set:function(t,e,n){null!=t&&(t[e]=n)}};function P(t){return Symbol.for(t)}var L,U=function t(e){var n=this;n._currentContext=e?new Map(e):new Map,n.getValue=function(t){return n._currentContext.get(t)},n.setValue=function(e,r){var o=new t(n._currentContext);return o._currentContext.set(e,r),o},n.deleteValue=function(e){var r=new t(n._currentContext);return r._currentContext.delete(e),r}},k=new U,M=function(t,e){for(var n=0,r=e.length,o=t.length;n<r;n++,o++)t[o]=e[n];return t},x=function(){function t(){}return t.prototype.active=function(){return k},t.prototype.with=function(t,e,n){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];return e.call.apply(e,M([n],r))},t.prototype.bind=function(t,e){return e},t.prototype.enable=function(){return this},t.prototype.disable=function(){return this},t}(),B=function(t,e){for(var n=0,r=e.length,o=t.length;n<r;n++,o++)t[o]=e[n];return t},G="context",F=new x,j=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalContextManager=function(t){return g(G,t,S.instance())},t.prototype.active=function(){return this._getContextManager().active()},t.prototype.with=function(t,e,n){for(var r,o=[],i=3;i<arguments.length;i++)o[i-3]=arguments[i];return(r=this._getContextManager()).with.apply(r,B([t,e,n],o))},t.prototype.bind=function(t,e){return this._getContextManager().bind(t,e)},t.prototype._getContextManager=function(){return m(G)||F},t.prototype.disable=function(){this._getContextManager().disable(),b(G,S.instance())},t}();!function(t){t[t.NONE=0]="NONE",t[t.SAMPLED=1]="SAMPLED"}(L||(L={}));var V="0000000000000000",H="00000000000000000000000000000000",Y={traceId:H,spanId:V,traceFlags:L.NONE},W=function(){function t(t){void 0===t&&(t=Y),this._spanContext=t}return t.prototype.spanContext=function(){return this._spanContext},t.prototype.setAttribute=function(t,e){return this},t.prototype.setAttributes=function(t){return this},t.prototype.addEvent=function(t,e){return this},t.prototype.setStatus=function(t){return this},t.prototype.updateName=function(t){return this},t.prototype.end=function(t){},t.prototype.isRecording=function(){return!1},t.prototype.recordException=function(t,e){},t}(),K=P("OpenTelemetry Context Key SPAN");function X(t){return t.getValue(K)||void 0}function q(t,e){return t.setValue(K,e)}function J(t){return t.deleteValue(K)}function Z(t,e){return q(t,new W(e))}function z(t){var e;return null===(e=X(t))||void 0===e?void 0:e.spanContext()}var $=/^([0-9a-f]{32})$/i,Q=/^[0-9a-f]{16}$/i;function tt(t){return $.test(t)&&t!==H}function et(t){return tt(t.traceId)&&(e=t.spanId,Q.test(e)&&e!==V);var e}function nt(t){return new W(t)}var rt,ot,it,at=j.getInstance(),st=function(){function t(){}return t.prototype.startSpan=function(t,e,n){if(Boolean(null===e||void 0===e?void 0:e.root))return new W;var r,o=n&&z(n);return"object"===typeof(r=o)&&"string"===typeof r.spanId&&"string"===typeof r.traceId&&"number"===typeof r.traceFlags&&et(o)?new W(o):new W},t.prototype.startActiveSpan=function(t,e,n,r){var o,i,a;if(!(arguments.length<2)){2===arguments.length?a=e:3===arguments.length?(o=e,a=n):(o=e,i=n,a=r);var s=null!==i&&void 0!==i?i:at.active(),u=this.startSpan(t,o,s),c=q(s,u);return at.with(c,a,void 0,u)}},t}(),ut=new st,ct=function(){function t(t,e,n){this._provider=t,this.name=e,this.version=n}return t.prototype.startSpan=function(t,e,n){return this._getTracer().startSpan(t,e,n)},t.prototype.startActiveSpan=function(t,e,n,r){var o=this._getTracer();return Reflect.apply(o.startActiveSpan,o,arguments)},t.prototype._getTracer=function(){if(this._delegate)return this._delegate;var t=this._provider.getDelegateTracer(this.name,this.version);return t?(this._delegate=t,this._delegate):ut},t}(),lt=new(function(){function t(){}return t.prototype.getTracer=function(t,e){return new st},t}()),dt=function(){function t(){}return t.prototype.getTracer=function(t,e){var n;return null!==(n=this.getDelegateTracer(t,e))&&void 0!==n?n:new ct(this,t,e)},t.prototype.getDelegate=function(){var t;return null!==(t=this._delegate)&&void 0!==t?t:lt},t.prototype.setDelegate=function(t){this._delegate=t},t.prototype.getDelegateTracer=function(t,e){var n;return null===(n=this._delegate)||void 0===n?void 0:n.getTracer(t,e)},t}();!function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(rt||(rt={})),function(t){t[t.INTERNAL=0]="INTERNAL",t[t.SERVER=1]="SERVER",t[t.CLIENT=2]="CLIENT",t[t.PRODUCER=3]="PRODUCER",t[t.CONSUMER=4]="CONSUMER"}(ot||(ot={})),function(t){t[t.UNSET=0]="UNSET",t[t.OK=1]="OK",t[t.ERROR=2]="ERROR"}(it||(it={}));var pt="trace",ft=function(){function t(){this._proxyTracerProvider=new dt,this.wrapSpanContext=nt,this.isSpanContextValid=et,this.deleteSpan=J,this.getSpan=X,this.getSpanContext=z,this.setSpan=q,this.setSpanContext=Z}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalTracerProvider=function(t){var e=g(pt,this._proxyTracerProvider,S.instance());return e&&this._proxyTracerProvider.setDelegate(t),e},t.prototype.getTracerProvider=function(){return m(pt)||this._proxyTracerProvider},t.prototype.getTracer=function(t,e){return this.getTracerProvider().getTracer(t,e)},t.prototype.disable=function(){b(pt,S.instance()),this._proxyTracerProvider=new dt},t}(),ht=function(){function t(){}return t.prototype.inject=function(t,e){},t.prototype.extract=function(t,e){return t},t.prototype.fields=function(){return[]},t}(),vt=P("OpenTelemetry Baggage Key");function _t(t){return t.getValue(vt)||void 0}function yt(t,e){return t.setValue(vt,e)}function Et(t){return t.deleteValue(vt)}var gt="propagation",mt=new ht,bt=function(){function t(){this.createBaggage=I,this.getBaggage=_t,this.setBaggage=yt,this.deleteBaggage=Et}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalPropagator=function(t){return g(gt,t,S.instance())},t.prototype.inject=function(t,e,n){return void 0===n&&(n=R),this._getGlobalPropagator().inject(t,e,n)},t.prototype.extract=function(t,e,n){return void 0===n&&(n=N),this._getGlobalPropagator().extract(t,e,n)},t.prototype.fields=function(){return this._getGlobalPropagator().fields()},t.prototype.disable=function(){b(gt,S.instance())},t.prototype._getGlobalPropagator=function(){return m(gt)||mt},t}(),Ct=j.getInstance(),Tt=ft.getInstance(),At=bt.getInstance(),St=S.instance(),Ot=P("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function Dt(t){return t.setValue(Ot,!0)}function wt(t){return!0===t.getValue(Ot)}var It="baggage";function Nt(t){var e=t.split(";");if(!(e.length<=0)){var n=e.shift();if(n){var r=n.split("=");if(2===r.length){var o,i,a=decodeURIComponent(r[0].trim()),s=decodeURIComponent(r[1].trim());return e.length>0&&("string"!==typeof(i=e.join(";"))&&(w.error("Cannot create baggage metadata from unknown type: "+typeof i),i=""),o={__TYPE__:D,toString:function(){return i}}),{key:a,value:s,metadata:o}}}}}function Rt(t){return"string"!==typeof t||0===t.length?{}:t.split(",").map((function(t){return Nt(t)})).filter((function(t){return void 0!==t&&t.value.length>0})).reduce((function(t,e){return t[e.key]=e.value,t}),{})}var Pt=function(){function t(){}return t.prototype.inject=function(t,e,n){var r=At.getBaggage(t);if(r&&!wt(t)){var o=function(t){return t.getAllEntries().map((function(t){var e=t[0],n=t[1];return encodeURIComponent(e)+"="+encodeURIComponent(n.value)}))}(r).filter((function(t){return t.length<=4096})).slice(0,180),i=function(t){return t.reduce((function(t,e){var n=t+(""!==t?",":"")+e;return n.length>8192?t:n}),"")}(o);i.length>0&&n.set(e,It,i)}},t.prototype.extract=function(t,e,n){var r=n.get(e,It);if(!r)return t;var o={};return 0===r.length?t:(r.split(",").forEach((function(t){var e=Nt(t);if(e){var n={value:e.value};e.metadata&&(n.metadata=e.metadata),o[e.key]=n}})),0===Object.entries(o).length?t:At.setBaggage(t,At.createBaggage(o)))},t.prototype.fields=function(){return[It]},t}();function Lt(t){return null==t||(Array.isArray(t)?function(t){for(var e,n=0,r=t;n<r.length;n++){var o=r[n];if(null!=o){if(!e){if(Ut(o)){e=typeof o;continue}return!1}if(typeof o!==e)return!1}}return!0}(t):Ut(t))}function Ut(t){switch(typeof t){case"number":case"boolean":case"string":return!0}return!1}var kt,Mt=function(t){St.error(function(t){return"string"===typeof t?t:JSON.stringify(function(t){for(var e={},n=t;null!==n;)Object.getOwnPropertyNames(n).forEach((function(t){if(!e[t]){var r=n[t];r&&(e[t]=String(r))}})),n=Object.getPrototypeOf(n);return e}(t))}(t))};function xt(t){try{Mt(t)}catch(De){}}!function(t){t.AlwaysOff="always_off",t.AlwaysOn="always_on",t.ParentBasedAlwaysOff="parentbased_always_off",t.ParentBasedAlwaysOn="parentbased_always_on",t.ParentBasedTraceIdRatio="parentbased_traceidratio",t.TraceIdRatio="traceidratio"}(kt||(kt={}));var Bt=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT"];function Gt(t){return Bt.indexOf(t)>-1}var Ft=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS"];function jt(t){return Ft.indexOf(t)>-1}var Vt={CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:C.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:128,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_TRACES_EXPORTER:"none",OTEL_TRACES_SAMPLER:kt.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:""};function Ht(t,e,n,r,o){if(void 0===r&&(r=-1/0),void 0===o&&(o=1/0),"undefined"!==typeof n[t]){var i=Number(n[t]);isNaN(i)||(e[t]=i<r?r:i>o?o:i)}}function Yt(t,e,n,r){void 0===r&&(r=",");var o=n[t];"string"===typeof o&&(e[t]=o.split(r).map((function(t){return t.trim()})))}var Wt={ALL:C.ALL,VERBOSE:C.VERBOSE,DEBUG:C.DEBUG,INFO:C.INFO,WARN:C.WARN,ERROR:C.ERROR,NONE:C.NONE};function Kt(t,e,n){var r=n[t];if("string"===typeof r){var o=Wt[r.toUpperCase()];null!=o&&(e[t]=o)}}function Xt(){var t=function(t){var e={};for(var n in Vt){var r=n;if("OTEL_LOG_LEVEL"===r)Kt(r,e,t);else if(Gt(r))Ht(r,e,t);else if(jt(r))Yt(r,e,t);else{var o=t[r];"undefined"!==typeof o&&null!==o&&(e[r]=String(o))}}return e}(window);return Object.assign({},Vt,t)}function qt(t){for(var e=t.length,n="",r=0;r<e;r+=2){var o=t.substring(r,r+2),i=parseInt(o,16);n+=String.fromCharCode(i)}return btoa(n)}var Jt=function(){this.generateTraceId=zt(16),this.generateSpanId=zt(8)},Zt=Array(32);function zt(t){return function(){for(var e=0;e<2*t;e++)Zt[e]=Math.floor(16*Math.random())+48,Zt[e]>=58&&(Zt[e]+=39);return String.fromCharCode.apply(null,Zt.slice(0,2*t))}}var $t,Qt,te,ee,ne,re,oe,ie,ae,se,ue=performance,ce="exception.type",le="exception.message",de="exception.stacktrace",pe="http.method",fe="http.url",he="http.target",ve="http.host",_e="http.scheme",ye="http.status_code",Ee="http.user_agent",ge="http.response_content_length",me="http.response_content_length_uncompressed";!function(t){t.OTHER_SQL="other_sql",t.MSSQL="mssql",t.MYSQL="mysql",t.ORACLE="oracle",t.DB2="db2",t.POSTGRESQL="postgresql",t.REDSHIFT="redshift",t.HIVE="hive",t.CLOUDSCAPE="cloudscape",t.HSQLDB="hsqldb",t.PROGRESS="progress",t.MAXDB="maxdb",t.HANADB="hanadb",t.INGRES="ingres",t.FIRSTSQL="firstsql",t.EDB="edb",t.CACHE="cache",t.ADABAS="adabas",t.FIREBIRD="firebird",t.DERBY="derby",t.FILEMAKER="filemaker",t.INFORMIX="informix",t.INSTANTDB="instantdb",t.INTERBASE="interbase",t.MARIADB="mariadb",t.NETEZZA="netezza",t.PERVASIVE="pervasive",t.POINTBASE="pointbase",t.SQLITE="sqlite",t.SYBASE="sybase",t.TERADATA="teradata",t.VERTICA="vertica",t.H2="h2",t.COLDFUSION="coldfusion",t.CASSANDRA="cassandra",t.HBASE="hbase",t.MONGODB="mongodb",t.REDIS="redis",t.COUCHBASE="couchbase",t.COUCHDB="couchdb",t.COSMOSDB="cosmosdb",t.DYNAMODB="dynamodb",t.NEO4J="neo4j",t.GEODE="geode",t.ELASTICSEARCH="elasticsearch",t.MEMCACHED="memcached",t.COCKROACHDB="cockroachdb"}($t||($t={})),function(t){t.ALL="all",t.EACH_QUORUM="each_quorum",t.QUORUM="quorum",t.LOCAL_QUORUM="local_quorum",t.ONE="one",t.TWO="two",t.THREE="three",t.LOCAL_ONE="local_one",t.ANY="any",t.SERIAL="serial",t.LOCAL_SERIAL="local_serial"}(Qt||(Qt={})),function(t){t.DATASOURCE="datasource",t.HTTP="http",t.PUBSUB="pubsub",t.TIMER="timer",t.OTHER="other"}(te||(te={})),function(t){t.INSERT="insert",t.EDIT="edit",t.DELETE="delete"}(ee||(ee={})),function(t){t.AWS="aws",t.AZURE="azure",t.GCP="gcp"}(ne||(ne={})),function(t){t.IP_TCP="ip_tcp",t.IP_UDP="ip_udp",t.IP="ip",t.UNIX="unix",t.PIPE="pipe",t.INPROC="inproc",t.OTHER="other"}(re||(re={})),function(t){t.HTTP_1_0="1.0",t.HTTP_1_1="1.1",t.HTTP_2_0="2.0",t.SPDY="SPDY",t.QUIC="QUIC"}(oe||(oe={})),function(t){t.QUEUE="queue",t.TOPIC="topic"}(ie||(ie={})),function(t){t.RECEIVE="receive",t.PROCESS="process"}(ae||(ae={})),function(t){t[t.OK=0]="OK",t[t.CANCELLED=1]="CANCELLED",t[t.UNKNOWN=2]="UNKNOWN",t[t.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",t[t.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",t[t.NOT_FOUND=5]="NOT_FOUND",t[t.ALREADY_EXISTS=6]="ALREADY_EXISTS",t[t.PERMISSION_DENIED=7]="PERMISSION_DENIED",t[t.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",t[t.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",t[t.ABORTED=10]="ABORTED",t[t.OUT_OF_RANGE=11]="OUT_OF_RANGE",t[t.UNIMPLEMENTED=12]="UNIMPLEMENTED",t[t.INTERNAL=13]="INTERNAL",t[t.UNAVAILABLE=14]="UNAVAILABLE",t[t.DATA_LOSS=15]="DATA_LOSS",t[t.UNAUTHENTICATED=16]="UNAUTHENTICATED"}(se||(se={}));var be,Ce,Te,Ae,Se,Oe,De,we="process.runtime.name",Ie="service.name",Ne="telemetry.sdk.name",Re="telemetry.sdk.language",Pe="telemetry.sdk.version";!function(t){t.AWS="aws",t.AZURE="azure",t.GCP="gcp"}(be||(be={})),function(t){t.AWS_EC2="aws_ec2",t.AWS_ECS="aws_ecs",t.AWS_EKS="aws_eks",t.AWS_LAMBDA="aws_lambda",t.AWS_ELASTIC_BEANSTALK="aws_elastic_beanstalk",t.AZURE_VM="azure_vm",t.AZURE_CONTAINER_INSTANCES="azure_container_instances",t.AZURE_AKS="azure_aks",t.AZURE_FUNCTIONS="azure_functions",t.AZURE_APP_SERVICE="azure_app_service",t.GCP_COMPUTE_ENGINE="gcp_compute_engine",t.GCP_CLOUD_RUN="gcp_cloud_run",t.GCP_KUBERNETES_ENGINE="gcp_kubernetes_engine",t.GCP_CLOUD_FUNCTIONS="gcp_cloud_functions",t.GCP_APP_ENGINE="gcp_app_engine"}(Ce||(Ce={})),function(t){t.EC2="ec2",t.FARGATE="fargate"}(Te||(Te={})),function(t){t.AMD64="amd64",t.ARM32="arm32",t.ARM64="arm64",t.IA64="ia64",t.PPC32="ppc32",t.PPC64="ppc64",t.X86="x86"}(Ae||(Ae={})),function(t){t.WINDOWS="windows",t.LINUX="linux",t.DARWIN="darwin",t.FREEBSD="freebsd",t.NETBSD="netbsd",t.OPENBSD="openbsd",t.DRAGONFLYBSD="dragonflybsd",t.HPUX="hpux",t.AIX="aix",t.SOLARIS="solaris",t.Z_OS="z_os"}(Se||(Se={})),function(t){t.CPP="cpp",t.DOTNET="dotnet",t.ERLANG="erlang",t.GO="go",t.JAVA="java",t.NODEJS="nodejs",t.PHP="php",t.PYTHON="python",t.RUBY="ruby",t.WEBJS="webjs"}(Oe||(Oe={}));var Le,Ue=((De={})[Ne]="opentelemetry",De[we]="browser",De[Re]=Oe.WEBJS,De[Pe]="0.25.0",De),ke=Math.pow(10,9);function Me(t){var e=t/1e3,n=Math.trunc(e);return[n,Number((e-n).toFixed(9))*ke]}function xe(){var t=ue.timeOrigin;if("number"!==typeof t){var e=ue;t=e.timing&&e.timing.fetchStart}return t}function Be(t){var e=Me(xe()),n=Me("number"===typeof t?t:ue.now()),r=e[0]+n[0],o=e[1]+n[1];return o>ke&&(o-=ke,r+=1),[r,o]}function Ge(t){if(Ve(t))return t;if("number"===typeof t)return t<xe()?Be(t):Me(t);if(t instanceof Date)return Me(t.getTime());throw TypeError("Invalid input type")}function Fe(t){return t[0]*ke+t[1]}function je(t){return Math.round(1e6*t[0]+t[1]/1e3)}function Ve(t){return Array.isArray(t)&&2===t.length&&"number"===typeof t[0]&&"number"===typeof t[1]}!function(t){t[t.SUCCESS=0]="SUCCESS",t[t.FAILED=1]="FAILED"}(Le||(Le={}));var He,Ye=function(){function t(t){var e;void 0===t&&(t={}),this._propagators=null!==(e=t.propagators)&&void 0!==e?e:[],this._fields=Array.from(new Set(this._propagators.map((function(t){return"function"===typeof t.fields?t.fields():[]})).reduce((function(t,e){return t.concat(e)}),[])))}return t.prototype.inject=function(t,e,n){for(var r=0,o=this._propagators;r<o.length;r++){var i=o[r];try{i.inject(t,e,n)}catch(a){St.warn("Failed to inject with "+i.constructor.name+". Err: "+a.message)}}},t.prototype.extract=function(t,e,n){return this._propagators.reduce((function(t,r){try{return r.extract(t,e,n)}catch(o){St.warn("Failed to inject with "+r.constructor.name+". Err: "+o.message)}return t}),t)},t.prototype.fields=function(){return this._fields.slice()},t}(),We=new RegExp("^(?:[a-z][_0-9a-z-*/]{0,255}|[a-z0-9][_0-9a-z-*/]{0,240}@[a-z][_0-9a-z-*/]{0,13})$"),Ke=/^[ -~]{0,255}[!-~]$/,Xe=/,|=/,qe=function(){function t(t){this._internalState=new Map,t&&this._parse(t)}return t.prototype.set=function(t,e){var n=this._clone();return n._internalState.has(t)&&n._internalState.delete(t),n._internalState.set(t,e),n},t.prototype.unset=function(t){var e=this._clone();return e._internalState.delete(t),e},t.prototype.get=function(t){return this._internalState.get(t)},t.prototype.serialize=function(){var t=this;return this._keys().reduce((function(e,n){return e.push(n+"="+t.get(n)),e}),[]).join(",")},t.prototype._parse=function(t){t.length>512||(this._internalState=t.split(",").reverse().reduce((function(t,e){var n=e.trim(),r=n.indexOf("=");if(-1!==r){var o=n.slice(0,r),i=n.slice(r+1,e.length);(function(t){return We.test(t)})(o)&&function(t){return Ke.test(t)&&!Xe.test(t)}(i)&&t.set(o,i)}return t}),new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))},t.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},t.prototype._clone=function(){var e=new t;return e._internalState=new Map(this._internalState),e},t}(),Je="traceparent",Ze="tracestate",ze=new RegExp("^\\s?((?!ff)[\\da-f]{2})-((?![0]{32})[\\da-f]{32})-((?![0]{16})[\\da-f]{16})-([\\da-f]{2})(-.*)?\\s?$"),$e=function(){function t(){}return t.prototype.inject=function(t,e,n){var r=Tt.getSpanContext(t);if(r&&!wt(t)&&et(r)){var o="00-"+r.traceId+"-"+r.spanId+"-0"+Number(r.traceFlags||L.NONE).toString(16);n.set(e,Je,o),r.traceState&&n.set(e,Ze,r.traceState.serialize())}},t.prototype.extract=function(t,e,n){var r=n.get(e,Je);if(!r)return t;var o=Array.isArray(r)?r[0]:r;if("string"!==typeof o)return t;var i=function(t){var e=ze.exec(t);return e?"00"===e[1]&&e[5]?null:{traceId:e[2],spanId:e[3],traceFlags:parseInt(e[4],16)}:null}(o);if(!i)return t;i.isRemote=!0;var a=n.get(e,Ze);if(a){var s=Array.isArray(a)?a.join(","):a;i.traceState=new qe("string"===typeof s?s:void 0)}return Tt.setSpanContext(t,i)},t.prototype.fields=function(){return[Je,Ze]},t}();!function(t){t.HTTP="http"}(He||(He={}));var Qe=function(){function t(){}return t.prototype.shouldSample=function(){return{decision:rt.NOT_RECORD}},t.prototype.toString=function(){return"AlwaysOffSampler"},t}(),tn=function(){function t(){}return t.prototype.shouldSample=function(){return{decision:rt.RECORD_AND_SAMPLED}},t.prototype.toString=function(){return"AlwaysOnSampler"},t}(),en=function(){function t(t){var e,n,r,o;this._root=t.root,this._root||(xt(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new tn),this._remoteParentSampled=null!==(e=t.remoteParentSampled)&&void 0!==e?e:new tn,this._remoteParentNotSampled=null!==(n=t.remoteParentNotSampled)&&void 0!==n?n:new Qe,this._localParentSampled=null!==(r=t.localParentSampled)&&void 0!==r?r:new tn,this._localParentNotSampled=null!==(o=t.localParentNotSampled)&&void 0!==o?o:new Qe}return t.prototype.shouldSample=function(t,e,n,r,o,i){var a=Tt.getSpanContext(t);return a&&et(a)?a.isRemote?a.traceFlags&L.SAMPLED?this._remoteParentSampled.shouldSample(t,e,n,r,o,i):this._remoteParentNotSampled.shouldSample(t,e,n,r,o,i):a.traceFlags&L.SAMPLED?this._localParentSampled.shouldSample(t,e,n,r,o,i):this._localParentNotSampled.shouldSample(t,e,n,r,o,i):this._root.shouldSample(t,e,n,r,o,i)},t.prototype.toString=function(){return"ParentBased{root="+this._root.toString()+", remoteParentSampled="+this._remoteParentSampled.toString()+", remoteParentNotSampled="+this._remoteParentNotSampled.toString()+", localParentSampled="+this._localParentSampled.toString()+", localParentNotSampled="+this._localParentNotSampled.toString()+"}"},t}(),nn=function(){function t(t){void 0===t&&(t=0),this._ratio=t,this._ratio=this._normalize(t),this._upperBound=Math.floor(4294967295*this._ratio)}return t.prototype.shouldSample=function(t,e){return{decision:tt(e)&&this._accumulate(e)<this._upperBound?rt.RECORD_AND_SAMPLED:rt.NOT_RECORD}},t.prototype.toString=function(){return"TraceIdRatioBased{"+this._ratio+"}"},t.prototype._normalize=function(t){return"number"!==typeof t||isNaN(t)?0:t>=1?1:t<=0?0:t},t.prototype._accumulate=function(t){for(var e=0,n=0;n<t.length/8;n++){var r=8*n;e=(e^parseInt(t.slice(r,r+8),16))>>>0}return e},t}();function rn(t,e){return"string"===typeof e?t===e:e.test(t)}var on=function(){function t(t,e,n,r,o,i,a,s){void 0===a&&(a=[]),void 0===s&&(s=Be()),this.attributes={},this.links=[],this.events=[],this.status={code:it.UNSET},this.endTime=[0,0],this._ended=!1,this._duration=[-1,-1],this.name=n,this._spanContext=r,this.parentSpanId=i,this.kind=o,this.links=a,this.startTime=Ge(s),this.resource=t.resource,this.instrumentationLibrary=t.instrumentationLibrary,this._spanLimits=t.getSpanLimits(),this._spanProcessor=t.getActiveSpanProcessor(),this._spanProcessor.onStart(this,e)}return t.prototype.spanContext=function(){return this._spanContext},t.prototype.setAttribute=function(t,e){return null==e||this._isSpanEnded()?this:0===t.length?(St.warn("Invalid attribute key: "+t),this):Lt(e)?(Object.keys(this.attributes).length>=this._spanLimits.attributeCountLimit&&!Object.prototype.hasOwnProperty.call(this.attributes,t)||(this.attributes[t]=e),this):(St.warn("Invalid attribute value set for key: "+t),this)},t.prototype.setAttributes=function(t){for(var e=0,n=Object.entries(t);e<n.length;e++){var r=n[e],o=r[0],i=r[1];this.setAttribute(o,i)}return this},t.prototype.addEvent=function(t,e,n){return this._isSpanEnded()||(this.events.length>=this._spanLimits.eventCountLimit&&(St.warn("Dropping extra events."),this.events.shift()),(Ve(r=e)||"number"===typeof r||r instanceof Date)&&("undefined"===typeof n&&(n=e),e=void 0),"undefined"===typeof n&&(n=Be()),this.events.push({name:t,attributes:e,time:Ge(n)})),this;var r},t.prototype.setStatus=function(t){return this._isSpanEnded()||(this.status=t),this},t.prototype.updateName=function(t){return this._isSpanEnded()||(this.name=t),this},t.prototype.end=function(t){void 0===t&&(t=Be()),this._isSpanEnded()?St.error("You can only call end() on a span once."):(this._ended=!0,this.endTime=Ge(t),this._duration=function(t,e){var n=e[0]-t[0],r=e[1]-t[1];return r<0&&(n-=1,r+=ke),[n,r]}(this.startTime,this.endTime),this._duration[0]<0&&St.warn("Inconsistent start and end time, startTime > endTime",this.startTime,this.endTime),this._spanProcessor.onEnd(this))},t.prototype.isRecording=function(){return!1===this._ended},t.prototype.recordException=function(t,e){void 0===e&&(e=Be());var n={};"string"===typeof t?n[le]=t:t&&(t.code?n[ce]=t.code.toString():t.name&&(n[ce]=t.name),t.message&&(n[le]=t.message),t.stack&&(n[de]=t.stack)),n[ce]||n[le]?this.addEvent("exception",n,e):St.warn("Failed to record an exception "+t)},Object.defineProperty(t.prototype,"duration",{get:function(){return this._duration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ended",{get:function(){return this._ended},enumerable:!1,configurable:!0}),t.prototype._isSpanEnded=function(){return this._ended&&St.warn("Can not execute the operation on ended Span {traceId: %s, spanId: %s}",this._spanContext.traceId,this._spanContext.spanId),this._ended},t}(),an=Xt(),sn=kt.AlwaysOn,un={sampler:cn(an),forceFlushTimeoutMillis:3e4,spanLimits:{attributeCountLimit:Xt().OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT,linkCountLimit:Xt().OTEL_SPAN_LINK_COUNT_LIMIT,eventCountLimit:Xt().OTEL_SPAN_EVENT_COUNT_LIMIT}};function cn(t){switch(void 0===t&&(t=Xt()),t.OTEL_TRACES_SAMPLER){case kt.AlwaysOn:return new tn;case kt.AlwaysOff:return new Qe;case kt.ParentBasedAlwaysOn:return new en({root:new tn});case kt.ParentBasedAlwaysOff:return new en({root:new Qe});case kt.TraceIdRatio:return new nn(ln(t));case kt.ParentBasedTraceIdRatio:return new en({root:new nn(ln(t))});default:return St.error('OTEL_TRACES_SAMPLER value "'+t.OTEL_TRACES_SAMPLER+" invalid, defaulting to "+sn+'".'),new tn}}function ln(t){if(void 0===t.OTEL_TRACES_SAMPLER_ARG||""===t.OTEL_TRACES_SAMPLER_ARG)return St.error("OTEL_TRACES_SAMPLER_ARG is blank, defaulting to 1."),1;var e=Number(t.OTEL_TRACES_SAMPLER_ARG);return isNaN(e)?(St.error("OTEL_TRACES_SAMPLER_ARG="+t.OTEL_TRACES_SAMPLER_ARG+" was given, but it is invalid, defaulting to 1."),1):e<0||e>1?(St.error("OTEL_TRACES_SAMPLER_ARG="+t.OTEL_TRACES_SAMPLER_ARG+" was given, but it is out of range ([0..1]), defaulting to 1."),1):e}var dn,pn=function(){function t(t,e,n){this._tracerProvider=n;var r=function(t){var e={sampler:cn()},n=Object.assign({},un,e,t);return n.spanLimits=Object.assign({},un.spanLimits,t.spanLimits||{}),n}(e);this._sampler=r.sampler,this._spanLimits=r.spanLimits,this._idGenerator=e.idGenerator||new Jt,this.resource=n.resource,this.instrumentationLibrary=t}return t.prototype.startSpan=function(t,e,n){var r,o;if(void 0===e&&(e={}),void 0===n&&(n=Ct.active()),wt(n))return St.debug("Instrumentation suppressed, returning Noop Span"),Tt.wrapSpanContext(Y);var i,a,s,u=function(t,e){return t.root?void 0:Tt.getSpanContext(e)}(e,n),c=this._idGenerator.generateSpanId();u&&Tt.isSpanContextValid(u)?(i=u.traceId,a=u.traceState,s=u.spanId):i=this._idGenerator.generateTraceId();var l=null!==(r=e.kind)&&void 0!==r?r:ot.INTERNAL,d=null!==(o=e.links)&&void 0!==o?o:[],p=function(t){var e={};if(null==t||"object"!==typeof t)return e;for(var n=0,r=Object.entries(t);n<r.length;n++){var o=r[n],i=o[0],a=o[1];Lt(a)&&(Array.isArray(a)?e[i]=a.slice():e[i]=a)}return e}(e.attributes),f=this._sampler.shouldSample(e.root?Tt.setSpanContext(n,Y):n,i,t,l,p,d),h={traceId:i,spanId:c,traceFlags:f.decision===rt.RECORD_AND_SAMPLED?L.SAMPLED:L.NONE,traceState:a};if(f.decision===rt.NOT_RECORD)return St.debug("Recording is off, propagating context in a non-recording span"),Tt.wrapSpanContext(h);var v=new on(this,n,t,h,l,s,d,e.startTime);return v.setAttributes(Object.assign(p,f.attributes)),v},t.prototype.startActiveSpan=function(t,e,n,r){var o,i,a;if(!(arguments.length<2)){2===arguments.length?a=e:3===arguments.length?(o=e,a=n):(o=e,i=n,a=r);var s=null!==i&&void 0!==i?i:Ct.active(),u=this.startSpan(t,o,s),c=Tt.setSpan(s,u);return Ct.with(c,a,void 0,u)}},t.prototype.getSpanLimits=function(){return this._spanLimits},t.prototype.getActiveSpanProcessor=function(){return this._tracerProvider.getActiveSpanProcessor()},t}(),fn=function(){function t(t){this.attributes=t}return t.empty=function(){return t.EMPTY},t.default=function(){var e;return new t(((e={})[Ie]="unknown_service",e[Re]=Ue[Re],e[Ne]=Ue[Ne],e[Pe]=Ue[Pe],e))},t.prototype.merge=function(e){return e&&Object.keys(e.attributes).length?new t(Object.assign({},this.attributes,e.attributes)):this},t.EMPTY=new t({}),t}(),hn=function(){function t(t){this._spanProcessors=t}return t.prototype.forceFlush=function(){for(var t=[],e=0,n=this._spanProcessors;e<n.length;e++){var r=n[e];t.push(r.forceFlush())}return new Promise((function(e){Promise.all(t).then((function(){e()})).catch((function(t){xt(t||new Error("MultiSpanProcessor: forceFlush failed")),e()}))}))},t.prototype.onStart=function(t,e){for(var n=0,r=this._spanProcessors;n<r.length;n++)r[n].onStart(t,e)},t.prototype.onEnd=function(t){for(var e=0,n=this._spanProcessors;e<n.length;e++)n[e].onEnd(t)},t.prototype.shutdown=function(){for(var t=[],e=0,n=this._spanProcessors;e<n.length;e++){var r=n[e];t.push(r.shutdown())}return new Promise((function(e,n){Promise.all(t).then((function(){e()}),n)}))},t}(),vn=function(){function t(){}return t.prototype.onStart=function(t,e){},t.prototype.onEnd=function(t){},t.prototype.shutdown=function(){return Promise.resolve()},t.prototype.forceFlush=function(){return Promise.resolve()},t}(),_n=function(){function t(t,e){this._exporter=t,this._finishedSpans=[],this._isShutdown=!1,this._shuttingDownPromise=Promise.resolve();var n=Xt();this._maxExportBatchSize="number"===typeof(null===e||void 0===e?void 0:e.maxExportBatchSize)?e.maxExportBatchSize:n.OTEL_BSP_MAX_EXPORT_BATCH_SIZE,this._maxQueueSize="number"===typeof(null===e||void 0===e?void 0:e.maxQueueSize)?e.maxQueueSize:n.OTEL_BSP_MAX_QUEUE_SIZE,this._scheduledDelayMillis="number"===typeof(null===e||void 0===e?void 0:e.scheduledDelayMillis)?e.scheduledDelayMillis:n.OTEL_BSP_SCHEDULE_DELAY,this._exportTimeoutMillis="number"===typeof(null===e||void 0===e?void 0:e.exportTimeoutMillis)?e.exportTimeoutMillis:n.OTEL_BSP_EXPORT_TIMEOUT}return t.prototype.forceFlush=function(){return this._isShutdown?this._shuttingDownPromise:this._flushAll()},t.prototype.onStart=function(t){},t.prototype.onEnd=function(t){this._isShutdown||0!==(t.spanContext().traceFlags&L.SAMPLED)&&this._addToBuffer(t)},t.prototype.shutdown=function(){var t=this;return this._isShutdown||(this._isShutdown=!0,this._shuttingDownPromise=new Promise((function(e,n){Promise.resolve().then((function(){return t.onShutdown()})).then((function(){return t._flushAll()})).then((function(){return t._exporter.shutdown()})).then(e).catch((function(t){n(t)}))}))),this._shuttingDownPromise},t.prototype._addToBuffer=function(t){this._finishedSpans.length>=this._maxQueueSize||(this._finishedSpans.push(t),this._maybeStartTimer())},t.prototype._flushAll=function(){var t=this;return new Promise((function(e,n){for(var r=[],o=0,i=Math.ceil(t._finishedSpans.length/t._maxExportBatchSize);o<i;o++)r.push(t._flushOneBatch());Promise.all(r).then((function(){e()})).catch(n)}))},t.prototype._flushOneBatch=function(){var t=this;return this._clearTimer(),0===this._finishedSpans.length?Promise.resolve():new Promise((function(e,n){var r=setTimeout((function(){n(new Error("Timeout"))}),t._exportTimeoutMillis);Ct.with(Dt(Ct.active()),(function(){t._exporter.export(t._finishedSpans.splice(0,t._maxExportBatchSize),(function(t){var o;clearTimeout(r),t.code===Le.SUCCESS?e():n(null!==(o=t.error)&&void 0!==o?o:new Error("BatchSpanProcessor: span export failed"))}))}))}))},t.prototype._maybeStartTimer=function(){var t=this;void 0===this._timer&&(this._timer=setTimeout((function(){t._flushOneBatch().then((function(){t._finishedSpans.length>0&&(t._clearTimer(),t._maybeStartTimer())})).catch((function(t){xt(t)}))}),this._scheduledDelayMillis),this._timer)},t.prototype._clearTimer=function(){void 0!==this._timer&&(clearTimeout(this._timer),this._timer=void 0)},t}(),yn=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),En=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.onInit(n),r}return yn(e,t),e.prototype.onInit=function(t){var e=this;!0!==(null===t||void 0===t?void 0:t.disableAutoFlushOnDocumentHide)&&null!=document&&(this._visibilityChangeListener=function(){"hidden"===document.visibilityState&&e.forceFlush()},this._pageHideListener=function(){e.forceFlush()},document.addEventListener("visibilitychange",this._visibilityChangeListener),document.addEventListener("pagehide",this._pageHideListener))},e.prototype.onShutdown=function(){this._visibilityChangeListener&&document.removeEventListener("visibilitychange",this._visibilityChangeListener),this._pageHideListener&&document.removeEventListener("pagehide",this._pageHideListener)},e}(_n);!function(t){t[t.resolved=0]="resolved",t[t.timeout=1]="timeout",t[t.error=2]="error",t[t.unresolved=3]="unresolved"}(dn||(dn={}));var gn,mn,bn=function(){function t(t){var e;void 0===t&&(t={}),this._registeredSpanProcessors=[],this._tracers=new Map;var n=o()({},un,t);this.resource=null!==(e=n.resource)&&void 0!==e?e:fn.empty(),this.resource=fn.default().merge(this.resource),this._config=Object.assign({},n,{resource:this.resource});var r=this._buildExporterFromEnv();if(void 0!==r){var i=new En(r);this.activeSpanProcessor=i}else this.activeSpanProcessor=new vn}return t.prototype.getTracer=function(t,e){var n=t+"@"+(e||"");return this._tracers.has(n)||this._tracers.set(n,new pn({name:t,version:e},this._config,this)),this._tracers.get(n)},t.prototype.addSpanProcessor=function(t){0===this._registeredSpanProcessors.length&&this.activeSpanProcessor.shutdown().catch((function(t){return St.error("Error while trying to shutdown current span processor",t)})),this._registeredSpanProcessors.push(t),this.activeSpanProcessor=new hn(this._registeredSpanProcessors)},t.prototype.getActiveSpanProcessor=function(){return this.activeSpanProcessor},t.prototype.register=function(t){void 0===t&&(t={}),Tt.setGlobalTracerProvider(this),void 0===t.propagator&&(t.propagator=this._buildPropagatorFromEnv()),t.contextManager&&Ct.setGlobalContextManager(t.contextManager),t.propagator&&At.setGlobalPropagator(t.propagator)},t.prototype.forceFlush=function(){var t=this._config.forceFlushTimeoutMillis,e=this._registeredSpanProcessors.map((function(e){return new Promise((function(n){var r,o=setTimeout((function(){n(new Error("Span processor did not completed within timeout period of "+t+" ms")),r=dn.timeout}),t);e.forceFlush().then((function(){clearTimeout(o),r!==dn.timeout&&(r=dn.resolved,n(r))})).catch((function(t){clearTimeout(o),r=dn.error,n(t)}))}))}));return new Promise((function(t,n){Promise.all(e).then((function(e){var r=e.filter((function(t){return t!==dn.resolved}));r.length>0?n(r):t()})).catch((function(t){return n([t])}))}))},t.prototype.shutdown=function(){return this.activeSpanProcessor.shutdown()},t.prototype._getPropagator=function(e){var n;return null===(n=t._registeredPropagators.get(e))||void 0===n?void 0:n()},t.prototype._getSpanExporter=function(e){var n;return null===(n=t._registeredExporters.get(e))||void 0===n?void 0:n()},t.prototype._buildPropagatorFromEnv=function(){var t=this,e=Array.from(new Set(Xt().OTEL_PROPAGATORS)),n=e.map((function(e){var n=t._getPropagator(e);return n||St.warn('Propagator "'+e+'" requested through environment variable is unavailable.'),n})).reduce((function(t,e){return e&&t.push(e),t}),[]);return 0===n.length?void 0:1===e.length?n[0]:new Ye({propagators:n})},t.prototype._buildExporterFromEnv=function(){var t=Xt().OTEL_TRACES_EXPORTER;if("none"!==t){var e=this._getSpanExporter(t);return e||St.error('Exporter "'+t+'" requested through environment variable is unavailable.'),e}},t._registeredPropagators=new Map([["tracecontext",function(){return new $e}],["baggage",function(){return new Pt}]]),t._registeredExporters=new Map,t}(),Cn=function(){function t(){}return t.prototype.export=function(t,e){return this._sendSpans(t,e)},t.prototype.shutdown=function(){return this._sendSpans([]),Promise.resolve()},t.prototype._exportInfo=function(t){return{traceId:t.spanContext().traceId,parentId:t.parentSpanId,name:t.name,id:t.spanContext().spanId,kind:t.kind,timestamp:je(t.startTime),duration:je(t.duration),attributes:t.attributes,status:t.status,events:t.events}},t.prototype._sendSpans=function(t,e){for(var n=0,r=t;n<r.length;n++){var o=r[n];this._exportInfo(o)}if(e)return e({code:Le.SUCCESS})},t}(),Tn=function(){function t(t){this._exporter=t,this._isShutdown=!1,this._shuttingDownPromise=Promise.resolve()}return t.prototype.forceFlush=function(){return Promise.resolve()},t.prototype.onStart=function(t){},t.prototype.onEnd=function(t){var e=this;this._isShutdown||0!==(t.spanContext().traceFlags&L.SAMPLED)&&Ct.with(Dt(Ct.active()),(function(){e._exporter.export([t],(function(t){var e;t.code!==Le.SUCCESS&&xt(null!==(e=t.error)&&void 0!==e?e:new Error("SimpleSpanProcessor: span export failed (status "+t+")"))}))}))},t.prototype.shutdown=function(){var t=this;return this._isShutdown||(this._isShutdown=!0,this._shuttingDownPromise=new Promise((function(e,n){Promise.resolve().then((function(){return t._exporter.shutdown()})).then(e).catch((function(t){n(t)}))}))),this._shuttingDownPromise},t}(),An=function(t,e){for(var n=0,r=e.length,o=t.length;n<r;n++,o++)t[o]=e[n];return t},Sn=function(){function t(){this._enabled=!1,this._currentContext=k}return t.prototype._bindFunction=function(t,e){void 0===t&&(t=k);var n=this,r=function(){for(var r=this,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];return n.with(t,(function(){return e.apply(r,o)}))};return Object.defineProperty(r,"length",{enumerable:!1,configurable:!0,writable:!1,value:e.length}),r},t.prototype.active=function(){return this._currentContext},t.prototype.bind=function(t,e){return void 0===t&&(t=this.active()),"function"===typeof e?this._bindFunction(t,e):e},t.prototype.disable=function(){return this._currentContext=k,this._enabled=!1,this},t.prototype.enable=function(){return this._enabled||(this._enabled=!0,this._currentContext=k),this},t.prototype.with=function(t,e,n){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];var i=this._currentContext;this._currentContext=t||k;try{return e.call.apply(e,An([n],r))}finally{this._currentContext=i}},t}(),On=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Dn=function(t){function e(e){void 0===e&&(e={});var n=t.call(this,e)||this;if(e.contextManager)throw"contextManager should be defined in register method not in constructor";if(e.propagator)throw"propagator should be defined in register method not in constructor";return n}return On(e,t),e.prototype.register=function(e){void 0===e&&(e={}),void 0===e.contextManager&&(e.contextManager=new Sn),e.contextManager&&e.contextManager.enable(),t.prototype.register.call(this,e)},e}(bn);function wn(){return mn||(mn=document.createElement("a")),mn}function In(t,e){return e in t}function Nn(t,e,n){if(In(n,e)&&"number"===typeof n[e])return t.addEvent(e,n[e]),t}function Rn(t,e){Nn(t,gn.FETCH_START,e),Nn(t,gn.DOMAIN_LOOKUP_START,e),Nn(t,gn.DOMAIN_LOOKUP_END,e),Nn(t,gn.CONNECT_START,e),Nn(t,gn.SECURE_CONNECTION_START,e),Nn(t,gn.CONNECT_END,e),Nn(t,gn.REQUEST_START,e),Nn(t,gn.RESPONSE_START,e),Nn(t,gn.RESPONSE_END,e);var n=e[gn.ENCODED_BODY_SIZE];void 0!==n&&t.setAttribute(ge,n);var r=e[gn.DECODED_BODY_SIZE];void 0!==r&&n!==r&&t.setAttribute(me,r)}function Pn(t,e,n,r,o,i){void 0===o&&(o=new WeakSet);var a=wn();a.href=t;var s=function(t,e,n,r,o,i){var a=Fe(e),s=Fe(n),u=r.filter((function(e){var n=Fe(Ge(e[gn.FETCH_START])),r=Fe(Ge(e[gn.RESPONSE_END]));return e.initiatorType.toLowerCase()===(i||"xmlhttprequest")&&e.name===t&&n>=a&&r<=s}));return u.length>0&&(u=u.filter((function(t){return!o.has(t)}))),u}(t=a.href,e,n,r,o,i);if(0===s.length)return{mainRequest:void 0};if(1===s.length)return{mainRequest:s[0]};var u=function(t){return t.slice().sort((function(t,e){var n=t[gn.FETCH_START],r=e[gn.FETCH_START];return n>r?1:n<r?-1:0}))}(s);if(Ln(t).origin!==window.location.origin&&u.length>1){var c=u[0],l=function(t,e,n){for(var r,o=Fe(n),i=Fe(Ge(e)),a=t[1],s=t.length,u=1;u<s;u++){var c=t[u],l=Fe(Ge(c[gn.FETCH_START])),d=o-Fe(Ge(c[gn.RESPONSE_END]));l>=i&&(!r||d<r)&&(r=d,a=c)}return a}(u,c[gn.RESPONSE_END],n),d=c[gn.RESPONSE_END];return l[gn.FETCH_START]<d&&(l=c,c=void 0),{corsPreFlightRequest:c,mainRequest:l}}return{mainRequest:s[0]}}function Ln(t){var e=document.createElement("a");return e.href=t,e}!function(t){t.CONNECT_END="connectEnd",t.CONNECT_START="connectStart",t.DECODED_BODY_SIZE="decodedBodySize",t.DOM_COMPLETE="domComplete",t.DOM_CONTENT_LOADED_EVENT_END="domContentLoadedEventEnd",t.DOM_CONTENT_LOADED_EVENT_START="domContentLoadedEventStart",t.DOM_INTERACTIVE="domInteractive",t.DOMAIN_LOOKUP_END="domainLookupEnd",t.DOMAIN_LOOKUP_START="domainLookupStart",t.ENCODED_BODY_SIZE="encodedBodySize",t.FETCH_START="fetchStart",t.LOAD_EVENT_END="loadEventEnd",t.LOAD_EVENT_START="loadEventStart",t.NAVIGATION_START="navigationStart",t.REDIRECT_END="redirectEnd",t.REDIRECT_START="redirectStart",t.REQUEST_START="requestStart",t.RESPONSE_END="responseEnd",t.RESPONSE_START="responseStart",t.SECURE_CONNECTION_START="secureConnectionStart",t.UNLOAD_EVENT_END="unloadEventEnd",t.UNLOAD_EVENT_START="unloadEventStart"}(gn||(gn={}));var Un,kn,Mn=function(){function t(t){void 0===t&&(t={}),this._isShutdown=!1,this._shuttingDownPromise=Promise.resolve(),this._sendingPromises=[],this.url=this.getDefaultUrl(t),"string"===typeof t.hostname&&(this.hostname=t.hostname),this.attributes=t.attributes,this.shutdown=this.shutdown.bind(this),this._concurrencyLimit="number"===typeof t.concurrencyLimit?t.concurrencyLimit:1/0,this.onInit(t)}return t.prototype.export=function(t,e){this._isShutdown?e({code:Le.FAILED,error:new Error("Exporter has been shutdown")}):this._sendingPromises.length>=this._concurrencyLimit?e({code:Le.FAILED,error:new Error("Concurrent export limit reached")}):this._export(t).then((function(){e({code:Le.SUCCESS})})).catch((function(t){e({code:Le.FAILED,error:t})}))},t.prototype._export=function(t){var e=this;return new Promise((function(n,r){try{St.debug("items to be sent",t),e.send(t,n,r)}catch(o){r(o)}}))},t.prototype.shutdown=function(){var t=this;return this._isShutdown?(St.debug("shutdown already started"),this._shuttingDownPromise):(this._isShutdown=!0,St.debug("shutdown started"),this._shuttingDownPromise=new Promise((function(e,n){Promise.resolve().then((function(){return t.onShutdown()})).then((function(){return Promise.all(t._sendingPromises)})).then((function(){e()})).catch((function(t){n(t)}))})),this._shuttingDownPromise)},t}(),xn=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();!function(t){!function(t){!function(t){!function(t){t[t.AGGREGATION_TEMPORALITY_UNSPECIFIED=0]="AGGREGATION_TEMPORALITY_UNSPECIFIED",t[t.AGGREGATION_TEMPORALITY_DELTA=1]="AGGREGATION_TEMPORALITY_DELTA",t[t.AGGREGATION_TEMPORALITY_CUMULATIVE=2]="AGGREGATION_TEMPORALITY_CUMULATIVE"}(t.AggregationTemporality||(t.AggregationTemporality={}))}(t.v1||(t.v1={}))}(t.metrics||(t.metrics={})),function(t){!function(t){!function(t){!function(t){t[t.ALWAYS_OFF=0]="ALWAYS_OFF",t[t.ALWAYS_ON=1]="ALWAYS_ON",t[t.ALWAYS_PARENT=2]="ALWAYS_PARENT"}(t.ConstantDecision||(t.ConstantDecision={}))}(t.ConstantSampler||(t.ConstantSampler={})),function(t){!function(t){t[t.SPAN_KIND_UNSPECIFIED=0]="SPAN_KIND_UNSPECIFIED",t[t.SPAN_KIND_INTERNAL=1]="SPAN_KIND_INTERNAL",t[t.SPAN_KIND_SERVER=2]="SPAN_KIND_SERVER",t[t.SPAN_KIND_CLIENT=3]="SPAN_KIND_CLIENT",t[t.SPAN_KIND_PRODUCER=4]="SPAN_KIND_PRODUCER",t[t.SPAN_KIND_CONSUMER=5]="SPAN_KIND_CONSUMER"}(t.SpanKind||(t.SpanKind={}))}(t.Span||(t.Span={}))}(t.v1||(t.v1={}))}(t.trace||(t.trace={})),function(t){!function(t){!function(t){t[t.STRING=0]="STRING",t[t.INT=1]="INT",t[t.DOUBLE=2]="DOUBLE",t[t.BOOL=3]="BOOL"}(t.ValueType||(t.ValueType={}))}(t.v1||(t.v1={}))}(t.common||(t.common={}))}(kn||(kn={}));var Bn=function(t){function e(e,n,r){var o=t.call(this,e)||this;return o.name="CollectorExporterError",o.data=r,o.code=n,o}return xn(e,t),e}(Error),Gn=((Un={})[ot.INTERNAL]=kn.trace.v1.Span.SpanKind.SPAN_KIND_INTERNAL,Un[ot.SERVER]=kn.trace.v1.Span.SpanKind.SPAN_KIND_SERVER,Un[ot.CLIENT]=kn.trace.v1.Span.SpanKind.SPAN_KIND_CLIENT,Un[ot.PRODUCER]=kn.trace.v1.Span.SpanKind.SPAN_KIND_PRODUCER,Un[ot.CONSUMER]=kn.trace.v1.Span.SpanKind.SPAN_KIND_CONSUMER,Un),Fn=function(){return Fn=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},Fn.apply(this,arguments)},jn=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Vn=function(t){function e(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._useXHR=!1,n._useXHR=!!e.headers||"function"!==typeof navigator.sendBeacon,n._useXHR?n._headers=Object.assign({},function(t){void 0===t&&(t={});var e={};return Object.entries(t).forEach((function(t){var n=t[0],r=t[1];"undefined"!==typeof r?e[n]=String(r):St.warn('Header "'+n+'" has wrong value and will be ignored')})),e}(e.headers),Rt(Xt().OTEL_EXPORTER_OTLP_HEADERS)):n._headers={},n}return jn(e,t),e.prototype.onInit=function(){window.addEventListener("unload",this.shutdown)},e.prototype.onShutdown=function(){window.removeEventListener("unload",this.shutdown)},e.prototype.send=function(t,e,n){var r=this;if(this._isShutdown)St.debug("Shutdown already started. Cannot send objects");else{var o=this.convert(t),i=JSON.stringify(o),a=new Promise((function(t,e){r._useXHR?function(t,e,n,r,o){var i=new XMLHttpRequest;i.open("POST",e),Object.entries(Fn(Fn({},{Accept:"application/json","Content-Type":"application/json"}),n)).forEach((function(t){var e=t[0],n=t[1];i.setRequestHeader(e,n)})),i.send(t),i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE)if(i.status>=200&&i.status<=299)St.debug("xhr success",t),r();else{var e=new Bn("Failed to export with XHR (status: "+i.status+")",i.status);o(e)}}}(i,r.url,r._headers,t,e):function(t,e,n,r,o){navigator.sendBeacon(e,new Blob([t],n))?(St.debug("sendBeacon - can send",t),r()):o(new Bn("sendBeacon - cannot send "+t))}(i,r.url,{type:"application/json"},t,e)})).then(e,n);this._sendingPromises.push(a);var s=function(){var t=r._sendingPromises.indexOf(a);r._sendingPromises.splice(t,1)};a.then(s,s)}},e}(Mn);function Hn(t){return Object.keys(t).map((function(e){return function(t,e){var n=Yn(e);return{key:t,value:n}}(e,t[e])}))}function Yn(t){var e={};return"string"===typeof t?e.stringValue=t:"boolean"===typeof t?e.boolValue=t:"number"===typeof t&&t<=2147483647&&t>=-2147483648&&Number.isInteger(t)?e.intValue=t:"number"===typeof t?e.doubleValue=t:Array.isArray(t)?e.arrayValue={values:t.map((function(t){return Yn(t)}))}:t&&(e.kvlistValue={values:Hn(t)}),e}function Wn(t,e){return t.links.map((function(t){return{traceId:e?t.context.traceId:qt(t.context.traceId),spanId:e?t.context.spanId:qt(t.context.spanId),attributes:Hn(t.attributes||{}),droppedAttributesCount:0}}))}function Kn(t){var e={code:t.code};return"undefined"!==typeof t.message&&(e.message=t.message),e}function Xn(t,e){return void 0===e&&(e={}),{attributes:Hn(Object.assign({},e,t?t.attributes:{})),droppedAttributesCount:0}}function qn(t){var e=Gn[t];return"number"===typeof e?e:kn.trace.v1.Span.SpanKind.SPAN_KIND_UNSPECIFIED}function Jn(t){if(t)return t.serialize()}function Zn(t,e,n){var r=function(t){return t.reduce((function(t,e){var n=t.get(e.resource);n||(n=new Map,t.set(e.resource,n));var r=n.get(e.instrumentationLibrary);return r||(r=new Array,n.set(e.instrumentationLibrary,r)),r.push(e),t}),new Map)}(t);return{resourceSpans:$n(r,Object.assign({},e.attributes),n)}}function zn(t,e,n){return{spans:e.map((function(t){return function(t,e){return{traceId:e?t.spanContext().traceId:qt(t.spanContext().traceId),spanId:e?t.spanContext().spanId:qt(t.spanContext().spanId),parentSpanId:t.parentSpanId?e?t.parentSpanId:qt(t.parentSpanId):void 0,traceState:Jn(t.spanContext().traceState),name:t.name,kind:qn(t.kind),startTimeUnixNano:Fe(t.startTime),endTimeUnixNano:Fe(t.endTime),attributes:Hn(t.attributes),droppedAttributesCount:0,events:(n=t.events,n.map((function(t){return{timeUnixNano:Fe(t.time),name:t.name,attributes:Hn(t.attributes||{}),droppedAttributesCount:0}}))),droppedEventsCount:0,status:Kn(t.status),links:Wn(t,e),droppedLinksCount:0};var n}(t,n)})),instrumentationLibrary:t}}function $n(t,e,n){return Array.from(t,(function(t){var r=t[0],o=t[1];return{resource:Xn(r,e),instrumentationLibrarySpans:Array.from(o,(function(t){return zn(t[0],t[1],n)}))}}))}var Qn,tr,er=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),nr=function(t){function e(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._headers=Object.assign(n._headers,Rt(Xt().OTEL_EXPORTER_OTLP_TRACES_HEADERS)),n}return er(e,t),e.prototype.convert=function(t){return Zn(t,this,!0)},e.prototype.getDefaultUrl=function(t){return"string"===typeof t.url?t.url:Xt().OTEL_EXPORTER_OTLP_TRACES_ENDPOINT.length>0?Xt().OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:Xt().OTEL_EXPORTER_OTLP_ENDPOINT.length>0?Xt().OTEL_EXPORTER_OTLP_ENDPOINT:"http://localhost:55681/v1/traces"},e}(Vn),rr=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),or=function(){function t(){}return t.prototype.createValueRecorder=function(t,e){return vr},t.prototype.createCounter=function(t,e){return hr},t.prototype.createUpDownCounter=function(t,e){return hr},t.prototype.createValueObserver=function(t,e,n){return yr},t.prototype.createSumObserver=function(t,e,n){return gr},t.prototype.createUpDownSumObserver=function(t,e,n){return Er},t.prototype.createBatchObserver=function(t){return mr},t}(),ir=function(){function t(t){this._instrument=t}return t.prototype.bind=function(t){return this._instrument},t.prototype.unbind=function(t){},t.prototype.clear=function(){},t}(),ar=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return rr(e,t),e.prototype.add=function(t,e){this.bind(e).add(t)},e}(ir),sr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return rr(e,t),e.prototype.record=function(t,e){this.bind(e).record(t)},e}(ir),ur=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return rr(e,t),e.prototype.observation=function(){return{observer:this,value:0}},e}(ir),cr=function(){},lr=function(){function t(){}return t.prototype.add=function(t){},t}(),dr=function(){function t(){}return t.prototype.record=function(t,e,n){},t}(),pr=function(){function t(){}return t.prototype.update=function(t){},t}(),fr=new or,hr=new ar(new lr),vr=new sr(new dr),_r=new pr,yr=new ur(_r),Er=new ur(_r),gr=new ur(_r),mr=new cr,br=new(function(){function t(){}return t.prototype.getMeter=function(t,e){return fr},t}());!function(t){t[t.INT=0]="INT",t[t.DOUBLE=1]="DOUBLE"}(Qn||(Qn={})),function(t){t[t.AGGREGATION_TEMPORALITY_UNSPECIFIED=0]="AGGREGATION_TEMPORALITY_UNSPECIFIED",t[t.AGGREGATION_TEMPORALITY_DELTA=1]="AGGREGATION_TEMPORALITY_DELTA",t[t.AGGREGATION_TEMPORALITY_CUMULATIVE=2]="AGGREGATION_TEMPORALITY_CUMULATIVE"}(tr||(tr={}));var Cr,Tr,Ar="object"===typeof globalThis?globalThis:window,Sr=Symbol.for("io.opentelemetry.js.api.metrics"),Or=Ar,Dr=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalMeterProvider=function(t){return Or[Sr]?this.getMeterProvider():(Or[Sr]=(e=3,n=t,r=br,function(t){return t===e?n:r}),t);var e,n,r},t.prototype.getMeterProvider=function(){var t,e;return null!==(e=null===(t=Or[Sr])||void 0===t?void 0:t.call(Or,3))&&void 0!==e?e:br},t.prototype.getMeter=function(t,e){return this.getMeterProvider().getMeter(t,e)},t.prototype.disable=function(){delete Or[Sr]},t}(),wr=Dr.getInstance(),Ir=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Nr=function(){function t(t,e,n,r){this._disabled=e,this._valueType=n,this._aggregator=r,this._labels=t}return t.prototype.update=function(t){this._disabled||("number"===typeof t?(this._valueType!==Qn.INT||Number.isInteger(t)||(St.warn("INT value type cannot accept a floating-point value for "+Object.values(this._labels)+", ignoring the fractional digits."),t=Math.trunc(t)),this._aggregator.update(t)):St.error("Metric cannot accept a non-number value for "+Object.values(this._labels)+"."))},t.prototype.getLabels=function(){return this._labels},t.prototype.getAggregator=function(){return this._aggregator},t}(),Rr=function(t){function e(e,n,r,o){return t.call(this,e,n,r,o)||this}return Ir(e,t),e.prototype.add=function(t){t<0?St.error("Counter cannot descend for "+Object.values(this._labels)):this.update(t)},e}(Nr),Pr=function(t){function e(e,n,r,o){return t.call(this,e,n,r,o)||this}return Ir(e,t),e.prototype.add=function(t){this.update(t)},e}(Nr),Lr=function(t){function e(e,n,r,o){return t.call(this,e,n,r,o)||this}return Ir(e,t),e.prototype.record=function(t){this.update(t)},e}(Nr),Ur=function(t){function e(e,n,r,o){return t.call(this,e,n,r,o)||this}return Ir(e,t),e}(Nr);function kr(t){var e=Object.keys(t);return 0===e.length?"":(e=e.sort()).reduce((function(e,n){return e.length>2&&(e+=","),e+(n+":")+t[n]}),"|#")}!function(t){t[t.COUNTER=0]="COUNTER",t[t.UP_DOWN_COUNTER=1]="UP_DOWN_COUNTER",t[t.VALUE_RECORDER=2]="VALUE_RECORDER",t[t.SUM_OBSERVER=3]="SUM_OBSERVER",t[t.UP_DOWN_SUM_OBSERVER=4]="UP_DOWN_SUM_OBSERVER",t[t.VALUE_OBSERVER=5]="VALUE_OBSERVER",t[t.BATCH_OBSERVER=6]="BATCH_OBSERVER"}(Cr||(Cr={})),Object.values(Cr),function(t){t[t.SUM=0]="SUM",t[t.LAST_VALUE=1]="LAST_VALUE",t[t.HISTOGRAM=2]="HISTOGRAM"}(Tr||(Tr={}));var Mr=function(){return Mr=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},Mr.apply(this,arguments)},xr=function(){function t(t,e,n,r,o){this._name=t,this._options=e,this._kind=n,this.resource=r,this.instrumentationLibrary=o,this._instruments=new Map,this._disabled=!!e.disabled,this._valueType="number"===typeof e.valueType?e.valueType:Qn.DOUBLE,this._boundaries=e.boundaries,this._descriptor=this._getMetricDescriptor(),this._aggregationTemporality=void 0===e.aggregationTemporality?tr.AGGREGATION_TEMPORALITY_CUMULATIVE:e.aggregationTemporality}return t.prototype.bind=function(t){var e=kr(t);if(this._instruments.has(e))return this._instruments.get(e);var n=this._makeInstrument(t);return this._instruments.set(e,n),n},t.prototype.unbind=function(t){this._instruments.delete(kr(t))},t.prototype.clear=function(){this._instruments.clear()},t.prototype.getKind=function(){return this._kind},t.prototype.getAggregationTemporality=function(){return this._aggregationTemporality},t.prototype.getMetricRecord=function(){var t=this;return new Promise((function(e){e(Array.from(t._instruments.values()).map((function(e){return{descriptor:t._descriptor,labels:e.getLabels(),aggregator:e.getAggregator(),aggregationTemporality:t.getAggregationTemporality(),resource:t.resource,instrumentationLibrary:t.instrumentationLibrary}})))}))},t.prototype._getMetricDescriptor=function(){return Mr({name:this._name,description:this._options.description||"",unit:this._options.unit||"1",metricKind:this._kind,valueType:this._valueType},this._boundaries&&{boundaries:this._boundaries})},t}(),Br=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Gr=(function(t){function e(e,n,r,o,i){var a=t.call(this,e,n,Cr.COUNTER,o,i)||this;return a._processor=r,a}Br(e,t),e.prototype._makeInstrument=function(t){return new Rr(t,this._disabled,this._valueType,this._processor.aggregatorFor(this._descriptor))},e.prototype.add=function(t,e){void 0===e&&(e={}),this.bind(e).add(t)}}(xr),function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),Fr=(function(t){function e(e,n,r,o,i){var a=t.call(this,e,n,Cr.VALUE_RECORDER,o,i)||this;return a._processor=r,a}Gr(e,t),e.prototype._makeInstrument=function(t){return new Lr(t,this._disabled,this._valueType,this._processor.aggregatorFor(this._descriptor))},e.prototype.record=function(t,e){void 0===e&&(e={}),this.bind(e).record(t)}}(xr),function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),jr=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},Vr=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Hr=(function(t){function e(e,n,r){void 0===r&&(r=6e4);var o=t.call(this)||this;return o._meter=e,o._exporter=n,o._timer=setInterval((function(){o._collect().catch((function(t){xt(t)}))}),r),o._timer,o}Fr(e,t),e.prototype.shutdown=function(){return clearInterval(this._timer),this._collect()},e.prototype._collect=function(){return jr(this,void 0,void 0,(function(){var t=this;return Vr(this,(function(e){switch(e.label){case 0:return[4,this._meter.collect()];case 1:return e.sent(),[2,new Promise((function(e){t._exporter.export(t._meter.getProcessor().checkPointSet(),(function(t){var n;t.code!==Le.SUCCESS&&xt(null!==(n=t.error)&&void 0!==n?n:new Error("PushController: export failed in _collect")),e()}))}))]}}))}))}}((function(){})),function(){function t(t){if(this.kind=Tr.HISTOGRAM,void 0===t||0===t.length)throw new Error("HistogramAggregator should be created with boundaries.");this._boundaries=t.sort((function(t,e){return t-e})),this._current=this._newEmptyCheckpoint(),this._lastUpdateTime=Be()}return t.prototype.update=function(t){this._lastUpdateTime=Be(),this._current.count+=1,this._current.sum+=t;for(var e=0;e<this._boundaries.length;e++)if(t<this._boundaries[e])return void(this._current.buckets.counts[e]+=1);this._current.buckets.counts[this._boundaries.length]+=1},t.prototype.toPoint=function(){return{value:this._current,timestamp:this._lastUpdateTime}},t.prototype._newEmptyCheckpoint=function(){return{buckets:{boundaries:this._boundaries,counts:this._boundaries.map((function(){return 0})).concat([0])},sum:0,count:0}},t}()),Yr=function(){function t(){this._current=0,this._lastUpdateTime=[0,0],this.kind=Tr.LAST_VALUE}return t.prototype.update=function(t){this._current=t,this._lastUpdateTime=Be()},t.prototype.toPoint=function(){return{value:this._current,timestamp:this._lastUpdateTime}},t}(),Wr=function(){function t(){this.kind=Tr.SUM,this._current=0,this._lastUpdateTime=[0,0]}return t.prototype.update=function(t){this._current+=t,this._lastUpdateTime=Be()},t.prototype.toPoint=function(){return{value:this._current,timestamp:this._lastUpdateTime}},t}(),Kr=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Xr=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}Kr(e,t),e.prototype.aggregatorFor=function(t){switch(t.metricKind){case Cr.COUNTER:case Cr.UP_DOWN_COUNTER:return new Wr;case Cr.SUM_OBSERVER:case Cr.UP_DOWN_SUM_OBSERVER:case Cr.VALUE_OBSERVER:return new Yr;case Cr.VALUE_RECORDER:return new Hr(t.boundaries||[1/0]);default:return new Yr}},e.prototype.process=function(t){var e=Object.keys(t.labels).map((function(e){return e+"="+t.labels[e]})).join(",");this._batchMap.set(t.descriptor.name+e,t)}}(function(){function t(){this._batchMap=new Map}return t.prototype.checkPointSet=function(){return Array.from(this._batchMap.values())},t}()),function(){function t(){this.values=new Map}return t.prototype.observe=function(t,e){this.values.set(e,t)},t}()),qr=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Jr=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},Zr=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},zr=function(){},$r=function(t){function e(e,n,r,o,i,a,s){var u=t.call(this,e,n,i,o,a)||this;return u._processor=r,u._callback=s||zr,u}return qr(e,t),e.prototype._makeInstrument=function(t){return new Ur(t,this._disabled,this._valueType,this._processor.aggregatorFor(this._descriptor))},e.prototype.getMetricRecord=function(){return Jr(this,void 0,void 0,(function(){var e;return Zr(this,(function(n){switch(n.label){case 0:return e=new Xr,[4,this._callback(e)];case 1:return n.sent(),this._processResults(e),[2,t.prototype.getMetricRecord.call(this)]}}))}))},e.prototype._processResults=function(t){var e=this;t.values.forEach((function(t,n){e.bind(n).update(t)}))},e.prototype.observation=function(t){return{value:t,observer:this}},e}(xr),Qr=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),to=(function(t){function e(e,n,r,o,i,a){return t.call(this,e,n,r,o,Cr.SUM_OBSERVER,i,a)||this}Qr(e,t),e.prototype._processResults=function(t){var e=this;t.values.forEach((function(t,n){var r=e.bind(n),o=r.getAggregator().toPoint(),i=-1/0;0===o.timestamp[0]&&0===o.timestamp[1]||(i=o.value),t>=i&&r.update(t)}))}}($r),Qn.DOUBLE,function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),eo=(function(t){function e(e,n,r,o,i){var a=t.call(this,e,n,Cr.UP_DOWN_COUNTER,o,i)||this;return a._processor=r,a}to(e,t),e.prototype._makeInstrument=function(t){return new Pr(t,this._disabled,this._valueType,this._processor.aggregatorFor(this._descriptor))},e.prototype.add=function(t,e){void 0===e&&(e={}),this.bind(e).add(t)}}(xr),function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),no=(function(t){function e(e,n,r,o,i,a){return t.call(this,e,n,r,o,Cr.UP_DOWN_SUM_OBSERVER,i,a)||this}eo(e,t)}($r),function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}());function ro(t){return Object.entries(t).map((function(t){var e=t[0],n=t[1];return{key:e,value:String(n)}}))}function oo(t){return t.descriptor.metricKind===Cr.VALUE_OBSERVER?kn.metrics.v1.AggregationTemporality.AGGREGATION_TEMPORALITY_UNSPECIFIED:t.aggregationTemporality}function io(t,e){return{labels:ro(t.labels),value:t.aggregator.toPoint().value,startTimeUnixNano:e,timeUnixNano:Fe(t.aggregator.toPoint().timestamp)}}function ao(t,e){var n=t.aggregator.toPoint(),r=n.value,o=n.timestamp;return{labels:ro(t.labels),sum:r.sum,count:r.count,startTimeUnixNano:e,timeUnixNano:Fe(o),bucketCounts:r.buckets.counts,explicitBounds:r.buckets.boundaries}}function so(t,e,n){var r=function(t){return t.reduce((function(t,e){var n=t.get(e.resource);n||(n=new Map,t.set(e.resource,n));var r=n.get(e.instrumentationLibrary);return r||(r=new Array,n.set(e.instrumentationLibrary,r)),r.push(e),t}),new Map)}(t);return{resourceMetrics:co(r,Object.assign({},n.attributes),e)}}function uo(t,e,n){return{metrics:e.map((function(t){return function(t,e){var n={name:t.descriptor.name,description:t.descriptor.description,unit:t.descriptor.unit};if(t.aggregator.kind===Tr.SUM||t.descriptor.metricKind===Cr.SUM_OBSERVER||t.descriptor.metricKind===Cr.UP_DOWN_SUM_OBSERVER){var r={dataPoints:[io(t,e)],isMonotonic:t.descriptor.metricKind===Cr.COUNTER||t.descriptor.metricKind===Cr.SUM_OBSERVER,aggregationTemporality:oo(t)};t.descriptor.valueType===Qn.INT?n.intSum=r:n.doubleSum=r}else t.aggregator.kind===Tr.LAST_VALUE?(r={dataPoints:[io(t,e)]},t.descriptor.valueType===Qn.INT?n.intGauge=r:n.doubleGauge=r):t.aggregator.kind===Tr.HISTOGRAM&&(r={dataPoints:[ao(t,e)],aggregationTemporality:oo(t)},t.descriptor.valueType===Qn.INT?n.intHistogram=r:n.doubleHistogram=r);return n}(t,n)})),instrumentationLibrary:t}}function co(t,e,n){return Array.from(t,(function(t){var r=t[0],o=t[1];return{resource:Xn(r,e),instrumentationLibraryMetrics:Array.from(o,(function(t){return uo(t[0],t[1],n)}))}}))}!function(t){function e(e,n,r,o,i,a){return t.call(this,e,n,r,o,Cr.VALUE_OBSERVER,i,a)||this}no(e,t)}($r);var lo=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function po(t){void 0===t&&(t=[]);for(var e=[],n=0,r=t.length;n<r;n++){var o=t[n];if(Array.isArray(o)){var i=po(o);e=e.concat(i.instrumentations)}else"function"===typeof o?e.push(new o):o.instrumentationName&&e.push(o)}return{instrumentations:e}}function fo(t){var e=po(t.instrumentations).instrumentations,n=t.tracerProvider||Tt.getTracerProvider(),r=t.meterProvider||wr.getMeterProvider();return function(t,e,n){for(var r=0,o=t.length;r<o;r++){var i=t[r];e&&i.setTracerProvider(e),n&&i.setMeterProvider(n),i.enable()}}(e,n,r),function(){!function(t){t.forEach((function(t){return t.disable()}))}(e)}}function ho(t){return"function"===typeof t}!function(t){function e(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._startTime=1e6*(new Date).getTime(),n._headers=Object.assign(n._headers,Rt(Xt().OTEL_EXPORTER_OTLP_METRICS_HEADERS)),n}lo(e,t),e.prototype.convert=function(t){return so(t,this._startTime,this)},e.prototype.getDefaultUrl=function(t){return"string"===typeof t.url?t.url:Xt().OTEL_EXPORTER_OTLP_METRICS_ENDPOINT.length>0?Xt().OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:Xt().OTEL_EXPORTER_OTLP_ENDPOINT.length>0?Xt().OTEL_EXPORTER_OTLP_ENDPOINT:"http://localhost:55681/v1/metrics"}}(Vn);var vo=console.error.bind(console);function _o(t,e,n){var r=!!t[e]&&t.propertyIsEnumerable(e);Object.defineProperty(t,e,{configurable:!0,enumerable:r,writable:!0,value:n})}function yo(t){t&&t.logger&&(ho(t.logger)?vo=t.logger:vo("new logger isn't a function, not replacing"))}function Eo(t,e,n){if(t&&t[e]){if(!n)return vo("no wrapper function"),void vo((new Error).stack);if(ho(t[e])&&ho(n)){var r=t[e],o=n(r,e);return _o(o,"__original",r),_o(o,"__unwrap",(function(){t[e]===o&&_o(t,e,r)})),_o(o,"__wrapped",!0),_o(t,e,o),o}vo("original object and wrapper must be functions")}else vo("no original function "+e+" to wrap")}function go(t,e){return t&&t[e]?t[e].__unwrap?t[e].__unwrap():void vo("no original to unwrap to -- has "+e+" already been unwrapped?"):(vo("no function to unwrap."),void vo((new Error).stack))}yo.wrap=Eo,yo.massWrap=function(t,e,n){if(!t)return vo("must provide one or more modules to patch"),void vo((new Error).stack);Array.isArray(t)||(t=[t]),e&&Array.isArray(e)?t.forEach((function(t){e.forEach((function(e){Eo(t,e,n)}))})):vo("must provide one or more functions to wrap on modules")},yo.unwrap=go,yo.massUnwrap=function(t,e){if(!t)return vo("must provide one or more modules to patch"),void vo((new Error).stack);Array.isArray(t)||(t=[t]),e&&Array.isArray(e)?t.forEach((function(t){e.forEach((function(e){go(t,e)}))})):vo("must provide one or more functions to unwrap on modules")};var mo=yo,bo=mo.wrap,Co=mo.unwrap,To=mo.massWrap,Ao=mo.massUnwrap,So=function(){return So=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},So.apply(this,arguments)},Oo=function(){function t(t,e,n){void 0===n&&(n={}),this.instrumentationName=t,this.instrumentationVersion=e,this._wrap=bo,this._unwrap=Co,this._massWrap=To,this._massUnwrap=Ao,this._config=So({enabled:!0},n),this._diag=St.createComponentLogger({namespace:t}),this._tracer=Tt.getTracer(t,e),this._meter=wr.getMeter(t,e)}return Object.defineProperty(t.prototype,"meter",{get:function(){return this._meter},enumerable:!1,configurable:!0}),t.prototype.setMeterProvider=function(t){this._meter=t.getMeter(this.instrumentationName,this.instrumentationVersion)},t.prototype.getConfig=function(){return this._config},t.prototype.setConfig=function(t){void 0===t&&(t={}),this._config=Object.assign({},t)},t.prototype.setTracerProvider=function(t){this._tracer=t.getTracer(this.instrumentationName,this.instrumentationVersion)},Object.defineProperty(t.prototype,"tracer",{get:function(){return this._tracer},enumerable:!1,configurable:!0}),t}(),Do=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),wo=function(t){function e(e,n,r){void 0===r&&(r={});var o=t.call(this,e,n,r)||this;return o._config.enabled&&o.enable(),o}return Do(e,t),e}(Oo);function Io(t){return"function"===typeof t&&"function"===typeof t.__original&&"function"===typeof t.__unwrap&&!0===t.__wrapped}var No={HOST:"docs.qq.com",TENANT_ID:"tdocs",TRACE_URL:"https://tpstelemetry.tencent.com/v1/trace"},Ro=[/tencent\.com/,/tencentcs\.com/,/aegis\.qq\.com/,/report\.idqqimg\.com/,/trace\.qq\.com/,/tianshu\.qq\.com/,/access\.toggle\.qq\.com/,/docs\.idqqimg\.com/,/at\.idqqimg\.com/,/docs\.qq\.com\/tim\/docs\/components/,/docs\.gtimg\.com\/docs-components/,/.*\.docs\.qq\.com/],Po={};function Lo(){return"undefined"!==typeof window}function Uo(){return"undefined"!==typeof n.g}var ko=Lo()?window:Uo()?n.g:Lo||"undefined"===typeof self?(Uo()&&n.g.describe,Po):self;function Mo(t,e){return null!==t&&Object.prototype.hasOwnProperty.call(t,e)}var xo,Bo="document";function Go(t){if(!Mo(ko,Bo))return null;var e=new RegExp("(?:^|;+|\\s+)"+t+"=([^;]*)"),n=document.cookie.match(e);return(n?n[1]:null)||null}!function(t){t.xsrf="TOK",t.devRouteId="dev_route_id",t.devOaName="dev_oa_name",t.fd="fd",t.envId="env_id",t.sid="SID",t.sids="SID_S",t.uid="uid",t.uidKey="uid_key",t.uin="uin",t.loginTime="loginTime",t.hasBeenLogin="has_been_login",t.adtag="adtag"}(xo||(xo={}));var Fo,jo,Vo=function(){function t(t){this.options=t}return t.prototype.export=function(t,e){return this.sendSpans(t,e)},t.prototype.shutdown=function(){return this.sendSpans([]),Promise.resolve()},t.prototype.sendSpans=function(t,e){var n,r,o,i;try{for(var a=function(t){var e="function"===typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"===typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),s=a.next();!s.done;s=a.next()){var u=s.value;if(void 0===u.parentSpanId){var c=u.spanContext(),l=c.spanId,d={traceId:c.traceId,id:l,name:u.name,kind:u.kind,attributes:u.attributes,timestamp:je(u.startTime)};try{this.options.onTraceExport(d)}catch(p){null===(i=(o=this.options).onTraceExportError)||void 0===i||i.call(o,p)}}}}catch(f){n={error:f}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}if(e)return e({code:Le.SUCCESS})},t}();!function(t){t.METHOD_OPEN="open",t.METHOD_SEND="send",t.EVENT_ABORT="abort",t.EVENT_ERROR="error",t.EVENT_LOAD="loaded",t.EVENT_TIMEOUT="timeout"}(Fo||(Fo={})),function(t){t.COMPONENT="component",t.HTTP_STATUS_TEXT="http.status_text"}(jo||(jo={}));var Ho,Yo,Wo="1.3.0",Ko=function(t){function e(n){void 0===n&&(n={});var r=t.call(this,"xml-http-request-instrumentation",Wo,Object.assign({},n))||this;return r.version=Wo,r.moduleName=e.component,r.tasksCount=0,r.xhrMemoryMap=new WeakMap,r.usedResources=new WeakSet,r}return c(e,t),e.prototype.init=function(){},e.prototype.getConfig=function(){return this._config},e.prototype.enable=function(){Io(XMLHttpRequest.prototype.open)&&this._unwrap(XMLHttpRequest.prototype,"open"),Io(XMLHttpRequest.prototype.send)&&this._unwrap(XMLHttpRequest.prototype,"send"),this._wrap(XMLHttpRequest.prototype,"open",this.patchOpen()),this._wrap(XMLHttpRequest.prototype,"send",this.patchSend())},e.prototype.disable=function(){this._unwrap(XMLHttpRequest.prototype,"open"),this._unwrap(XMLHttpRequest.prototype,"send"),this.tasksCount=0,this.xhrMemoryMap=new WeakMap,this.usedResources=new WeakSet},e.prototype.patchOpen=function(){var t=this;return function(e){var n=t;return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var o=d(t,2),i=o[0],a=o[1];return n.createSpan(this,a,i),e.apply(this,t)}}},e.prototype.endSpanTimeout=function(t,e,n){var r=e.callbackToRemoveEvents;"function"===typeof r&&r();var o=e.span,i=e.spanUrl,a=e.sendStartTime;o&&(this.findResourceAndAddNetworkEvents(e,o,i,a,n),o.addEvent(t,n),this.addFinalSpanAttributes(o,e,i),o.end(n),this.tasksCount-=1),this.clearResources()},e.prototype.patchSend=function(){var t=this;function e(e,n){var r=t.xhrMemoryMap.get(n);if(r){r.status=n.status,r.statusText=n.statusText,t.xhrMemoryMap.delete(n),r.span&&t.applyAttributesAfterXHR(r.span,n);var o=Be();setTimeout((function(){t.endSpanTimeout(e,r,o)}),300)}}function n(){e(Fo.EVENT_ERROR,this)}function r(){e(Fo.EVENT_ABORT,this)}function o(){e(Fo.EVENT_TIMEOUT,this)}function i(){this.status<299?e(Fo.EVENT_LOAD,this):e(Fo.EVENT_ERROR,this)}function a(e){e.removeEventListener("abort",r),e.removeEventListener("error",n),e.removeEventListener("load",i),e.removeEventListener("timeout",o);var a=t.xhrMemoryMap.get(e);a&&(a.callbackToRemoveEvents=void 0)}return function(e){return function(){for(var s=this,u=[],c=0;c<arguments.length;c++)u[c]=arguments[c];var l=t.xhrMemoryMap.get(this);if(!l)return e.apply(this,u);var d=l.span,p=l.spanUrl;return d&&p&&Ct.with(Tt.setSpan(Ct.active(),d),(function(){t.tasksCount+=1,l.sendStartTime=Be(),d.addEvent(Fo.METHOD_SEND),s.addEventListener("abort",r),s.addEventListener("error",n),s.addEventListener("load",i),s.addEventListener("timeout",o),l.callbackToRemoveEvents=function(){a(s),l.createdResources&&l.createdResources.observer.disconnect()},t.addHeaders(s,p),t.addResourceObserver(s,p)})),e.apply(this,u)}}},e.prototype.addHeaders=function(t,e){var n=this.getConfig().propagateTraceHeaderCorsUrls,r=Ln(e);if("function"===typeof n){if(!n(r))return void At.inject(Ct.active(),{})}else if(!function(t,e){var n=e||[];return("string"===typeof n||n instanceof RegExp)&&(n=[n]),Ln(t).origin===window.location.origin||n.some((function(e){return rn(t,e)}))}(e,n))return void At.inject(Ct.active(),{});var o={};At.inject(Ct.active(),o),Object.keys(o).forEach((function(e){t.setRequestHeader(e,String(o[e]))}))},e.prototype.addChildSpan=function(t,e){var n=this;Ct.with(Tt.setSpan(Ct.active(),t),(function(){var t=n.tracer.startSpan("CORS Preflight",{startTime:e[gn.FETCH_START]});Rn(t,e),t.end(e[gn.RESPONSE_END])}))},e.prototype.addFinalSpanAttributes=function(t,n,r){if("string"===typeof r){var o=Ln(r);void 0!==n.status&&t.setAttribute(ye,n.status),void 0!==n.statusText&&t.setAttribute(jo.HTTP_STATUS_TEXT,n.statusText),t.setAttribute(ve,o.host),t.setAttribute(_e,o.protocol.replace(":","")),t.setAttribute(Ee,navigator.userAgent),t.setAttribute(jo.COMPONENT,e.component)}},e.prototype.applyAttributesAfterXHR=function(t,e){var n=this.getConfig().applyCustomAttributesOnSpan;"function"===typeof n&&function(t,e,n){var r,o;try{o=t()}catch(i){r=i}finally{if(e(r,o),r&&!n)throw r;return o}}((function(){return n(t,e)}),(function(t){}),!0)},e.prototype.addResourceObserver=function(t,e){var n=this.xhrMemoryMap.get(t);n&&"undefined"!==typeof window.PerformanceObserver&&"undefined"!==typeof window.PerformanceResourceTiming&&(n.createdResources={observer:new PerformanceObserver((function(t){var r=t.getEntries(),o=wn();o.href=e,r.forEach((function(t){"xmlhttprequest"===t.initiatorType&&t.name===o.href&&n.createdResources&&n.createdResources.entries.push(t)}))})),entries:[]},n.createdResources.observer.observe({entryTypes:["resource"]}))},e.prototype.clearResources=function(){0===this.tasksCount&&this.getConfig().clearTimingResources&&(ue.clearResourceTimings(),this.xhrMemoryMap=new WeakMap,this.usedResources=new WeakSet)},e.prototype.findResourceAndAddNetworkEvents=function(t,e,n,r,o){if(n&&r&&o&&t.createdResources){var i=t.createdResources.entries;i&&i.length||(i=ue.getEntriesByType("resource"));var a=Pn(n,r,o,i,this.usedResources);if(a.mainRequest){var s=a.mainRequest;this.markResourceAsUsed(s);var u=a.corsPreFlightRequest;u&&(this.addChildSpan(e,u),this.markResourceAsUsed(u)),Rn(e,s)}}},e.prototype.cleanPreviousSpanInformation=function(t){var e=this.xhrMemoryMap.get(t);if(e){var n=e.callbackToRemoveEvents;n&&n(),this.xhrMemoryMap.delete(t)}},e.prototype.createSpan=function(t,e,n){var r;if(!function(t,e){if(!e)return!1;for(var n=0,r=e;n<r.length;n++)if(rn(t,r[n]))return!0;return!1}(e,this.getConfig().ignoreUrls)){var o=Ln(e).pathname,i=this.tracer.startSpan(o,{kind:ot.CLIENT,attributes:(r={},r[pe]=n,r[fe]=e,r[he]=o,r)});return i.addEvent(Fo.METHOD_OPEN),this.cleanPreviousSpanInformation(t),this.xhrMemoryMap.set(t,{span:i,spanUrl:e}),i}},e.prototype.markResourceAsUsed=function(t){this.usedResources.add(t)},e.component="xml-http-request",e}(wo);!function(t){t.COMPONENT="component",t.DOCUMENT_LOAD="documentLoad",t.DOCUMENT_FETCH="documentFetch",t.RESOURCE_FETCH="resourceFetch"}(Ho||(Ho={})),function(t){t.FIRST_PAINT="firstPaint",t.FIRST_CONTENTFUL_PAINT="firstContentfulPaint"}(Yo||(Yo={}));var Xo,qo={"first-paint":Yo.FIRST_PAINT,"first-contentful-paint":Yo.FIRST_CONTENTFUL_PAINT},Jo=function(){var t,e;return(t={}).fd=Go("fd"),t.dev_route_id=Go("dev_route_id"),t.env_id=Go("env_id"),t.env_name=Go("env_name"),t.version=null!==(e=window.__globalReleaseVersion)&&void 0!==e?e:"unknown",t},Zo=function(){var t,e=null!==(t=Go("traceparent"))&&void 0!==t?t:"";return setTimeout((function(){return function(t,e,n){if(Mo(ko,Bo)){var r=e||"/",o=n?"domain="+n+";":"",i=new Date(0).toUTCString();document.cookie=t+"=;expires="+i+";path="+r+";"+o}}("traceparent")}),0),e},zo=function(t){function e(n){void 0===n&&(n={});var r=t.call(this,"document-load-instrumentation",Wo,n)||this;return r.version=Wo,r.moduleName=e.component,r}return c(e,t),e.prototype.init=function(){},e.prototype.getConfig=function(){return this._config},e.prototype.enable=function(){window.removeEventListener("load",this.onDocumentLoaded),this.waitForPageLoad()},e.prototype.disable=function(){window.removeEventListener("load",this.onDocumentLoaded)},e.prototype.onDocumentLoaded=function(){var t=this;setTimeout((function(){t.collectPerformance()}),0)},e.prototype.waitForPageLoad=function(){"complete"===window.document.readyState?this.onDocumentLoaded():(this.onDocumentLoaded=this.onDocumentLoaded.bind(this),window.addEventListener("load",this.onDocumentLoaded))},e.prototype.collectPerformance=function(){var t,e=this,n=null!==(t=function(){var t=Array.from(document.getElementsByTagName("meta")).find((function(t){return t.getAttribute("name")===Je}));return(null===t||void 0===t?void 0:t.content)||""}())&&void 0!==t?t:Zo(),r=function(){var t,e,n={},r=d(null===(e=(t=ue).getEntriesByType)||void 0===e?void 0:e.call(t,"navigation"),1)[0];if(r)Object.values(gn).forEach((function(t){if(In(r,t)){var e=r[t];"number"===typeof e&&(n[t]=e)}}));else{var o=ue.timing;o&&Object.values(gn).forEach((function(t){if(In(o,t)){var e=o[t];"number"===typeof e&&(n[t]=e)}}))}return n}();Ct.with(At.extract(k,{traceparent:n}),(function(){var t=e.startSpan(Ho.DOCUMENT_LOAD,gn.FETCH_START,r);t&&(Ct.with(Tt.setSpan(Ct.active(),t),(function(){var t=e.startSpan(Ho.DOCUMENT_FETCH,gn.FETCH_START,r);t&&Ct.with(Tt.setSpan(Ct.active(),t),(function(){Rn(t,r),e.endSpan(t,gn.RESPONSE_END,r)}))})),t.setAttribute(fe,location.href),t.setAttribute(Ee,navigator.userAgent),e.addResourcesSpans(t),Nn(t,gn.FETCH_START,r),Nn(t,gn.UNLOAD_EVENT_START,r),Nn(t,gn.UNLOAD_EVENT_END,r),Nn(t,gn.DOM_INTERACTIVE,r),Nn(t,gn.DOM_CONTENT_LOADED_EVENT_START,r),Nn(t,gn.DOM_CONTENT_LOADED_EVENT_END,r),Nn(t,gn.DOM_COMPLETE,r),Nn(t,gn.LOAD_EVENT_START,r),Nn(t,gn.LOAD_EVENT_END,r),function(t){var e,n,r=null===(n=(e=ue).getEntriesByType)||void 0===n?void 0:n.call(e,"paint");r&&r.forEach((function(e){var n=e.name,r=e.startTime;In(qo,n)&&t.addEvent(qo[n],r)}))}(t),e.endSpan(t,gn.LOAD_EVENT_END,r))}))},e.prototype.startSpan=function(t,n,r,o){if(In(r,n)&&"number"===typeof r[n]){var i=this.tracer.startSpan(t,{startTime:r[n]},o?Tt.setSpan(Ct.active(),o):void 0);return i.setAttribute(Ho.COMPONENT,e.component),i}},e.prototype.addResourcesSpans=function(t){var e,n,r=this,o=null===(n=(e=ue).getEntriesByType)||void 0===n?void 0:n.call(e,"resource");o&&o.forEach((function(e){r.initResourceSpan(e,t)}))},e.prototype.initResourceSpan=function(t,e){var n=Ln(t.name),r=this.startSpan(Ho.RESOURCE_FETCH+"/"+t.initiatorType,gn.FETCH_START,t,e);r&&(r.setAttribute(fe,n.href),r.setAttribute(ve,n.host),r.setAttribute(he,n.pathname),Rn(r,t),this.endSpan(r,gn.RESPONSE_END,t))},e.prototype.endSpan=function(t,e,n){if(t){var r=this.getConfig().applyCustomAttributesOnSpan;"function"===typeof r&&r(t),In(n,e)?t.end(n[e]):t.end()}},e.component="document-load",e}(wo);function $o(t){var e,n,r;if(!function(){var t,e,n=null!==(e=null===(t=window.navigator)||void 0===t?void 0:t.userAgent)&&void 0!==e?e:"";return/MSIE/i.test(n)&&!/opera/i.test(n)||/Trident/i.test(n)}()){var o=Jo(),a=function(){var t;return(t={}).uid=(0,i.getUid)(),t.utype=(0,i.loginType)(),t.fingerprint=Go("fingerprint")||void 0,t}(),u=No,c=new Dn({resource:new fn(l(l(l((e={"tps.tenant.id":u.TENANT_ID},e[Ie]=t.serviceName,e),o),a),null!==(n=t.customResourceAttributes)&&void 0!==n?n:{}))});if(t.console&&c.addSpanProcessor(new Tn(new Cn)),t.onTraceExport){var d=t.traceExportMode===Xo.BATCH?En:Tn;c.addSpanProcessor(new d(new Vo({onTraceExport:t.onTraceExport,onTraceExportError:t.onTraceExportError})))}var p=null!==(r=t.enableTpsExport)&&void 0!==r?r:function(){var t=s()(location.href).query,e=Jo();return!!(null===t||void 0===t?void 0:t.opentelemetry)||!e.dev_route_id}();p&&c.addSpanProcessor(new En(new nr({url:u.TRACE_URL,headers:{"X-Tps-TenantID":u.TENANT_ID}}))),c.register();var f=function(t){t.setAttributes(a)};fo({instrumentations:[new zo({applyCustomAttributesOnSpan:f}),new Ko({ignoreUrls:Ro,propagateTraceHeaderCorsUrls:function(t){return t.host===u.HOST},applyCustomAttributesOnSpan:f})]}),Tt.setGlobalTracerProvider(c)}}function Qo(t){return Tt.getTracer(t)}!function(t){t.SIMPLE="simple",t.BATCH="batch"}(Xo||(Xo={}))},82348:function(t,e,n){n(13857),n(54371),n(38934),n(5570),n(64656),n(43125),n(53923),n(52865),n(77468),n(85932),n(33552),n(20670),window,t.exports=function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(t,e,n){!function(t){"use strict";function e(t,e){return Object.prototype.toString.call(e)==="[object "+t+"]"}function n(t){return e("Array",t)}function r(t){return e("Date",t)}function o(t){return e("Object",t)}function i(t){return o(t)?JSON.stringify(t):t}var a=void 0!==a?a:{};"undefined"!=typeof window?a=window:"undefined"!=typeof self&&(a=self);var s=a;function u(t,e,n,r,o){var a=new Date;a.setTime(a.getTime()+(n?864e5*n:2592e6)),s.document&&(document.cookie=t+"="+encodeURIComponent(i(e))+";expires="+a.toGMTString()+";path="+(r||"/")+";"+(o?"domain="+o+";":""))}function c(t,e,n){var r=new Date(0);s.document&&(document.cookie=t+"=;expires="+r.toUTCString()+";path="+(e||"/")+";"+(n?"domain="+n+";":""))}function l(t){var e=new RegExp("(?:^|;+|\\s+)"+t+"=([^;]*)"),n="";return s.document&&(n=s.document.cookie.match(e)),(n?n[1]:"")||null}var d=function(){return s.location.hash},p=function(){return s.location.search};t.extend=function t(e,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(var a in e)if(e.hasOwnProperty(a)){var s=o(e[a]),u=n(e[a]);s||u?i&&(s?(r[a]={},t(e[a],r[a],i-1)):u&&(r[a]=[],t(e[a],r[a],i-1))):r[a]=e[a]}},t.setCookie=u,t.delCookie=c,t.getCookie=l,t.formatDate=function(t,e){if(t){var n=e,o=r(t)?t:new Date(t),i={"M+":o.getMonth()+1,"d+":o.getDate(),"h+":o.getHours()%12==0?12:o.getHours()%12,"H+":o.getHours(),"m+":o.getMinutes(),"s+":o.getSeconds(),"q+":Math.floor((o.getMonth()+3)/3),S:o.getMilliseconds()};for(var a in/(y+)/.test(n)&&(n=n.replace(RegExp.$1,String(o.getFullYear()).substr(4-RegExp.$1.length))),/(E+)/.test(n)&&(n=n.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"星期":"周":"")+{0:"日",1:"一",2:"二",3:"三",4:"四",5:"五",6:"六"}[String(o.getDay())])),i)new RegExp("("+a+")").test(n)&&(n=n.replace(RegExp.$1,1===RegExp.$1.length?i[a]:("00"+i[a]).substr(String(i[a]).length)));return n}},t.setItem=function(t,e){var n=i(e);void 0!==s.Storage?localStorage.setItem(t,n):u(t,n)},t.getItem=function(t){return void 0!==s.Storage?localStorage.getItem(t):l(t)},t.delItem=function(t){void 0!==s.Storage?delete localStorage[t]:c(t)},t.callApi=function(t){if(s.document){var e=document.createElement("iframe");e.src=t,e.height=0,e.width=0,e.style.cssText="display: none",document.body.appendChild(e),setTimeout((function(){document.body.removeChild(e),e=null}),2e3)}},t.encodeHTML=function(t){return t&&0!==t.length?t.replace(/&/g,"&#38;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\'/g,"&#39;").replace(/\"/g,"&quot;").replace(/ /g,"&nbsp;").replace(/\n/g,"<br>"):""},t.decodeHTML=function(t){return 0===t.length?"":t.replace(/&#38;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#39;/g,"'").replace(/&quot;/g,'"').replace(/&nbsp;/g," ").replace(/<br>/g,"\n")},t.isType=e,t.isBoolean=function(t){return e("Boolean",t)},t.isNumber=function(t){return e("Number",t)},t.isString=function(t){return e("String",t)},t.isFunction=function(t){return e("Function",t)},t.isArray=n,t.isDate=r,t.isRegExp=function(t){return e("RegExp",t)},t.isObject=o,t.isError=function(t){return e("Error",t)},t.getHash=function(t){var e="";return s.location&&(e=d().match(new RegExp("(#|&)"+t+"=([^&#]*)(#|&|$)"))),e?decodeURIComponent(e[2]):""},t.getUrlParam=function(t){var e="",n=s.location;return n&&(e=p().match(new RegExp("(\\?|#|&)"+t+"=([^&]*)(#|&|$)"))),!e&&n&&(e=d().match(new RegExp("(#|&)"+t+"=([^&#]*)(#|&|$)"))),e?decodeURIComponent(e[2]):""},t.getQuery=function(t){var e="";return s.location&&(e=p().match(new RegExp("(\\?|&)"+t+"=([^&]*)(#|&|$)"))),e?decodeURIComponent(e[2]):""},t._stringify=i,t._parse=function(t){return o(t)?t:JSON.parse(t)},Object.defineProperty(t,"__esModule",{value:!0})}(e)},,,function(t,e,n){"use strict";n.r(e),n.d(e,"getUid",(function(){return o})),n.d(e,"getNowUserId",(function(){return i})),n.d(e,"isLogin",(function(){return a})),n.d(e,"isTDocsLogin",(function(){return s})),n.d(e,"loginType",(function(){return u})),n.d(e,"checkWeWork",(function(){return c}));var r=n(0);function o(){var t,e,n;return(null===(t=window.global_multi_user)||void 0===t?void 0:t.uid)||(null===(n=null===(e=window.clientVars)||void 0===e?void 0:e.userInfo)||void 0===n?void 0:n.uid)||Object(r.getCookie)("uid")}function i(){return window.nowUserIndex||o()}function a(){return!!(Object(r.getCookie)("uid")&&Object(r.getCookie)("uid_key")||Object(r.getCookie)("SID")||Object(r.getCookie)("p_luin")&&Object(r.getCookie)("p_lskey")||Object(r.getCookie)("p_uin")&&Object(r.getCookie)("p_skey"))}function s(){return!!(Object(r.getCookie)("uid")&&Object(r.getCookie)("uid_key")||Object(r.getCookie)("SID"))}function u(){var t,e=Object(r.getCookie)("utype");return(null===(t=window.global_multi_user)||void 0===t?void 0:t.utype)||e}function c(){return"ww"===u()}}])}}]),window.jsExecEndTimeStamp=Date.now(),window.cachedPerformanceEntries||(window.cachedPerformanceEntries=[]),window.cachedPerformanceEntries.push({name:"jsExec: js/initial_vendors_tencent_1.0f1f51b83059fa3bb425.js",entryType:"jsExec",startTime:window.jsExecStartTimeStamp,endTime:window.jsExecEndTimeStamp});
//# sourceMappingURL=initial_vendors_tencent_1.0f1f51b83059fa3bb425.js.map